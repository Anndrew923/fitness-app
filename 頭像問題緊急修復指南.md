# ğŸš¨ é ­åƒè¼‰å…¥å¤±æ•—ç·Šæ€¥ä¿®å¾©æŒ‡å—

## å•é¡Œç¾ç‹€

- æ§åˆ¶å°é¡¯ç¤ºå¤§é‡ 412 (Precondition Failed) éŒ¯èª¤
- æ‰€æœ‰ç”¨æˆ¶é ­åƒç„¡æ³•æ­£å¸¸é¡¯ç¤º
- Firebase Storage å­˜å–è¢«æ‹’çµ•

## ğŸ”¥ ç«‹å³ä¿®å¾©æ­¥é©Ÿ

### ç¬¬ä¸€æ­¥ï¼šæ›´æ–° Firebase Storage å®‰å…¨è¦å‰‡

1. å‰å¾€ [Firebase Console](https://console.firebase.google.com/)
2. é¸æ“‡ä½ çš„é …ç›®
3. é»æ“Šå·¦å´é¸å–® **Storage**
4. é»æ“Š **Rules** æ¨™ç±¤
5. **è¤‡è£½ä»¥ä¸‹è‡¨æ™‚è¦å‰‡ä¸¦è²¼ä¸Š**ï¼š

```javascript
rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    match /{allPaths=**} {
      allow read, write: if request.auth != null;
    }
  }
}
```

6. é»æ“Š **ç™¼å¸ƒï¼ˆPublishï¼‰**
7. **ç­‰å¾… 1-2 åˆ†é˜**è®“è¦å‰‡ç”Ÿæ•ˆ

### ç¬¬äºŒæ­¥ï¼šæ¸…é™¤ç·©å­˜ä¸¦æ¸¬è©¦

1. åœ¨ç€è¦½å™¨ä¸­æŒ‰ `Ctrl+Shift+Delete`ï¼ˆWindowsï¼‰æˆ– `Cmd+Shift+Delete`ï¼ˆMacï¼‰
2. æ¸…é™¤éå» 1 å°æ™‚çš„ç·©å­˜
3. é‡æ–°è¼‰å…¥é é¢
4. æ¸¬è©¦é ­åƒåŠŸèƒ½

### ç¬¬ä¸‰æ­¥ï¼šä½¿ç”¨èª¿è©¦å·¥å…·

å¦‚æœå•é¡ŒæŒçºŒï¼Œåœ¨ç€è¦½å™¨æ§åˆ¶å°åŸ·è¡Œï¼š

```javascript
firebaseDebug.fullDiagnosis();
```

## ğŸ” è¨ºæ–·æª¢æŸ¥æ¸…å–®

### âœ… Firebase Console æª¢æŸ¥

- [ ] Storage è¦å‰‡å·²æ›´æ–°
- [ ] ç­‰å¾…è¦å‰‡ç”Ÿæ•ˆï¼ˆ1-2 åˆ†é˜ï¼‰
- [ ] Storage æœå‹™å·²å•Ÿç”¨
- [ ] Project ID æ­£ç¢º

### âœ… ç€è¦½å™¨æª¢æŸ¥

- [ ] æ¸…é™¤ç·©å­˜
- [ ] é‡æ–°è¼‰å…¥é é¢
- [ ] æª¢æŸ¥æ§åˆ¶å°éŒ¯èª¤
- [ ] ç¢ºèªç¶²è·¯é€£æ¥

### âœ… ç”¨æˆ¶èªè­‰æª¢æŸ¥

- [ ] ç”¨æˆ¶å·²æ­£ç¢ºç™»å…¥
- [ ] èªè­‰ token æœªéæœŸ
- [ ] Firebase Auth æœå‹™æ­£å¸¸

## ğŸ› ï¸ å¦‚æœå•é¡ŒæŒçºŒ

### æ–¹æ³• 1ï¼šæª¢æŸ¥ Storage Bucket

1. åœ¨ Firebase Console > Storage ä¸­ç¢ºèªï¼š
   - Storage bucket åç¨±æ­£ç¢º
   - æœå‹™å·²å•Ÿç”¨
   - å€åŸŸè¨­ç½®æ­£ç¢º

### æ–¹æ³• 2ï¼šæª¢æŸ¥ç¶²è·¯è¨­ç½®

1. ç¢ºèªç¶²è·¯èƒ½æ­£å¸¸è¨ªå• `firebasestorage.googleapis.com`
2. æª¢æŸ¥æ˜¯å¦æœ‰é˜²ç«ç‰†æˆ–ä»£ç†é˜»æ“‹

### æ–¹æ³• 3ï¼šé‡æ–°ä¸Šå‚³é ­åƒ

1. å˜—è©¦é‡æ–°ä¸Šå‚³ä¸€å¼µæ–°çš„é ­åƒ
2. æª¢æŸ¥ä¸Šå‚³éç¨‹æ˜¯å¦æœ‰éŒ¯èª¤
3. è§€å¯Ÿæ§åˆ¶å°çš„èª¿è©¦ä¿¡æ¯

## ğŸ“‹ æˆåŠŸæŒ‡æ¨™

ä¿®å¾©æˆåŠŸå¾Œä½ æ‡‰è©²çœ‹åˆ°ï¼š

- âœ… æ§åˆ¶å°ä¸å†æœ‰ 412 éŒ¯èª¤
- âœ… ç”¨æˆ¶é ­åƒæ­£å¸¸é¡¯ç¤º
- âœ… é ­åƒä¸Šå‚³åŠŸèƒ½æ­£å¸¸
- âœ… å…¶ä»–ç”¨æˆ¶çš„é ­åƒä¹Ÿèƒ½çœ‹åˆ°

## ğŸ”’ å®‰å…¨æ€§èªªæ˜

âš ï¸ **é‡è¦**ï¼šä¸Šé¢çš„è‡¨æ™‚è¦å‰‡æ¯”è¼ƒå¯¬é¬†ï¼Œé©åˆæ¸¬è©¦ä½¿ç”¨ã€‚

æ¸¬è©¦æˆåŠŸå¾Œï¼Œè«‹ä½¿ç”¨ä»¥ä¸‹æ›´å®‰å…¨çš„è¦å‰‡ï¼š

```javascript
rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    match /avatars/{userId}/{allPaths=**} {
      allow read: if request.auth != null;
      allow write: if request.auth != null && request.auth.uid == userId;
      allow get: if request.auth != null;
    }
  }
}
```

## ğŸ†˜ ç·Šæ€¥è¯ç¹«

å¦‚æœä»¥ä¸Šæ­¥é©Ÿéƒ½ç„¡æ³•è§£æ±ºå•é¡Œï¼š

1. æˆªåœ–æ§åˆ¶å°çš„å®Œæ•´éŒ¯èª¤ä¿¡æ¯
2. æˆªåœ– Firebase Console çš„ Storage Rules é é¢
3. æä¾›é …ç›®çš„ Firebase Project ID
4. èªªæ˜å…·é«”çš„æ“ä½œæ­¥é©Ÿå’ŒéŒ¯èª¤ç¾è±¡

## ğŸ”§ èª¿è©¦å‘½ä»¤

åœ¨ç€è¦½å™¨æ§åˆ¶å°å¯ä»¥ä½¿ç”¨çš„èª¿è©¦å‘½ä»¤ï¼š

```javascript
// æª¢æŸ¥èªè­‰ç‹€æ…‹
firebaseDebug.checkAuth();

// æª¢æŸ¥ Storage é€£æ¥
firebaseDebug.checkStorage();

// æ¸¬è©¦ç‰¹å®šé ­åƒ URL
firebaseDebug.testAvatarUrl('ä½ çš„é ­åƒURL');

// å®Œæ•´è¨ºæ–·
firebaseDebug.fullDiagnosis();
```

import{u as B,a as R,j as e}from"./index-CzQucI3b.js";import{d as $,r as f}from"./react-vendor-BToktFYo.js";import{P as T}from"./charts-BNGpwEcn.js";import"./firebase-D0136ThQ.js";function A({onComplete:p}){var I,y;const{userData:a,setUserData:h}=B(),g=$(),{t:s}=R(),[c,v]=f.useState(((y=(I=a.testInputs)==null?void 0:I.ffmi)==null?void 0:y.bodyFat)||""),[m,S]=f.useState(null),[d,L]=f.useState(null),[E,i]=f.useState(""),[u,_]=f.useState(!1),[b,w]=f.useState(!1),[x,j]=f.useState(!1);f.useEffect(()=>{var l;if(c){const n={...a.testInputs,ffmi:{...(l=a.testInputs)==null?void 0:l.ffmi,bodyFat:c}};h(o=>({...o,testInputs:n}))}},[c,h,a.testInputs]);const C=()=>{if(!a.gender||!a.height||!a.weight||!a.age){alert(s("tests.ffmiErrors.missingPrerequisites"));return}if(!c){alert(s("tests.ffmiErrors.missingBodyFat"));return}const l=a.gender==="male"||a.gender==="男性",n=parseFloat(a.height)/100,o=parseFloat(a.weight),F=parseFloat(c)/100,N=o*(1-F)/(n*n),t=n>1.8?N+6*(n-1.8):N;S(t.toFixed(2));let r;l?t<=0?r=0:t<=18.5?r=t/18.5*60:t<28?r=60+(t-18.5)/(28-18.5)*40:r=100:t<=0?r=0:t<=15.5?r=t/15.5*60:t<22?r=60+(t-15.5)/(22-15.5)*40:r=100,L(r.toFixed(2)),l?t<18?i("肌肉量低於平均"):t<20?i("肌肉量在平均值"):t<22?i("肌肉量高於平均值"):t<23?i("肌肉量很高"):t<26?i("肌肉量極高"):t<28?i("肌肉量已經高到可能有使用藥物"):i("不用藥不可能達到的數值"):t<15?i("肌肉量低於平均"):t<17?i("肌肉量在平均值"):t<19?i("肌肉量高於平均值"):t<22?i("肌肉量很高"):i("不用藥不可能達到的數值")},M=async()=>{if(!m||!d){alert(s("tests.ffmiErrors.needCalculate"));return}const l=sessionStorage.getItem("guestMode")==="true";try{if(x)return;j(!0);const n={...a.scores,bodyFat:parseFloat(d)},o={...a,scores:n};h({...o,ladderScore:a.ladderScore||0});const F={bodyFat:parseFloat(c),ffmi:parseFloat(m),ffmiScore:parseFloat(d)};p&&typeof p=="function"&&p(F),g("/user-info",{state:{from:"/body-fat"}})}catch(n){console.error("提交失敗:",n),l||alert(s("tests.ffmiErrors.updateUserFail")),g("/user-info",{state:{from:"/body-fat"}})}finally{j(!1)}},D=[{range:"16 - 17",description:s("tests.ffmiInfo.maleTable.r16_17")},{range:"18 - 19",description:s("tests.ffmiInfo.maleTable.r18_19")},{range:"20 - 21",description:s("tests.ffmiInfo.maleTable.r20_21")},{range:"22",description:s("tests.ffmiInfo.maleTable.r22")},{range:"23 - 25",description:s("tests.ffmiInfo.maleTable.r23_25")},{range:"26 - 27",description:s("tests.ffmiInfo.maleTable.r26_27")},{range:"28 - 30",description:s("tests.ffmiInfo.maleTable.r28_30")}],P=[{range:"13 - 14",description:s("tests.ffmiInfo.femaleTable.r13_14")},{range:"15 - 16",description:s("tests.ffmiInfo.femaleTable.r15_16")},{range:"17 - 18",description:s("tests.ffmiInfo.femaleTable.r17_18")},{range:"19 - 21",description:s("tests.ffmiInfo.femaleTable.r19_21")},{range:"> 22",description:s("tests.ffmiInfo.femaleTable.r22plus")}],k=a.gender==="male"||a.gender==="男性"?D:P;return e.jsxs("div",{className:"ffmi-container",children:[e.jsx("h1",{className:"ffmi-title",children:s("tests.ffmiTitle")}),e.jsxs("div",{className:"input-section",children:[e.jsx("label",{htmlFor:"bodyFat",className:"input-label",children:s("tests.ffmiLabels.bodyFatPercent")}),e.jsx("input",{id:"bodyFat",name:"bodyFat",type:"number",value:c,onChange:l=>v(l.target.value),placeholder:s("tests.ffmiLabels.bodyFatPercent"),className:"input-field",required:!0}),e.jsx("button",{onClick:C,className:"calculate-btn",children:s("common.calculate")})]}),m&&e.jsxs("div",{className:"result-section",children:[e.jsx("h2",{className:"result-title",children:s("tests.ffmiLabels.resultTitle")}),e.jsxs("p",{className:"result-text",children:[s("tests.ffmiLabels.ffmi"),"：",m]}),e.jsxs("p",{className:"score-text",children:[s("tests.ffmiLabels.ffmiScore"),"：",d," 分"]}),e.jsxs("p",{className:"category-text",children:[s("tests.ffmiLabels.ffmiCategory"),"：",E]}),e.jsx("p",{className:"result-text note-text"})]}),e.jsx("div",{className:"description-section",children:e.jsxs("div",{className:"description-card",children:[e.jsxs("div",{className:"description-header",onClick:()=>_(!u),children:[e.jsx("h2",{className:"description-title",children:s("tests.ffmiLabels.whatIs")}),e.jsx("span",{className:`arrow ${u?"expanded":""}`,children:u?"▲":"▼"})]}),u&&e.jsxs("div",{className:"description-content",children:[e.jsx("p",{children:s("tests.ffmiInfo.whatIs")}),e.jsxs("ol",{className:"list-decimal pl-5 mt-2",children:[e.jsx("li",{children:s("tests.ffmiInfo.caveats.tall")}),e.jsx("li",{children:s("tests.ffmiInfo.caveats.highFat")}),e.jsx("li",{children:s("tests.ffmiInfo.caveats.heavy")})]})]})]})}),e.jsx("div",{className:"table-section",children:e.jsxs("div",{className:"table-card",children:[e.jsxs("div",{className:"table-header",onClick:()=>w(!b),children:[e.jsxs("h2",{className:"table-title",children:[s("tests.ffmiLabels.tableTitle")," (",a.gender==="male"||a.gender==="男性"?s("tests.ffmiLabels.male"):s("tests.ffmiLabels.female"),")"]}),e.jsx("span",{className:`arrow ${b?"expanded":""}`,children:b?"▲":"▼"})]}),b&&e.jsx("div",{className:"table-content",children:e.jsxs("table",{className:"ffmi-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:s("tests.ffmiLabels.columns.range")}),e.jsx("th",{children:s("tests.ffmiLabels.columns.evaluation")})]})}),e.jsx("tbody",{children:k.map((l,n)=>e.jsxs("tr",{children:[e.jsx("td",{children:l.range}),e.jsx("td",{children:l.description})]},n))})]})})]})}),e.jsx("button",{type:"button",onClick:M,className:"ffmi-submit-btn",disabled:x,children:s(x?"common.submitting":"common.submitAndReturn")})]})}A.propTypes={onComplete:T.func,clearTestData:T.func};export{A as default};

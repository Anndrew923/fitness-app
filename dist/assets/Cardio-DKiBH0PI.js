import{b as D,u as w,j as e}from"./index-BYqpe2Z4.js";import{d as R,r as m}from"./react-vendor-BToktFYo.js";import{u as U,v as $}from"./standards-Dj82V2Ks.js";import{P as y}from"./charts-BNGpwEcn.js";import"./firebase-D0136ThQ.js";function P({onComplete:f}){var N,I;const{userData:n,setUserData:x}=D(),b=R(),{age:h,gender:l}=n,{t}=w(),[o,C]=m.useState(((I=(N=n.testInputs)==null?void 0:N.cardio)==null?void 0:I.distance)||""),[i,E]=m.useState(null),[u,v]=m.useState(!1),[j,g]=m.useState(!1);m.useEffect(()=>{var r;if(o){const s={...n.testInputs,cardio:{...(r=n.testInputs)==null?void 0:r.cardio,distance:o}};x(a=>({...a,testInputs:s}))}},[o,x,n.testInputs]);const F=r=>{if(!r)return null;const s=parseInt(r);return s>=13&&s<=14?"13-14":s>=15&&s<=16?"15-16":s>=17&&s<=20?"17-20":s>=20&&s<=29?"20-29":s>=30&&s<=39?"30-39":s>=40&&s<=49?"40-49":s>=50?"50+":null},T=(r,s)=>{const a=s[60],c=s[100];return r<=0?0:r<=a?Math.round(r/a*60*100)/100:r>=c?100:Math.round((60+(r-a)/(c-a)*40)*100)/100},M=(r,s)=>{const a=s==="男性"||`${s}`.toLowerCase()==="male"?"male":"female",c=Math.min(100,Math.max(0,Math.floor(r/10)*10)),d=`tests.cardioComments.${a}.r${c}`,p=t("tests.cardioComments.default"),S=t(d);return S===d?p:S},L=()=>{if(!o||!h||!l){alert(t("tests.cardioErrors.missingPrerequisites"));return}const r=parseFloat(o),s=F(h);if(!r||!s){alert(t("tests.cardioErrors.invalidInputs"));return}const d=((l==="男性"||l.toLowerCase()==="male"?"male":"female")==="male"?U:$)[s];if(!d){alert(t("tests.cardioErrors.standardsNotFound"));return}const p=T(r,d);E(p),console.log("Cardio.js - 計算心肺耐力分數:",p,"距離:",r,"年齡段:",s)},k=async()=>{if(!i){alert(t("tests.cardioErrors.needCalculate"));return}const r=sessionStorage.getItem("guestMode")==="true";try{if(j)return;g(!0);const s={...n.scores,cardio:parseFloat(i)},a={...n,scores:s};x({...a,ladderScore:n.ladderScore||0});const c={distance:parseFloat(o),score:parseFloat(i)};f&&typeof f=="function"&&f(c),b("/user-info",{state:{from:"/cardio"}})}catch(s){console.error("提交失敗:",s),r||alert(t("tests.cardioErrors.updateUserFail")),b("/user-info",{state:{from:"/cardio"}})}finally{g(!1)}};return e.jsxs("div",{className:"cardio-container",children:[e.jsxs("div",{className:"input-section",children:[e.jsx("h1",{className:"text-2xl font-bold text-center mb-4",children:t("tests.cardioTitle")}),e.jsxs("p",{children:[t("common.ageLabel"),"：",h||t("common.notEntered")]}),e.jsxs("p",{children:[t("common.genderLabel"),"：",l||t("common.notSelected")]}),e.jsxs("div",{className:"exercise-section",children:[e.jsx("h2",{className:"text-lg font-semibold",children:t("tests.cardioInfo.cooperTitle")}),e.jsx("label",{htmlFor:"distance",className:"block text-sm font-medium text-gray-700",children:t("tests.cardioLabels.distanceMeters")}),e.jsx("input",{id:"distance",name:"distance",type:"number",placeholder:t("tests.cardioLabels.distanceMeters"),value:o,onChange:r=>C(r.target.value),className:"input-field",required:!0}),e.jsx("button",{onClick:L,className:"calculate-btn",children:t("common.calculate")}),i!==null&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"score-display",children:[t("tests.cardioLabels.score"),": ",i]}),e.jsx("p",{className:"score-display",children:M(i,l)})]})]})]}),e.jsx("div",{className:"description-section",children:e.jsxs("div",{className:"description-card",children:[e.jsxs("div",{className:"description-header",onClick:()=>v(!u),children:[e.jsx("h2",{className:"text-lg font-semibold",children:t("tests.cardioInfo.sectionTitle")}),e.jsx("span",{className:`arrow ${u?"expanded":""}`,children:u?"▲":"▼"})]}),u&&e.jsxs("div",{className:"description-content",children:[e.jsx("p",{className:"font-semibold",children:t("tests.cardioInfo.introTitle")}),e.jsx("p",{children:t("tests.cardioInfo.introText")}),e.jsx("p",{className:"font-semibold mt-2",children:t("tests.cardioInfo.measureLabel")}),e.jsxs("ul",{className:"list-disc pl-5",children:[e.jsx("li",{children:t("tests.cardioInfo.items.place")}),e.jsx("li",{children:t("tests.cardioInfo.items.record")}),e.jsx("li",{children:t("tests.cardioInfo.items.warmup")})]}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:t("tests.cardioInfo.sourceNote")})]})]})}),e.jsx("div",{className:"button-group",children:e.jsx("button",{type:"button",onClick:k,className:"submit-btn",disabled:j,children:t(j?"common.submitting":"common.submitAndReturn")})})]})}P.propTypes={onComplete:y.func,clearTestData:y.func};export{P as default};

import{u as Se,a as Z,c as ce,d as X,b as k,g as Ie,j as e,r as Ce,s as we,e as ke,f as Oe}from"./index-BRHfcysQ.js";import{r as l,d as Te,u as Me}from"./react-vendor-BToktFYo.js";import{l as de,s as Le,q as Re,t as Fe,w as qe,v as Ue,x as Ae,y as Ee,z as Pe}from"./firebase-D0136ThQ.js";import{P as d,R as ze,a as Ve,b as Be,c as Ge,d as Je,e as He}from"./charts-BNGpwEcn.js";const q={strength:0,explosivePower:0,cardio:0,muscleMass:0,bodyFat:0},We=["male","female"],ue=({isOpen:u,onClose:S,title:v,message:s,type:c="info",onAction:j=null,actionText:h=null})=>{if(!u)return null;const{t:N}=Z(),t=()=>{switch(c){case"warning":return"⚠️";case"success":return"✅";case"error":return"❌";default:return"ℹ️"}},x=()=>{switch(c){case"warning":return"modal-btn modal-btn-warning";case"success":return"modal-btn modal-btn-success";case"error":return"modal-btn modal-btn-error";default:return"modal-btn modal-btn-info"}},g=()=>{console.log("Modal close button clicked"),S()},y=()=>{console.log("Modal overlay clicked"),S()},I=()=>{j&&j(),S()};return e.jsx("div",{className:"modal-overlay",onClick:y,children:e.jsxs("div",{className:"modal-content",onClick:C=>C.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("span",{className:"modal-icon",children:t()}),e.jsx("h3",{className:"modal-title",children:v})]}),e.jsx("div",{className:"modal-body",children:e.jsx("p",{className:"modal-message",children:s})}),e.jsx("div",{className:"modal-footer",children:j&&h?e.jsxs("div",{className:"modal-footer-actions",children:[e.jsx("button",{className:"modal-btn modal-btn-secondary",onClick:g,children:N("common.cancel")}),e.jsx("button",{className:x(),onClick:I,style:{position:"relative",zIndex:10001},children:h||N("common.confirm")})]}):e.jsx("button",{className:x(),onClick:g,style:{position:"relative",zIndex:10001},children:N("common.confirm")})})]})})};ue.propTypes={isOpen:d.bool.isRequired,onClose:d.func.isRequired,title:d.string.isRequired,message:d.string.isRequired,type:d.oneOf(["info","warning","success","error"]),onAction:d.func,actionText:d.string};const Q=({isOpen:u,onConfirm:S,onCancel:v,remainingCount:s})=>{if(!u)return null;const{t:c}=Z(),j=h=>{h.target===h.currentTarget&&v()};return e.jsx("div",{className:"modal-overlay submit-confirm-overlay",onClick:j,children:e.jsxs("div",{className:"modal-content submit-confirm-content",onClick:h=>h.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("span",{className:"modal-icon",children:"🏆"}),e.jsx("h3",{className:"modal-title",children:c("userInfo.submitConfirm.title")})]}),e.jsx("div",{className:"modal-body",children:e.jsxs("div",{className:"submit-confirm-message",children:[e.jsxs("p",{className:"confirm-text",children:[c("userInfo.submitConfirm.descPrefix")," ",e.jsx("span",{className:"remaining-count",children:s})," ",c("userInfo.submitConfirm.descSuffix")]}),e.jsxs("div",{className:"confirm-details",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-icon",children:"📊"}),e.jsx("span",{className:"detail-text",children:c("userInfo.submitConfirm.ensureAccuracy")})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-icon",children:"⏰"}),e.jsx("span",{className:"detail-text",children:c("userInfo.submitConfirm.resetDaily")})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-icon",children:"🎯"}),e.jsx("span",{className:"detail-text",children:c("userInfo.submitConfirm.improveValue")})]})]})]})}),e.jsxs("div",{className:"modal-footer submit-confirm-footer",children:[e.jsx("button",{className:"modal-btn modal-btn-secondary",onClick:v,children:c("userInfo.submitConfirm.cancel")}),e.jsx("button",{className:"modal-btn modal-btn-success",onClick:S,children:c("userInfo.submitConfirm.confirm")})]})]})})};Q.propTypes={isOpen:d.bool.isRequired,onConfirm:d.func.isRequired,onCancel:d.func.isRequired,remainingCount:d.number.isRequired};async function Ye(u,S=300*1024,v=192,s=192){return new Promise((c,j)=>{const h=new window.Image,N=new FileReader;N.onload=t=>{h.src=t.target.result},h.onload=()=>{const t=document.createElement("canvas");let x=h.width,g=h.height;(x>v||g>s)&&(x>g?(g=Math.round(g*v/x),x=v):(x=Math.round(x*s/g),g=s)),t.width=x,t.height=g,t.getContext("2d").drawImage(h,0,0,x,g),t.toBlob(I=>{I.size>S?t.toBlob(C=>{c(C)},"image/jpeg",.7):c(I)},"image/jpeg",.85)},h.onerror=j,N.onerror=j,N.readAsDataURL(u)})}function _e({testData:u,onLogout:S,clearTestData:v}){const{userData:s,setUserData:c,saveHistory:j,loadUserData:h,isLoading:N}=Se(),{t}=Z(),[x,g]=l.useState(null),[y,I]=l.useState(!1),[C,me]=l.useState(null),[H,fe]=l.useState(!1),O=Te(),W=Me(),U=l.useRef(null),Y=l.useRef(null),B=l.useRef(null),[ee,_]=l.useState(!1),[se,F]=l.useState(null),ae=l.useRef(null),[T,m]=l.useState({isOpen:!1,title:"",message:"",type:"info",onAction:null,actionText:null}),[he,A]=l.useState(null),[E,K]=l.useState({lastSubmissionTime:null,dailySubmissionCount:0,lastSubmissionDate:null}),[P,$]=l.useState({isOpen:!1,remainingCount:3}),ne=l.useCallback(()=>{const a=3-(E.dailySubmissionCount||0);$({isOpen:!0,remainingCount:Math.max(0,a)})},[E]),te=l.useCallback(async()=>{if($({isOpen:!1,remainingCount:0}),!y)try{I(!0);const a=s.scores||{},n=ce(a),r={...s,ladderScore:n,lastLadderSubmission:new Date().toISOString()};c(r);try{const i={...s,ladderScore:n,lastLadderSubmission:new Date().toISOString(),updatedAt:new Date().toISOString()};localStorage.setItem("userData",JSON.stringify(i)),localStorage.setItem("lastSavedUserData",JSON.stringify(i));const f=de(X,"users",k.currentUser.uid);await Le(f,{ladderScore:n,lastLadderSubmission:new Date().toISOString(),updatedAt:new Date().toISOString()},{merge:!0}),console.log("天梯分數已立即保存到 Firebase:",n)}catch(i){throw console.error("保存天梯分數失敗:",i),i}const o=new Date;K(i=>({lastSubmissionTime:o,dailySubmissionCount:i.dailySubmissionCount+1,lastSubmissionDate:o.toDateString()})),m({isOpen:!0,title:t("userInfo.modal.submitSuccessTitle"),message:t("userInfo.modal.submitSuccessMessage",{score:n}),type:"success",onAction:()=>{m(i=>({...i,isOpen:!1})),O("/ladder",{state:{forceReload:!0,from:"/user-info",timestamp:Date.now()}})},actionText:t("userInfo.modal.viewLadder")}),setTimeout(()=>{m(i=>({...i,isOpen:!1}))},5e3)}catch(a){console.error("提交到天梯失敗:",a),m({isOpen:!0,title:t("userInfo.modal.submitFailTitle"),message:t("userInfo.modal.submitFailMessage"),type:"error"})}finally{I(!1)}},[s.scores,c,y,O]),re=l.useCallback(()=>{$({isOpen:!1,remainingCount:0})},[]),ge=l.useCallback(async()=>{if(!k.currentUser){m({isOpen:!0,title:"需要登入",message:"請先登入以提交到天梯",type:"warning"});return}const a=s.scores||{},n=Object.values(a).filter(r=>r>0).length;if(n<5){m({isOpen:!0,title:"評測未完成",message:`請先完成全部5項評測（目前完成 ${n}/5 項）`,type:"warning"});return}ne()},[s,ne,m]),oe=l.useMemo(()=>{const a=s.scores||q;return[{name:t("userInfo.radarLabels.strength"),value:a.strength?Number(a.strength).toFixed(2)*1:0,icon:"💪"},{name:t("userInfo.radarLabels.explosivePower"),value:a.explosivePower?Number(a.explosivePower).toFixed(2)*1:0,icon:"⚡"},{name:t("userInfo.radarLabels.cardio"),value:a.cardio?Number(a.cardio).toFixed(2)*1:0,icon:"❤️"},{name:t("userInfo.radarLabels.muscle"),value:a.muscleMass?Number(a.muscleMass).toFixed(2)*1:0,icon:"🥩"},{name:t("userInfo.radarLabels.ffmi"),value:a.bodyFat?Number(a.bodyFat).toFixed(2)*1:0,icon:"📊"}]},[s.scores]),M=l.useMemo(()=>sessionStorage.getItem("guestMode")==="true",[]),ie=({payload:a,x:n,y:r})=>{const o=oe.find(w=>w.name===a.value);let i=n,f=r;const p=Math.sqrt(n*n+r*r),b=Math.atan2(r,n);return a.value===t("userInfo.radarLabels.strength")?(i=n,f=r-p*.12):a.value===t("userInfo.radarLabels.explosivePower")?(i=n+Math.cos(b)*(p*.03),f=r+Math.sin(b)*(p*.06)):a.value===t("userInfo.radarLabels.ffmi")?(i=n+Math.cos(b)*(p*-.2),f=r+Math.sin(b)*(p*.06)):a.value===t("userInfo.radarLabels.cardio")?(i=n+Math.cos(b)*(p*.01),f=r+Math.sin(b)*(p*.06)):a.value===t("userInfo.radarLabels.muscle")?(i=n+Math.cos(b)*(p*-.05),f=r+Math.sin(b)*(p*.06)):(i=n+Math.cos(b)*(p*.1),f=r+Math.sin(b)*(p*.1)),e.jsxs("g",{transform:`translate(${i},${f})`,children:[e.jsx("defs",{children:e.jsxs("filter",{id:"glow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[e.jsx("feGaussianBlur",{stdDeviation:"3",result:"coloredBlur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"coloredBlur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),e.jsx("circle",{cx:0,cy:0,r:16,fill:"rgba(129, 216, 208, 0.1)",filter:"url(#glow)"}),e.jsx("circle",{cx:0,cy:0,r:14,fill:"rgba(255, 255, 255, 0.95)",stroke:"rgba(129, 216, 208, 0.4)",strokeWidth:2,filter:"drop-shadow(0 2px 4px rgba(129, 216, 208, 0.2))"}),e.jsx("text",{x:0,y:-8,textAnchor:"middle",fill:"#4a5568",fontSize:"16",fontWeight:"600",dominantBaseline:"middle",filter:"drop-shadow(0 1px 2px rgba(0, 0, 0, 0.1))",children:o==null?void 0:o.icon}),e.jsx("text",{x:0,y:12,textAnchor:"middle",fill:"#2d3748",fontSize:"13",fontWeight:"700",dominantBaseline:"middle",filter:"drop-shadow(0 1px 3px rgba(255, 255, 255, 0.9))",children:a.value})]})};ie.propTypes={payload:d.shape({value:d.string.isRequired}).isRequired,x:d.number.isRequired,y:d.number.isRequired},l.useEffect(()=>{if(!k){g("無法初始化身份驗證，請檢查 Firebase 配置並稍後再試。"),console.error("auth 未初始化");return}const a=k.onAuthStateChanged(n=>{console.log("UserInfo - 認證狀態變更:",n==null?void 0:n.email),me(n),!n&&!M&&O("/login")});return()=>a()},[]),l.useEffect(()=>{(async()=>{C&&!H&&!N&&(console.log("UserInfo - 檢查資料載入狀態"),!s.height&&!s.weight&&!s.age&&(console.log("UserInfo - 資料為空，嘗試重新載入"),await h(C,!0)),fe(!0))})()},[C,H,N,h,s.height,s.weight,s.age]),l.useEffect(()=>{var o,i;const a=["/strength","/explosive-power","/cardio","/muscle-mass","/body-fat"],n=(o=W.state)==null?void 0:o.from;n&&a.includes(n)&&setTimeout(()=>{U.current&&U.current.scrollIntoView({behavior:"smooth",block:"center"})},300);const r=(i=W.state)==null?void 0:i.scrollTo;r&&setTimeout(()=>{r==="radar"&&U.current?U.current.scrollIntoView({behavior:"smooth",block:"center"}):r==="tests"&&Y.current&&Y.current.scrollIntoView({behavior:"smooth",block:"start"})},300)},[W]),l.useEffect(()=>{(()=>{try{const n=localStorage.getItem("ladderSubmissionState");if(n){const r=JSON.parse(n),o=new Date().toDateString();r.lastSubmissionDate!==o?K({lastSubmissionTime:null,dailySubmissionCount:0,lastSubmissionDate:o}):K(r)}}catch(n){console.error("載入提交狀態失敗:",n)}})()},[]),l.useEffect(()=>{E.lastSubmissionDate&&localStorage.setItem("ladderSubmissionState",JSON.stringify(E))},[E]),l.useEffect(()=>{if(u&&Object.keys(u).length>0){console.log("收到測試數據:",u);const a=JSON.stringify(u);if(ae.current===a)return;ae.current=a;const n=setTimeout(()=>{c(r=>{const i={...r.scores||q,...u.distance!==void 0&&{cardio:u.score||0},...u.squat!==void 0&&{strength:u.averageScore||0},...(u.finalScore!==void 0||u.verticalJump!==void 0||u.standingLongJump!==void 0||u.sprint!==void 0)&&{explosivePower:u.finalScore||0},...u.smm!==void 0&&{muscleMass:u.finalScore||0},...u.bodyFat!==void 0&&{bodyFat:u.ffmiScore||0}};return console.log("💾 防抖後更新測試數據分數（5秒防抖）"),{...r,scores:i,ladderScore:r.ladderScore||0}})},5e3);return v&&setTimeout(v,6e3),()=>clearTimeout(n)}},[u,v]);const G=l.useCallback(()=>{const{height:a,weight:n,age:r,gender:o}=s;return!a||!n||!r||!o?(g(t("errors.required")),!1):a<=0||n<=0||r<=0?(g(t("userInfo.modal.invalidPositive")),!1):We.includes(o)?!0:(g(t("userInfo.modal.invalidGender")),!1)},[s]),pe=l.useCallback(async a=>{if(a.preventDefault(),g(null),I(!0),!G()){I(!1);return}const n={...s,height:Number(s.height)||0,weight:Number(s.weight)||0,age:Number(s.age)||0,gender:s.gender,scores:s.scores||q,ladderScore:s.ladderScore||0,lastActive:new Date().toISOString()};try{c(n),m({isOpen:!0,title:t("userInfo.modal.saveSuccessTitle"),message:t("userInfo.modal.saveSuccessMessage"),type:"success"})}catch(r){m(M?{isOpen:!0,title:"訪客模式",message:"訪客模式下無法保存到雲端，但您現在可以開始進行評測了！",type:"info"}:{isOpen:!0,title:"儲存失敗",message:`儲存失敗：${r.message}`,type:"error"})}finally{I(!1)}},[s,G,M,c]),z=l.useMemo(()=>{const a=(s==null?void 0:s.scores)||q,n=Object.values(a).filter(o=>o>0);return n.length?(n.reduce((o,i)=>o+Number(i),0)/n.length).toFixed(2):0},[s==null?void 0:s.scores]),D=l.useMemo(()=>{const a=(s==null?void 0:s.scores)||q;return ce(a)},[s==null?void 0:s.scores]),L=(s==null?void 0:s.ladderScore)||0,J=l.useMemo(()=>{const a=(s==null?void 0:s.scores)||q,n=Object.values(a).filter(o=>o>0).length;return{completedCount:n,isFullyCompleted:n===5,progress:n/5*100}},[s==null?void 0:s.scores]),le=l.useCallback(async()=>{if(!(s!=null&&s.userId)||!L||L<=0){A(null);return}try{const a=Re(X,"users"),n=Fe(a,qe("ladderScore",">",0),Ue("ladderScore","desc"),Ae(100)),r=await Ee(n),o=[];r.forEach(f=>{const p=f.data();p.ladderScore>0&&o.push({id:f.id,...p})});const i=o.findIndex(f=>f.id===s.userId);A(i!==-1?i+1:null)}catch(a){console.error("獲取用戶排名失敗:",a),A(null)}},[s==null?void 0:s.userId,L,A]);l.useEffect(()=>{le()},[le,c]);const xe=l.useCallback(a=>{const n=a.target.value,r=/[\u4e00-\u9fff]/.test(n);let o=!0,i="";if(r?n.length>8&&(o=!1,i="暱稱不能超過8個中文字"):n.length>16&&(o=!1,i="暱稱不能超過16個英文字元"),!o){m({isOpen:!0,title:"字數限制",message:i,type:"warning"});return}c(f=>({...f,nickname:n})),B.current&&clearTimeout(B.current),B.current=setTimeout(()=>{B.current=null},1e3)},[c,m]),be=l.useCallback(()=>{var r;const a=(r=k.currentUser)==null?void 0:r.email,n=Ie(a);c(o=>({...o,nickname:n,ladderScore:o.ladderScore||0}))},[c]),ve=l.useCallback(()=>{if(!k.currentUser){m({isOpen:!0,title:"需要登入",message:"請先登入以儲存結果",type:"warning"});return}const a={date:new Date().toLocaleDateString("zh-TW"),scores:s.scores,averageScore:z};j(a),m({isOpen:!0,title:t("userInfo.modal.resultSaveSuccessTitle"),message:t("userInfo.modal.resultSaveSuccessMessage"),type:"success"}),setTimeout(()=>{m(n=>({...n,isOpen:!1}))},2e3)},[s.scores,z,j,m]),V=l.useCallback(async a=>{if(!s.height||!s.weight||!s.age||!s.gender){m({isOpen:!0,title:"需要基本資料",message:"請先填寫並儲存您的身高、體重、年齡和性別，才能開始評測！",type:"warning"});return}G()?O(a,{state:{from:"/user-info"}}):m({isOpen:!0,title:"資料未保存",message:"請確保資料已正確保存後再進行評測！",type:"warning"})},[s,G,O,m]),je=l.useCallback(()=>{localStorage.removeItem("savedEmail"),localStorage.removeItem("savedPassword"),k.currentUser&&k.signOut().catch(a=>console.error("登出失敗:",a)),S(),O("/login")},[S,O]),R=l.useCallback(a=>{const{name:n,value:r}=a.target;let o=r;n==="gender"||["profession"].includes(n)?o=r:["weeklyTrainingHours","trainingYears"].includes(n)?o=r===""?"":Number(r):o=r===""?0:Number(r),c(i=>({...i,[n]:o,ladderScore:i.ladderScore||0}))},[c]),Ne=async a=>{var r;F(null);const n=a.target.files[0];if(n){if(!n.type.startsWith("image/")){F("請選擇圖片檔案");return}if(n.size>2*1024*1024){F("圖片大小請勿超過 2MB");return}_(!0);try{const o=await Ye(n,307200,192,192);if(o.size>350*1024){F("壓縮後圖片仍超過 350KB，請選擇更小的圖片"),_(!1);return}const i=(r=k.currentUser)==null?void 0:r.uid;if(!i)throw new Error("未登入，無法上傳頭像");console.log("🔧 開始上傳頭像:",{userId:i,fileSize:o.size});const f=Ce(we,`avatars/${i}/avatar.jpg`),p={contentType:"image/jpeg",customMetadata:{"uploaded-by":i,"upload-time":new Date().toISOString()}};await ke(f,o,p),console.log("✅ 頭像上傳成功");const b=await Oe(f);console.log("✅ 獲取下載 URL 成功:",b),c(w=>({...w,avatarUrl:b,ladderScore:w.ladderScore||0}));try{const w=de(X,"users",i);await Pe(w,{avatarUrl:b,updatedAt:new Date().toISOString()}),console.log("頭像已立即保存到 Firebase"),m({isOpen:!0,title:"頭像上傳成功",message:"您的頭像已成功更新！",type:"success"}),setTimeout(()=>{m(ye=>({...ye,isOpen:!1}))},2e3)}catch(w){console.error("頭像保存到 Firebase 失敗:",w),F("頭像保存失敗: "+w.message)}}catch(o){F("頭像上傳失敗: "+o.message)}finally{_(!1)}}};return N&&!H?e.jsx("div",{className:"user-info-container",children:e.jsx("div",{className:"loading-message",children:e.jsx("p",{children:t("common.loading")})})}):e.jsxs("div",{className:"user-info-container",children:[e.jsx(ue,{isOpen:T.isOpen,onClose:()=>{console.log("Modal onClose triggered, current state:",T),m(a=>(console.log("Setting modal state to closed"),{...a,isOpen:!1}))},title:T.title,message:T.message,type:T.type,onAction:T.onAction,actionText:T.actionText}),e.jsx(Q,{isOpen:P.isOpen,onConfirm:te,onCancel:re,remainingCount:P.remainingCount}),x&&e.jsx("p",{className:"error-message",children:x}),e.jsxs("div",{className:"avatar-section",children:[e.jsx("div",{className:"avatar-container",children:e.jsx("img",{src:M?"/guest-avatar.svg":(s==null?void 0:s.avatarUrl)||"/default-avatar.svg",alt:t("community.ui.avatarAlt"),className:"user-avatar",loading:"lazy",onError:a=>{a.target.src="/default-avatar.svg"}})}),e.jsxs("div",{className:"avatar-actions-container",children:[!M&&e.jsxs("label",{className:"avatar-upload-label",children:[t(ee?"userInfo.avatar.uploading":"userInfo.avatar.change"),e.jsx("input",{type:"file",accept:"image/*",style:{display:"none"},onChange:Ne,disabled:ee})]}),M&&e.jsx("div",{className:"guest-avatar-note",children:e.jsx("span",{children:"訪客模式"})})]}),se&&e.jsx("div",{className:"avatar-error",children:se})]}),(C||M)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{className:"page-title",children:t("userInfo.title")}),e.jsx("div",{className:"page-subtitle",children:t("userInfo.subtitle")})]}),e.jsx("div",{className:"form-card",children:e.jsxs("form",{className:"user-form",onSubmit:pe,children:[e.jsxs("div",{className:"form-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h3",{className:"section-title",children:t("userInfo.basicInfo")}),C&&e.jsx("button",{type:"button",onClick:je,title:"登出",className:"user-info__logout-btn",onMouseEnter:a=>{const n=document.createElement("div");n.innerText="登出",n.style.position="absolute",n.style.bottom="44px",n.style.left="50%",n.style.transform="translateX(-50%)",n.style.background="rgba(60,60,60,0.95)",n.style.color="#fff",n.style.padding="6px 14px",n.style.borderRadius="6px",n.style.fontSize="13px",n.style.whiteSpace="nowrap",n.style.pointerEvents="none",n.style.zIndex="1001",n.className="logout-tooltip",a.currentTarget.parentNode.appendChild(n)},onMouseLeave:a=>{const n=a.currentTarget.parentNode.querySelector(".logout-tooltip");n&&n.remove()},children:e.jsx("span",{className:"user-info__logout-icon",children:"⎋"})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"nickname",className:"form-label",children:t("userInfo.nickname")}),e.jsxs("div",{className:"nickname-input-group",children:[e.jsx("input",{id:"nickname",name:"nickname",type:"text",value:(s==null?void 0:s.nickname)||"",onChange:xe,placeholder:t("userInfo.nicknamePlaceholder"),className:"form-input",maxLength:"16"}),e.jsx("button",{type:"button",onClick:be,className:"generate-nickname-btn",children:t("userInfo.generateNickname")})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"gender",className:"form-label",children:t("userInfo.gender")}),e.jsxs("select",{id:"gender",name:"gender",value:(s==null?void 0:s.gender)||"",onChange:R,className:"form-input",required:!0,onInvalid:a=>a.currentTarget.setCustomValidity(t("errors.required")),onInput:a=>a.currentTarget.setCustomValidity(""),children:[e.jsx("option",{value:"",children:t("userInfo.selectGender")}),e.jsx("option",{value:"male",children:t("userInfo.male")}),e.jsx("option",{value:"female",children:t("userInfo.female")})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"age",className:"form-label",children:t("userInfo.age")}),e.jsx("input",{id:"age",name:"age",type:"number",value:(s==null?void 0:s.age)||"",onChange:R,placeholder:t("userInfo.age"),className:"form-input",required:!0,onInvalid:a=>a.currentTarget.setCustomValidity(t("errors.required")),onInput:a=>a.currentTarget.setCustomValidity(""),min:"0",step:"1"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"height",className:"form-label",children:t("userInfo.height")}),e.jsx("input",{id:"height",name:"height",type:"number",value:(s==null?void 0:s.height)||"",onChange:R,placeholder:t("userInfo.height"),className:"form-input",required:!0,onInvalid:a=>a.currentTarget.setCustomValidity(t("errors.required")),onInput:a=>a.currentTarget.setCustomValidity(""),min:"0",step:"0.1"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"weight",className:"form-label",children:t("userInfo.weight")}),e.jsx("input",{id:"weight",name:"weight",type:"number",value:(s==null?void 0:s.weight)||"",onChange:R,placeholder:t("userInfo.weight"),className:"form-input",required:!0,onInvalid:a=>a.currentTarget.setCustomValidity(t("errors.required")),onInput:a=>a.currentTarget.setCustomValidity(""),min:"0",step:"0.1"})]})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsxs("h3",{className:"section-title",children:["🏆 ",t("userInfo.ladder.title")]}),e.jsx("div",{className:"privacy-options",children:e.jsxs("label",{className:"privacy-option",children:[e.jsx("input",{type:"checkbox",checked:s.isAnonymousInLadder===!0,onChange:a=>c(n=>({...n,isAnonymousInLadder:a.target.checked}))}),e.jsxs("div",{className:"privacy-option-content",children:[e.jsx("span",{className:"privacy-option-title",children:t("userInfo.ladder.anonymousTitle")}),e.jsx("span",{className:"privacy-option-desc",children:t("userInfo.ladder.anonymousDesc")})]})]})}),e.jsxs("div",{className:"training-info-section",children:[e.jsxs("h4",{className:"training-info-title",children:["💪 ",t("userInfo.training.title")]}),e.jsx("p",{className:"training-info-desc",children:t("userInfo.training.desc")}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"profession",className:"form-label",children:t("userInfo.training.profession")}),e.jsx("input",{id:"profession",name:"profession",type:"text",value:(s==null?void 0:s.profession)||"",onChange:R,placeholder:t("userInfo.placeholders.profession"),className:"form-input",maxLength:"100"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"weeklyTrainingHours",className:"form-label",children:t("userInfo.training.weeklyHours")}),e.jsx("input",{id:"weeklyTrainingHours",name:"weeklyTrainingHours",type:"number",value:(s==null?void 0:s.weeklyTrainingHours)||"",onChange:R,placeholder:t("userInfo.placeholders.hours"),className:"form-input",min:"0",max:"168",step:"0.5"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"trainingYears",className:"form-label",children:t("userInfo.training.years")}),e.jsx("input",{id:"trainingYears",name:"trainingYears",type:"number",value:(s==null?void 0:s.trainingYears)||"",onChange:R,placeholder:t("userInfo.placeholders.years"),className:"form-input",min:"0",max:"50",step:"0.5"})]})]})]}),e.jsx("div",{className:"form-actions",children:e.jsx("button",{type:"submit",className:"submit-btn",disabled:y,children:t(y?"userInfo.saving":"userInfo.saveData")})})]})})]}),e.jsx("div",{id:"radar-section",className:"radar-section",ref:U,children:e.jsxs("div",{className:"radar-card",children:[e.jsx("div",{className:"corner-decoration top-left"}),e.jsx("div",{className:"corner-decoration top-right"}),e.jsx("div",{className:"corner-decoration bottom-left"}),e.jsx("div",{className:"corner-decoration bottom-right"}),e.jsx("h2",{className:"radar-title",children:t("userInfo.radarOverview")}),y?e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"正在載入數據..."})]}):e.jsx("div",{className:"radar-chart-container",children:e.jsx(ze,{width:"100%",height:400,children:e.jsxs(Ve,{data:oe,children:[e.jsx(Be,{gridType:"polygon",stroke:"rgba(129, 216, 208, 0.25)",strokeWidth:2,strokeDasharray:"4 4"}),e.jsx(Ge,{dataKey:"name",tick:e.jsx(ie,{}),axisLine:!1}),e.jsx(Je,{angle:90,domain:[0,100],tickCount:5,tick:{fontSize:12,fill:"#2d3748",fontWeight:600},axisLine:!1}),e.jsx(He,{name:t("userInfo.yourPerformance"),dataKey:"value",stroke:"#81D8D0",fill:"url(#tiffanyGradient)",fillOpacity:.8,strokeWidth:4,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("defs",{children:e.jsxs("linearGradient",{id:"tiffanyGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#81D8D0",stopOpacity:.9}),e.jsx("stop",{offset:"50%",stopColor:"#5F9EA0",stopOpacity:.7}),e.jsx("stop",{offset:"100%",stopColor:"#81D8D0",stopOpacity:.6})]})})]})})}),!y&&e.jsxs("div",{className:"score-section",children:[z>0&&e.jsxs("div",{className:"average-score-display",children:[e.jsxs("p",{className:"average-score",children:["⭐ ",t("userInfo.powerTitle")," ",e.jsx("span",{className:"score-value-large",children:z})]}),J.isFullyCompleted&&e.jsxs("div",{className:"ladder-info",children:[e.jsxs("p",{className:"ladder-rank",children:["🏆 ",t("userInfo.ladder.rankLabel"),":"," ",e.jsx("span",{className:"rank-value",children:he||"未上榜"})]}),L>0&&e.jsxs("p",{className:"submitted-score",children:[t("userInfo.ladder.submittedScore"),":"," ",e.jsx("span",{className:"score-value",children:L})]}),D>0&&D!==L&&e.jsxs("p",{className:"current-score",children:[t("userInfo.ladder.currentScore"),":"," ",e.jsx("span",{className:"score-value",children:D}),e.jsx("span",{className:"score-note",children:t("userInfo.ladder.needsSubmit")})]})]})]}),e.jsxs("div",{className:"action-buttons-section",children:[z>0&&e.jsxs("button",{onClick:ve,className:"action-btn save-results-btn",disabled:y,children:[e.jsx("span",{className:"btn-icon",children:"💾"}),e.jsx("span",{className:"btn-text",children:t("userInfo.saveResults")})]}),J.isFullyCompleted&&e.jsxs("button",{onClick:ge,className:"action-btn submit-ladder-btn",disabled:y,children:[e.jsx("span",{className:"btn-icon",children:"🏆"}),e.jsx("span",{className:"btn-text",children:L>0?t("userInfo.updateLadderScore"):t("userInfo.submitToLadder")})]})]}),e.jsx("div",{className:"ladder-info-card",children:e.jsx("p",{className:"ladder-info-text",children:J.isFullyCompleted?t("userInfo.ladder.ctaCompleted"):t("userInfo.ladder.ctaNotCompleted",{count:J.completedCount})})})]})]})}),e.jsxs("div",{className:"test-buttons-section",ref:Y,children:[e.jsx("h3",{className:"section-title",children:t("userInfo.startTests")}),e.jsxs("div",{className:"test-buttons-grid",children:[e.jsxs("button",{onClick:()=>V("/strength"),className:"test-btn strength-btn",children:[e.jsx("span",{className:"test-icon",children:"💪"}),e.jsx("span",{className:"test-label",children:t("tests.strength")})]}),e.jsxs("button",{onClick:()=>V("/explosive-power"),className:"test-btn explosive-btn",children:[e.jsx("span",{className:"test-icon",children:"⚡"}),e.jsx("span",{className:"test-label",children:t("tests.explosivePower")})]}),e.jsxs("button",{onClick:()=>V("/cardio"),className:"test-btn cardio-btn",children:[e.jsx("span",{className:"test-icon",children:"❤️"}),e.jsx("span",{className:"test-label",children:t("tests.cardio")})]}),e.jsxs("button",{onClick:()=>V("/muscle-mass"),className:"test-btn muscle-btn",children:[e.jsx("span",{className:"test-icon",children:"🥩"}),e.jsx("span",{className:"test-label",children:t("tests.muscleMass")})]}),e.jsxs("button",{onClick:()=>V("/body-fat"),className:"test-btn bodyfat-btn",children:[e.jsx("span",{className:"test-icon",children:"📊"}),e.jsx("span",{className:"test-label",children:t("tests.bodyFat")})]})]})]}),P.isOpen&&e.jsx(Q,{isOpen:P.isOpen,onConfirm:te,onCancel:re,remainingCount:P.remainingCount})]})}_e.propTypes={testData:d.shape({distance:d.number,score:d.number,squat:d.number,averageScore:d.number,jumpHeight:d.number,finalScore:d.number,smm:d.number,bodyFat:d.number,ffmiScore:d.number}),onLogout:d.func.isRequired,clearTestData:d.func.isRequired};export{_e as default};

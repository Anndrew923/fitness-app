import{b as Y,u as q,j as e}from"./index-B4EY2K7T.js";import{d as $,r as h}from"./react-vendor-BToktFYo.js";import{C as H,D as J,E as O,F as Q}from"./standards-Dj82V2Ks.js";import{R as E,B as C,C as D,X as I,Y as T,T as w,L as W,f as R,P as k}from"./charts-BNGpwEcn.js";import"./firebase-D0136ThQ.js";function Z({onComplete:p}){var v,P;const{userData:c,setUserData:S}=Y(),g=$(),{weight:u,age:x,gender:d}=c,{t:s}=q(),[m,K]=h.useState(((P=(v=c.testInputs)==null?void 0:v.muscle)==null?void 0:P.smm)||""),[r,B]=h.useState({smmScore:null,smPercent:null,smPercentScore:null,finalScore:null}),[b,N]=h.useState(!1);h.useEffect(()=>{var a;if(m){const t={...c.testInputs,muscle:{...(a=c.testInputs)==null?void 0:a.muscle,smm:m}};S(l=>({...l,testInputs:t}))}},[m,S,c.testInputs]);const A=a=>{if(!a)return null;const t=parseInt(a);return t>=10&&t<=12?"10-12":t>=13&&t<=17?"13-17":t>=18&&t<=30?"18-30":t>=31&&t<=40?"31-40":t>=41&&t<=50?"41-50":t>=51&&t<=60?"51-60":t>=61&&t<=70?"61-70":t>=71&&t<=80?"71-80":null},L=(a,t)=>{if(a>=t[100])return 100;if(a<=t[0])return 0;let l=0,n=100;for(let o=10;o<=100;o+=10)if(a<t[o]){n=o,l=o-10;break}const i=t[l],f=t[n];if(f===i)return n;const j=l+(a-i)/(f-i)*(n-l);return Math.round(j*100)/100},U=()=>{if(!u||!m||!x||!d){alert(s("tests.muscleErrors.missingPrerequisites"));return}const a=parseFloat(u),t=parseFloat(m),l=A(x);if(!a||!t||!l){alert(s("tests.muscleErrors.invalidInputs"));return}const n=(t/a*100).toFixed(2),i=d==="男性"||d.toLowerCase()==="male"?"male":"female",f=i==="male"?H:J,j=i==="male"?O:Q,o=f[l],F=j[l];if(!o||!F){alert(s("tests.muscleErrors.standardsNotFound"));return}const y=L(t,o),M=L(parseFloat(n),F),X=((y+M)/2).toFixed(2);B({smmScore:y,smPercent:n,smPercentScore:M,finalScore:X})},V=async()=>{if(!r.finalScore){alert(s("tests.muscleErrors.needCalculate"));return}const a=sessionStorage.getItem("guestMode")==="true";try{if(b)return;N(!0);const t={...c.scores,muscleMass:parseFloat(r.finalScore)},l={...c,scores:t};S({...l,ladderScore:c.ladderScore||0});const n={smm:parseFloat(m),smPercent:parseFloat(r.smPercent),finalScore:parseFloat(r.finalScore)};p&&typeof p=="function"&&p(n),g("/user-info",{state:{from:"/muscle-mass"}})}catch(t){console.error("提交失敗:",t),a||alert(s("tests.muscleErrors.updateUserFail")),g("/user-info",{state:{from:"/muscle-mass"}})}finally{N(!1)}},z=[{name:s("tests.muscleLabels.smmShort"),value:r.smmScore||0},{name:s("tests.muscleLabels.smPercentShort"),value:r.smPercentScore||0}],G=[{name:s("tests.muscleLabels.finalScore"),value:r.finalScore||0}];return e.jsxs("div",{className:"muscle-container",children:[e.jsx("h1",{children:s("tests.muscleTitle")}),e.jsxs("div",{className:"input-section",children:[e.jsxs("p",{className:"result-text",children:[s("common.weightLabel"),"：",u?`${u} kg`:s("common.notEntered")]}),e.jsxs("p",{className:"result-text",children:[s("common.ageLabel"),"：",x||s("common.notEntered")]}),e.jsxs("p",{className:"result-text",children:[s("common.genderLabel"),"：",d||s("common.notSelected")]}),e.jsx("label",{htmlFor:"smm",className:"input-label",children:s("tests.muscleLabels.smmKg")}),e.jsx("input",{id:"smm",name:"smm",type:"number",placeholder:s("tests.muscleLabels.smmKg"),value:m,onChange:a=>K(a.target.value),className:"input-field"}),e.jsx("button",{onClick:U,className:"calculate-btn",children:s("common.calculate")})]}),r.smmScore!==null&&e.jsxs("div",{className:"result-section",children:[e.jsx("h2",{className:"result-title",children:s("tests.muscleLabels.sectionTitle")}),e.jsxs("p",{className:"result-text",children:[s("tests.muscleLabels.smmShort"),": ",r.smmScore]}),e.jsxs("p",{className:"result-text",children:[s("tests.muscleLabels.smPercentShort"),": ",r.smPercent,"%"]}),e.jsxs("p",{className:"result-text",children:[s("tests.muscleLabels.smPercentScore"),": ",r.smPercentScore]}),e.jsxs("p",{className:"score-text final-score",children:[s("tests.muscleLabels.finalScore"),": ",r.finalScore]})]}),r.finalScore&&e.jsxs("div",{className:"chart-section",children:[e.jsx("h2",{className:"result-title",children:s("tests.muscleLabels.numbersComparison")}),e.jsx("div",{className:"chart-container",children:e.jsx(E,{width:"100%",height:300,children:e.jsxs(C,{data:z,barSize:30,children:[e.jsx(D,{strokeDasharray:"3 3"}),e.jsx(I,{dataKey:"name",label:{value:s("tests.muscleLabels.chartName"),position:"insideBottom",offset:-5}}),e.jsx(T,{domain:[0,100],label:{value:s("tests.muscleLabels.chartScore"),angle:-90,position:"insideLeft"}}),e.jsx(w,{}),e.jsx(W,{}),e.jsx(R,{dataKey:"value",fill:"#4bc0c0",name:s("tests.muscleLabels.chartScore")})]})})}),e.jsx("h2",{className:"text-lg font-semibold mt-6 mb-4",children:s("tests.muscleLabels.finalScore")}),e.jsx("div",{className:"chart-container",children:e.jsx(E,{width:"100%",height:200,children:e.jsxs(C,{data:G,barSize:30,children:[e.jsx(D,{strokeDasharray:"3 3"}),e.jsx(I,{dataKey:"name",label:{value:s("tests.muscleLabels.chartName"),position:"insideBottom",offset:-5}}),e.jsx(T,{domain:[0,100],label:{value:s("tests.muscleLabels.chartScore"),angle:-90,position:"insideLeft"}}),e.jsx(w,{}),e.jsx(R,{dataKey:"value",fill:"#36a2eb",name:s("tests.muscleLabels.chartScore")})]})})})]}),e.jsx("div",{className:"button-group",children:e.jsx("button",{type:"button",onClick:V,className:"submit-btn",disabled:b,children:s(b?"common.submitting":"common.submitAndReturn")})})]})}Z.propTypes={onComplete:k.func,clearTestData:k.func};export{Z as default};

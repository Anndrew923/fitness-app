import{b as ke,u as ee,c as ue,d as Q,a as k,g as Te,j as e,r as Oe,s as Re,e as Le,f as Me}from"./index-yjPVR0rS.js";import{R as Fe,r as l,d as qe,u as Ue}from"./react-vendor-BToktFYo.js";import{l as fe,s as Ae,q as Ee,t as Pe,w as ze,v as Ve,x as Be,y as Ge,z as Je}from"./firebase-D0136ThQ.js";import{P as d,R as We,a as De,b as He,c as Ye,d as _e,e as Ke}from"./charts-BNGpwEcn.js";const U={strength:0,explosivePower:0,cardio:0,muscleMass:0,bodyFat:0},$e=["male","female"],he=({isOpen:u,onClose:C,title:v,message:n,type:c="info",onAction:j=null,actionText:g=null})=>{const{t:N}=ee();if(!u)return null;const s=()=>{switch(c){case"warning":return"âš ï¸";case"success":return"âœ…";case"error":return"âŒ";default:return"â„¹ï¸"}},x=()=>{switch(c){case"warning":return"modal-btn modal-btn-warning";case"success":return"modal-btn modal-btn-success";case"error":return"modal-btn modal-btn-error";default:return"modal-btn modal-btn-info"}},p=()=>{console.log("Modal close button clicked"),C()},S=()=>{console.log("Modal overlay clicked"),C()},w=()=>{j&&j(),C()};return e.jsx("div",{className:"modal-overlay",onClick:S,children:e.jsxs("div",{className:"modal-content",onClick:T=>T.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("span",{className:"modal-icon",children:s()}),e.jsx("h3",{className:"modal-title",children:v})]}),e.jsx("div",{className:"modal-body",children:e.jsx("p",{className:"modal-message",children:n})}),e.jsx("div",{className:"modal-footer",children:j&&g?e.jsxs("div",{className:"modal-footer-actions",children:[e.jsx("button",{className:"modal-btn modal-btn-secondary",onClick:p,children:N("common.cancel")}),e.jsx("button",{className:x(),onClick:w,style:{position:"relative",zIndex:10001},children:g||N("common.confirm")})]}):e.jsx("button",{className:x(),onClick:p,style:{position:"relative",zIndex:10001},children:N("common.confirm")})})]})})};he.propTypes={isOpen:d.bool.isRequired,onClose:d.func.isRequired,title:d.string.isRequired,message:d.string.isRequired,type:d.oneOf(["info","warning","success","error"]),onAction:d.func,actionText:d.string};const Z=({isOpen:u,onConfirm:C,onCancel:v,remainingCount:n})=>{const{t:c}=ee();if(!u)return null;const j=g=>{g.target===g.currentTarget&&v()};return e.jsx("div",{className:"modal-overlay submit-confirm-overlay",onClick:j,children:e.jsxs("div",{className:"modal-content submit-confirm-content",onClick:g=>g.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("span",{className:"modal-icon",children:"ðŸ†"}),e.jsx("h3",{className:"modal-title",children:c("userInfo.submitConfirm.title")})]}),e.jsx("div",{className:"modal-body",children:e.jsxs("div",{className:"submit-confirm-message",children:[e.jsxs("p",{className:"confirm-text",children:[c("userInfo.submitConfirm.descPrefix")," ",e.jsx("span",{className:"remaining-count",children:n})," ",c("userInfo.submitConfirm.descSuffix")]}),e.jsxs("div",{className:"limit-info",children:[e.jsxs("div",{className:"limit-item",children:[e.jsx("span",{className:"limit-icon",children:"ðŸ”„"}),e.jsx("span",{className:"limit-text",children:c("userInfo.limits.remainingUpdates",{count:n})})]}),e.jsxs("div",{className:"limit-item",children:[e.jsx("span",{className:"limit-icon",children:"â°"}),e.jsx("span",{className:"limit-text",children:c("userInfo.limits.nextResetTime")})]})]}),e.jsxs("div",{className:"confirm-details",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-icon",children:"ðŸ“Š"}),e.jsx("span",{className:"detail-text",children:c("userInfo.submitConfirm.ensureAccuracy")})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-icon",children:"â°"}),e.jsx("span",{className:"detail-text",children:c("userInfo.submitConfirm.resetDaily")})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-icon",children:"ðŸŽ¯"}),e.jsx("span",{className:"detail-text",children:c("userInfo.submitConfirm.improveValue")})]})]})]})}),e.jsxs("div",{className:"modal-footer submit-confirm-footer",children:[e.jsx("button",{className:"modal-btn modal-btn-secondary",onClick:v,children:c("userInfo.submitConfirm.cancel")}),e.jsx("button",{className:"modal-btn modal-btn-success",onClick:C,children:c("userInfo.submitConfirm.confirm")})]})]})})};Z.propTypes={isOpen:d.bool.isRequired,onConfirm:d.func.isRequired,onCancel:d.func.isRequired,remainingCount:d.number.isRequired};async function Xe(u,C=300*1024,v=192,n=192){return new Promise((c,j)=>{const g=new window.Image,N=new FileReader;N.onload=s=>{g.src=s.target.result},g.onload=()=>{const s=document.createElement("canvas");let x=g.width,p=g.height;(x>v||p>n)&&(x>p?(p=Math.round(p*v/x),x=v):(x=Math.round(x*n/p),p=n)),s.width=x,s.height=p,s.getContext("2d").drawImage(g,0,0,x,p),s.toBlob(w=>{w.size>C?s.toBlob(T=>{c(T)},"image/jpeg",.7):c(w)},"image/jpeg",.85)},g.onerror=j,N.onerror=j,N.readAsDataURL(u)})}function ge({testData:u,onLogout:C,clearTestData:v}){const{userData:n,setUserData:c,saveHistory:j,loadUserData:g,isLoading:N}=ke(),{t:s}=ee(),[x,p]=l.useState(null),[S,w]=l.useState(!1),[T,pe]=l.useState(null),[H,xe]=l.useState(!1),y=qe(),Y=Ue(),A=l.useRef(null),_=l.useRef(null),G=l.useRef(null),[se,K]=l.useState(!1),[ne,q]=l.useState(null),ae=l.useRef(null),[R,m]=l.useState({isOpen:!1,title:"",message:"",type:"info",onAction:null,actionText:null}),[be,E]=l.useState(null),[I,J]=l.useState({lastSubmissionTime:null,dailySubmissionCount:0,lastSubmissionDate:null}),[P,$]=l.useState({isOpen:!1,remainingCount:3}),[te,re]=l.useState({show:!1,message:""}),W=l.useCallback(()=>{const t=new Date,a=t.toDateString();if(I.lastSubmissionDate!==a)return J(r=>({...r,dailySubmissionCount:0,lastSubmissionDate:a})),{canSubmit:!0,reason:null};if(I.dailySubmissionCount>=3)return{canSubmit:!1,reason:s("userInfo.limits.limitReachedMessage")};if(I.lastSubmissionTime){const r=t-I.lastSubmissionTime,i=2*60*60*1e3;if(r<i){const f=Math.ceil((i-r)/6e4);return{canSubmit:!1,reason:s("userInfo.limits.cooldownMessage",{minutes:f})}}}return{canSubmit:!0,reason:null}},[I,s]),ie=l.useCallback(()=>{const t=W();if(!t.canSubmit){m({isOpen:!0,title:s("userInfo.limits.limitReached"),message:t.reason,type:"warning",onAction:()=>{m(r=>({...r,isOpen:!1})),y("/ladder")},actionText:s("userInfo.modal.viewLadder")});return}const a=3-(I.dailySubmissionCount||0);$({isOpen:!0,remainingCount:Math.max(0,a)})},[I,W,s,y]),oe=l.useCallback(async()=>{if($({isOpen:!1,remainingCount:0}),!S)try{w(!0);const t=n.scores||{},a=ue(t),r={...n,ladderScore:a,lastLadderSubmission:new Date().toISOString()};c(r);try{const i={...n,ladderScore:a,lastLadderSubmission:new Date().toISOString(),updatedAt:new Date().toISOString()};localStorage.setItem("userData",JSON.stringify(i)),localStorage.setItem("lastSavedUserData",JSON.stringify(i));const f=fe(Q,"users",k.currentUser.uid);await Ae(f,{ladderScore:a,lastLadderSubmission:new Date().toISOString(),updatedAt:new Date().toISOString()},{merge:!0}),console.log("å¤©æ¢¯åˆ†æ•¸å·²ç«‹å³ä¿å­˜åˆ° Firebase:",a)}catch(i){throw console.error("ä¿å­˜å¤©æ¢¯åˆ†æ•¸å¤±æ•—:",i),i}const o=new Date;J(i=>({lastSubmissionTime:o,dailySubmissionCount:i.dailySubmissionCount+1,lastSubmissionDate:o.toDateString()})),m({isOpen:!0,title:s("userInfo.modal.submitSuccessTitle"),message:s("userInfo.modal.submitSuccessMessage",{score:a}),type:"success",onAction:()=>{m(i=>({...i,isOpen:!1})),y("/ladder",{state:{forceReload:!0,from:"/user-info",timestamp:Date.now()}})},actionText:s("userInfo.modal.viewLadder")}),setTimeout(()=>{m(i=>({...i,isOpen:!1}))},5e3)}catch(t){console.error("æäº¤åˆ°å¤©æ¢¯å¤±æ•—:",t),m({isOpen:!0,title:s("userInfo.modal.submitFailTitle"),message:s("userInfo.modal.submitFailMessage"),type:"error"})}finally{w(!1)}},[n.scores,c,S,y]),le=l.useCallback(()=>{$({isOpen:!1,remainingCount:0})},[]),ve=l.useCallback(async()=>{if(!k.currentUser){m({isOpen:!0,title:s("community.messages.needLogin"),message:s("userInfo.limits.needLoginToSubmit"),type:"warning"});return}const t=n.scores||{},a=Object.values(t).filter(i=>i>0).length;if(a<5){m({isOpen:!0,title:s("userInfo.limits.assessmentIncomplete"),message:s("userInfo.limits.assessmentIncompleteMessage",{count:a}),type:"warning"});return}const{canSubmit:r,reason:o}=W();if(!r){m({isOpen:!0,title:s("userInfo.limits.limitReached"),message:o,type:"warning",onAction:()=>{m(i=>({...i,isOpen:!1})),y("/ladder")},actionText:s("userInfo.modal.viewLadder")});return}ie()},[n,ie,m,W,s,y,k.currentUser]),ce=l.useMemo(()=>{const t=n.scores||U;return[{name:s("userInfo.radarLabels.strength"),value:t.strength?Number(t.strength).toFixed(2)*1:0,icon:"ðŸ’ª"},{name:s("userInfo.radarLabels.explosivePower"),value:t.explosivePower?Number(t.explosivePower).toFixed(2)*1:0,icon:"âš¡"},{name:s("userInfo.radarLabels.cardio"),value:t.cardio?Number(t.cardio).toFixed(2)*1:0,icon:"â¤ï¸"},{name:s("userInfo.radarLabels.muscle"),value:t.muscleMass?Number(t.muscleMass).toFixed(2)*1:0,icon:"ðŸ¥©"},{name:s("userInfo.radarLabels.ffmi"),value:t.bodyFat?Number(t.bodyFat).toFixed(2)*1:0,icon:"ðŸ“Š"}]},[n.scores]),L=l.useMemo(()=>sessionStorage.getItem("guestMode")==="true",[]),de=({payload:t,x:a,y:r})=>{const o=ce.find(O=>O.name===t.value);let i=a,f=r;const h=Math.sqrt(a*a+r*r),b=Math.atan2(r,a);return t.value===s("userInfo.radarLabels.strength")?(i=a,f=r-h*.12):t.value===s("userInfo.radarLabels.explosivePower")?(i=a+Math.cos(b)*(h*.03),f=r+Math.sin(b)*(h*.06)):t.value===s("userInfo.radarLabels.ffmi")?(i=a+Math.cos(b)*(h*-.2),f=r+Math.sin(b)*(h*.06)):t.value===s("userInfo.radarLabels.cardio")?(i=a+Math.cos(b)*(h*.01),f=r+Math.sin(b)*(h*.06)):t.value===s("userInfo.radarLabels.muscle")?(i=a+Math.cos(b)*(h*-.05),f=r+Math.sin(b)*(h*.06)):(i=a+Math.cos(b)*(h*.1),f=r+Math.sin(b)*(h*.1)),e.jsxs("g",{transform:`translate(${i},${f})`,children:[e.jsx("defs",{children:e.jsxs("filter",{id:"glow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[e.jsx("feGaussianBlur",{stdDeviation:"3",result:"coloredBlur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"coloredBlur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),e.jsx("circle",{cx:0,cy:0,r:16,fill:"rgba(129, 216, 208, 0.1)",filter:"url(#glow)"}),e.jsx("circle",{cx:0,cy:0,r:14,fill:"rgba(255, 255, 255, 0.95)",stroke:"rgba(129, 216, 208, 0.4)",strokeWidth:2,filter:"drop-shadow(0 2px 4px rgba(129, 216, 208, 0.2))"}),e.jsx("text",{x:0,y:-8,textAnchor:"middle",fill:"#4a5568",fontSize:"16",fontWeight:"600",dominantBaseline:"middle",filter:"drop-shadow(0 1px 2px rgba(0, 0, 0, 0.1))",children:o==null?void 0:o.icon}),e.jsx("text",{x:0,y:12,textAnchor:"middle",fill:"#2d3748",fontSize:"13",fontWeight:"700",dominantBaseline:"middle",filter:"drop-shadow(0 1px 3px rgba(255, 255, 255, 0.9))",children:t.value})]})};de.propTypes={payload:d.shape({value:d.string.isRequired}).isRequired,x:d.number.isRequired,y:d.number.isRequired},l.useEffect(()=>{if(!k){p("ç„¡æ³•åˆå§‹åŒ–èº«ä»½é©—è­‰ï¼Œè«‹æª¢æŸ¥ Firebase é…ç½®ä¸¦ç¨å¾Œå†è©¦ã€‚"),console.error("auth æœªåˆå§‹åŒ–");return}const t=k.onAuthStateChanged(a=>{console.log("UserInfo - èªè­‰ç‹€æ…‹è®Šæ›´:",a==null?void 0:a.email),pe(a),!a&&!L&&y("/login")});return()=>t()},[]),l.useEffect(()=>{(async()=>{T&&!H&&!N&&(console.log("UserInfo - æª¢æŸ¥è³‡æ–™è¼‰å…¥ç‹€æ…‹"),!n.height&&!n.weight&&!n.age&&(console.log("UserInfo - è³‡æ–™ç‚ºç©ºï¼Œå˜—è©¦é‡æ–°è¼‰å…¥"),await g(T,!0)),xe(!0))})()},[T,H,N,g,n.height,n.weight,n.age]),l.useEffect(()=>{var o,i;const t=["/strength","/explosive-power","/cardio","/muscle-mass","/body-fat"],a=(o=Y.state)==null?void 0:o.from;a&&t.includes(a)&&setTimeout(()=>{A.current&&A.current.scrollIntoView({behavior:"smooth",block:"center"})},300);const r=(i=Y.state)==null?void 0:i.scrollTo;r&&setTimeout(()=>{r==="radar"&&A.current?A.current.scrollIntoView({behavior:"smooth",block:"center"}):r==="tests"&&_.current&&_.current.scrollIntoView({behavior:"smooth",block:"start"})},300)},[Y]),l.useEffect(()=>{(()=>{try{const a=localStorage.getItem("ladderSubmissionState");if(a){const r=JSON.parse(a),o=new Date().toDateString();r.lastSubmissionDate!==o?J({lastSubmissionTime:null,dailySubmissionCount:0,lastSubmissionDate:o}):J(r)}}catch(a){console.error("è¼‰å…¥æäº¤ç‹€æ…‹å¤±æ•—:",a)}})()},[]),l.useEffect(()=>{I.lastSubmissionDate&&localStorage.setItem("ladderSubmissionState",JSON.stringify(I))},[I]),l.useEffect(()=>{if(u&&Object.keys(u).length>0){console.log("æ”¶åˆ°æ¸¬è©¦æ•¸æ“š:",u);const t=JSON.stringify(u);if(ae.current===t)return;ae.current=t;const a=setTimeout(()=>{c(r=>{const i={...r.scores||U,...u.distance!==void 0&&{cardio:u.score||0},...u.squat!==void 0&&{strength:u.averageScore||0},...(u.finalScore!==void 0||u.verticalJump!==void 0||u.standingLongJump!==void 0||u.sprint!==void 0)&&{explosivePower:u.finalScore||0},...u.smm!==void 0&&{muscleMass:u.finalScore||0},...u.bodyFat!==void 0&&{bodyFat:u.ffmiScore||0}};return console.log("ðŸ’¾ é˜²æŠ–å¾Œæ›´æ–°æ¸¬è©¦æ•¸æ“šåˆ†æ•¸ï¼ˆ5ç§’é˜²æŠ–ï¼‰"),{...r,scores:i,ladderScore:r.ladderScore||0}})},5e3);return v&&setTimeout(v,6e3),()=>clearTimeout(a)}},[u,v]);const D=l.useCallback(()=>{const{height:t,weight:a,age:r,gender:o}=n;return!t||!a||!r||!o?(p(s("errors.required")),!1):t<=0||a<=0||r<=0?(p(s("userInfo.modal.invalidPositive")),!1):$e.includes(o)?!0:(p(s("userInfo.modal.invalidGender")),!1)},[n]),je=l.useCallback(async t=>{if(t.preventDefault(),p(null),w(!0),!D()){w(!1);return}const a={...n,height:Number(n.height)||0,weight:Number(n.weight)||0,age:Number(n.age)||0,gender:n.gender,scores:n.scores||U,ladderScore:n.ladderScore||0,lastActive:new Date().toISOString()};try{c(a),m({isOpen:!0,title:s("userInfo.modal.saveSuccessTitle"),message:s("userInfo.modal.saveSuccessMessage"),type:"success"})}catch(r){m(L?{isOpen:!0,title:"è¨ªå®¢æ¨¡å¼",message:"è¨ªå®¢æ¨¡å¼ä¸‹ç„¡æ³•ä¿å­˜åˆ°é›²ç«¯ï¼Œä½†æ‚¨ç¾åœ¨å¯ä»¥é–‹å§‹é€²è¡Œè©•æ¸¬äº†ï¼",type:"info"}:{isOpen:!0,title:"å„²å­˜å¤±æ•—",message:`å„²å­˜å¤±æ•—ï¼š${r.message}`,type:"error"})}finally{w(!1)}},[n,D,L,c]),z=l.useMemo(()=>{const t=(n==null?void 0:n.scores)||U,a=Object.values(t).filter(o=>o>0);return a.length?(a.reduce((o,i)=>o+Number(i),0)/a.length).toFixed(2):0},[n==null?void 0:n.scores]),X=l.useMemo(()=>{const t=(n==null?void 0:n.scores)||U;return ue(t)},[n==null?void 0:n.scores]),M=(n==null?void 0:n.ladderScore)||0,V=l.useMemo(()=>{const t=(n==null?void 0:n.scores)||U,a=Object.values(t).filter(o=>o>0).length;return{completedCount:a,isFullyCompleted:a===5,progress:a/5*100}},[n==null?void 0:n.scores]),me=l.useCallback(async()=>{if(!(n!=null&&n.userId)||!M||M<=0){E(null);return}try{const t=Ee(Q,"users"),a=Pe(t,ze("ladderScore",">",0),Ve("ladderScore","desc"),Be(100)),r=await Ge(a),o=[];r.forEach(f=>{const h=f.data();h.ladderScore>0&&o.push({id:f.id,...h})});const i=o.findIndex(f=>f.id===n.userId);E(i!==-1?i+1:null)}catch(t){console.error("ç²å–ç”¨æˆ¶æŽ’åå¤±æ•—:",t),E(null)}},[n==null?void 0:n.userId,M,E]);l.useEffect(()=>{me()},[me,c]);const Ne=l.useCallback(t=>{const a=t.target.value,r=/[\u4e00-\u9fff]/.test(a);let o=!0,i="";if(r?a.length>8&&(o=!1,i="æš±ç¨±ä¸èƒ½è¶…éŽ8å€‹ä¸­æ–‡å­—"):a.length>16&&(o=!1,i="æš±ç¨±ä¸èƒ½è¶…éŽ16å€‹è‹±æ–‡å­—å…ƒ"),!o){m({isOpen:!0,title:"å­—æ•¸é™åˆ¶",message:i,type:"warning"});return}c(f=>({...f,nickname:a})),G.current&&clearTimeout(G.current),G.current=setTimeout(()=>{G.current=null},1e3)},[c,m]),Se=l.useCallback(()=>{var r;const t=(r=k.currentUser)==null?void 0:r.email,a=Te(t);c(o=>({...o,nickname:a,ladderScore:o.ladderScore||0}))},[c]),ye=l.useCallback(()=>{if(!k.currentUser){m({isOpen:!0,title:"éœ€è¦ç™»å…¥",message:"è«‹å…ˆç™»å…¥ä»¥å„²å­˜çµæžœ",type:"warning"});return}const t={date:new Date().toLocaleDateString("zh-TW"),scores:n.scores,averageScore:z};j(t),m({isOpen:!0,title:s("userInfo.modal.resultSaveSuccessTitle"),message:s("userInfo.modal.resultSaveSuccessMessage"),type:"success"}),setTimeout(()=>{m(a=>({...a,isOpen:!1}))},2e3)},[n.scores,z,j,m]),B=l.useCallback(async t=>{if(!n.height||!n.weight||!n.age||!n.gender){m({isOpen:!0,title:s("userInfo.modals.basicInfoRequired.title"),message:s("userInfo.modals.basicInfoRequired.message"),type:"warning"});return}D()?y(t,{state:{from:"/user-info"}}):m({isOpen:!0,title:s("userInfo.modals.dataNotSaved.title"),message:s("userInfo.modals.dataNotSaved.message"),type:"warning"})},[n,D,y,m]),Ie=l.useCallback(()=>{localStorage.removeItem("savedEmail"),localStorage.removeItem("savedPassword"),k.currentUser&&k.signOut().catch(t=>console.error("ç™»å‡ºå¤±æ•—:",t)),C(),y("/login")},[C,y]),F=l.useCallback(t=>{const{name:a,value:r}=t.target;let o=r;if(a==="gender"||["profession"].includes(a)?o=r:["weeklyTrainingHours","trainingYears"].includes(a)?o=r===""?"":Number(r):o=r===""?0:Number(r),a==="weight"){const i=n.weight||0,f=o;i>0&&f>0&&i!==f&&(re({show:!0,message:s("userInfo.weightChangeReminder")}),setTimeout(()=>{re(h=>({...h,show:!1}))},3e3))}c(i=>({...i,[a]:o,ladderScore:i.ladderScore||0}))},[c,n.weight,s]),Ce=async t=>{var r;q(null);const a=t.target.files[0];if(a){if(!a.type.startsWith("image/")){q("è«‹é¸æ“‡åœ–ç‰‡æª”æ¡ˆ");return}if(a.size>2*1024*1024){q("åœ–ç‰‡å¤§å°è«‹å‹¿è¶…éŽ 2MB");return}K(!0);try{const o=await Xe(a,307200,192,192);if(o.size>350*1024){q("å£“ç¸®å¾Œåœ–ç‰‡ä»è¶…éŽ 350KBï¼Œè«‹é¸æ“‡æ›´å°çš„åœ–ç‰‡"),K(!1);return}const i=(r=k.currentUser)==null?void 0:r.uid;if(!i)throw new Error("æœªç™»å…¥ï¼Œç„¡æ³•ä¸Šå‚³é ­åƒ");console.log("ðŸ”§ é–‹å§‹ä¸Šå‚³é ­åƒ:",{userId:i,fileSize:o.size});const f=Oe(Re,`avatars/${i}/avatar.jpg`),h={contentType:"image/jpeg",customMetadata:{"uploaded-by":i,"upload-time":new Date().toISOString()}};await Le(f,o,h),console.log("âœ… é ­åƒä¸Šå‚³æˆåŠŸ");const b=await Me(f);console.log("âœ… ç²å–ä¸‹è¼‰ URL æˆåŠŸ:",b),c(O=>({...O,avatarUrl:b,ladderScore:O.ladderScore||0}));try{const O=fe(Q,"users",i);await Je(O,{avatarUrl:b,updatedAt:new Date().toISOString()}),console.log("é ­åƒå·²ç«‹å³ä¿å­˜åˆ° Firebase"),m({isOpen:!0,title:"é ­åƒä¸Šå‚³æˆåŠŸ",message:"æ‚¨çš„é ­åƒå·²æˆåŠŸæ›´æ–°ï¼",type:"success"}),setTimeout(()=>{m(we=>({...we,isOpen:!1}))},2e3)}catch(O){console.error("é ­åƒä¿å­˜åˆ° Firebase å¤±æ•—:",O),q("é ­åƒä¿å­˜å¤±æ•—: "+O.message)}}catch(o){q("é ­åƒä¸Šå‚³å¤±æ•—: "+o.message)}finally{K(!1)}}};return N&&!H?e.jsx("div",{className:"user-info-container",children:e.jsx("div",{className:"loading-message",children:e.jsx("p",{children:s("common.loading")})})}):e.jsxs("div",{className:"user-info-container",children:[e.jsx(he,{isOpen:R.isOpen,onClose:()=>{console.log("Modal onClose triggered, current state:",R),m(t=>(console.log("Setting modal state to closed"),{...t,isOpen:!1}))},title:R.title,message:R.message,type:R.type,onAction:R.onAction,actionText:R.actionText}),e.jsx(Z,{isOpen:P.isOpen,onConfirm:oe,onCancel:le,remainingCount:P.remainingCount}),x&&e.jsx("p",{className:"error-message",children:x}),e.jsxs("div",{className:"avatar-section",children:[e.jsx("div",{className:"avatar-container",children:e.jsx("img",{src:L?"/guest-avatar.svg":(n==null?void 0:n.avatarUrl)||"/default-avatar.svg",alt:s("community.ui.avatarAlt"),className:"user-avatar",loading:"lazy",onError:t=>{t.target.src="/default-avatar.svg"}})}),e.jsxs("div",{className:"avatar-actions-container",children:[!L&&e.jsxs("label",{className:"avatar-upload-label",children:[s(se?"userInfo.avatar.uploading":"userInfo.avatar.change"),e.jsx("input",{type:"file",accept:"image/*",style:{display:"none"},onChange:Ce,disabled:se})]}),L&&e.jsx("div",{className:"guest-avatar-note",children:e.jsx("span",{children:"è¨ªå®¢æ¨¡å¼"})})]}),ne&&e.jsx("div",{className:"avatar-error",children:ne})]}),(T||L)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{className:"page-title",children:s("userInfo.title")}),e.jsx("div",{className:"page-subtitle",children:s("userInfo.subtitle")})]}),e.jsx("div",{className:"form-card",children:e.jsxs("form",{className:"user-form",onSubmit:je,children:[e.jsxs("div",{className:"form-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h3",{className:"section-title",children:s("userInfo.basicInfo")}),T&&e.jsx("button",{type:"button",onClick:Ie,title:"ç™»å‡º",className:"user-info__logout-btn",onMouseEnter:t=>{const a=document.createElement("div");a.innerText="ç™»å‡º",a.style.position="absolute",a.style.bottom="44px",a.style.left="50%",a.style.transform="translateX(-50%)",a.style.background="rgba(60,60,60,0.95)",a.style.color="#fff",a.style.padding="6px 14px",a.style.borderRadius="6px",a.style.fontSize="13px",a.style.whiteSpace="nowrap",a.style.pointerEvents="none",a.style.zIndex="1001",a.className="logout-tooltip",t.currentTarget.parentNode.appendChild(a)},onMouseLeave:t=>{const a=t.currentTarget.parentNode.querySelector(".logout-tooltip");a&&a.remove()},children:e.jsx("span",{className:"user-info__logout-icon",children:"âŽ‹"})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"nickname",className:"form-label",children:s("userInfo.nickname")}),e.jsxs("div",{className:"nickname-input-group",children:[e.jsx("input",{id:"nickname",name:"nickname",type:"text",value:(n==null?void 0:n.nickname)||"",onChange:Ne,placeholder:s("userInfo.nicknamePlaceholder"),className:"form-input",maxLength:"16"}),e.jsx("button",{type:"button",onClick:Se,className:"generate-nickname-btn",children:s("userInfo.generateNickname")})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"gender",className:"form-label",children:s("userInfo.gender")}),e.jsxs("select",{id:"gender",name:"gender",value:(n==null?void 0:n.gender)||"",onChange:F,className:"form-input",required:!0,onInvalid:t=>t.currentTarget.setCustomValidity(s("errors.required")),onInput:t=>t.currentTarget.setCustomValidity(""),children:[e.jsx("option",{value:"",children:s("userInfo.selectGender")}),e.jsx("option",{value:"male",children:s("userInfo.male")}),e.jsx("option",{value:"female",children:s("userInfo.female")})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"age",className:"form-label",children:s("userInfo.age")}),e.jsx("input",{id:"age",name:"age",type:"number",value:(n==null?void 0:n.age)||"",onChange:F,placeholder:s("userInfo.age"),className:"form-input",required:!0,onInvalid:t=>t.currentTarget.setCustomValidity(s("errors.required")),onInput:t=>t.currentTarget.setCustomValidity(""),min:"0",step:"1"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"height",className:"form-label",children:s("userInfo.height")}),e.jsx("input",{id:"height",name:"height",type:"number",value:(n==null?void 0:n.height)||"",onChange:F,placeholder:s("userInfo.height"),className:"form-input",required:!0,onInvalid:t=>t.currentTarget.setCustomValidity(s("errors.required")),onInput:t=>t.currentTarget.setCustomValidity(""),min:"0",step:"0.1"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"weight",className:"form-label",children:s("userInfo.weight")}),e.jsxs("div",{className:"input-with-reminder",children:[e.jsx("input",{id:"weight",name:"weight",type:"number",value:(n==null?void 0:n.weight)||"",onChange:F,placeholder:s("userInfo.weight"),className:"form-input",required:!0,onInvalid:t=>t.currentTarget.setCustomValidity(s("errors.required")),onInput:t=>t.currentTarget.setCustomValidity(""),min:"0",step:"0.1"}),te.show&&e.jsxs("div",{className:"weight-reminder-bubble",children:[e.jsx("span",{className:"reminder-icon",children:"ðŸ’¡"}),e.jsx("span",{className:"reminder-text",children:te.message})]})]})]})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsxs("h3",{className:"section-title",children:["ðŸ† ",s("userInfo.ladder.title")]}),e.jsx("div",{className:"privacy-options",children:e.jsxs("label",{className:"privacy-option",children:[e.jsx("input",{type:"checkbox",checked:n.isAnonymousInLadder===!0,onChange:t=>c(a=>({...a,isAnonymousInLadder:t.target.checked}))}),e.jsxs("div",{className:"privacy-option-content",children:[e.jsx("span",{className:"privacy-option-title",children:s("userInfo.ladder.anonymousTitle")}),e.jsx("span",{className:"privacy-option-desc",children:s("userInfo.ladder.anonymousDesc")})]})]})}),e.jsxs("div",{className:"training-info-section",children:[e.jsxs("h4",{className:"training-info-title",children:["ðŸ’ª ",s("userInfo.training.title")]}),e.jsx("p",{className:"training-info-desc",children:s("userInfo.training.desc")}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"profession",className:"form-label",children:s("userInfo.training.profession")}),e.jsx("input",{id:"profession",name:"profession",type:"text",value:(n==null?void 0:n.profession)||"",onChange:F,placeholder:s("userInfo.placeholders.profession"),className:"form-input",maxLength:"100"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"weeklyTrainingHours",className:"form-label",children:s("userInfo.training.weeklyHours")}),e.jsx("input",{id:"weeklyTrainingHours",name:"weeklyTrainingHours",type:"number",value:(n==null?void 0:n.weeklyTrainingHours)||"",onChange:F,placeholder:s("userInfo.placeholders.hours"),className:"form-input",min:"0",max:"168",step:"0.5"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"trainingYears",className:"form-label",children:s("userInfo.training.years")}),e.jsx("input",{id:"trainingYears",name:"trainingYears",type:"number",value:(n==null?void 0:n.trainingYears)||"",onChange:F,placeholder:s("userInfo.placeholders.years"),className:"form-input",min:"0",max:"50",step:"0.5"})]})]})]}),e.jsx("div",{className:"form-actions",children:e.jsx("button",{type:"submit",className:"submit-btn",disabled:S,children:s(S?"userInfo.saving":"userInfo.saveData")})})]})})]}),e.jsx("div",{id:"radar-section",className:"radar-section",ref:A,children:e.jsxs("div",{className:"radar-card",children:[e.jsx("div",{className:"corner-decoration top-left"}),e.jsx("div",{className:"corner-decoration top-right"}),e.jsx("div",{className:"corner-decoration bottom-left"}),e.jsx("div",{className:"corner-decoration bottom-right"}),e.jsx("h2",{className:"radar-title",children:s("userInfo.radarOverview")}),S?e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"æ­£åœ¨è¼‰å…¥æ•¸æ“š..."})]}):e.jsx("div",{className:"radar-chart-container",children:e.jsx(We,{width:"100%",height:400,children:e.jsxs(De,{data:ce,children:[e.jsx(He,{gridType:"polygon",stroke:"rgba(129, 216, 208, 0.25)",strokeWidth:2,strokeDasharray:"4 4"}),e.jsx(Ye,{dataKey:"name",tick:e.jsx(de,{}),axisLine:!1}),e.jsx(_e,{angle:90,domain:[0,100],tickCount:5,tick:{fontSize:12,fill:"#2d3748",fontWeight:600},axisLine:!1}),e.jsx(Ke,{name:s("userInfo.yourPerformance"),dataKey:"value",stroke:"#81D8D0",fill:"url(#tiffanyGradient)",fillOpacity:.8,strokeWidth:4,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("defs",{children:e.jsxs("linearGradient",{id:"tiffanyGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#81D8D0",stopOpacity:.9}),e.jsx("stop",{offset:"50%",stopColor:"#5F9EA0",stopOpacity:.7}),e.jsx("stop",{offset:"100%",stopColor:"#81D8D0",stopOpacity:.6})]})})]})})}),!S&&e.jsxs("div",{className:"score-section",children:[z>0&&e.jsxs("div",{className:"average-score-display",children:[e.jsxs("p",{className:"average-score",children:["â­ ",s("userInfo.powerTitle")," ",e.jsx("span",{className:"score-value-large",children:z})]}),V.isFullyCompleted&&e.jsxs("div",{className:"ladder-info",children:[e.jsxs("p",{className:"ladder-rank",children:["ðŸ† ",s("userInfo.ladder.rankLabel"),":"," ",e.jsx("span",{className:"rank-value",children:be||"æœªä¸Šæ¦œ"})]}),M>0&&e.jsxs("p",{className:"submitted-score",children:[s("userInfo.ladder.submittedScore"),":"," ",e.jsx("span",{className:"score-value",children:M})]}),X>0&&X!==M&&e.jsxs("p",{className:"current-score",children:[s("userInfo.ladder.currentScore"),":"," ",e.jsx("span",{className:"score-value",children:X}),e.jsx("span",{className:"score-note",children:s("userInfo.ladder.needsSubmit")})]})]})]}),e.jsxs("div",{className:"action-buttons-section",children:[z>0&&e.jsxs("button",{onClick:ye,className:"action-btn save-results-btn",disabled:S,children:[e.jsx("span",{className:"btn-icon",children:"ðŸ’¾"}),e.jsx("span",{className:"btn-text",children:s("userInfo.saveResults")})]}),V.isFullyCompleted&&e.jsxs("button",{onClick:ve,className:"action-btn submit-ladder-btn",disabled:S,children:[e.jsx("span",{className:"btn-icon",children:"ðŸ†"}),e.jsx("span",{className:"btn-text",children:M>0?s("userInfo.updateLadderScore"):s("userInfo.submitToLadder")})]})]}),V.isFullyCompleted&&e.jsxs("div",{className:"ladder-limits-info",children:[e.jsxs("div",{className:"limit-info-item",children:[e.jsx("span",{className:"limit-icon",children:"ðŸ”„"}),e.jsx("span",{className:"limit-text",children:s("userInfo.limits.remainingUpdates",{count:3-(I.dailySubmissionCount||0)})})]}),e.jsxs("div",{className:"limit-info-item",children:[e.jsx("span",{className:"limit-icon",children:"â°"}),e.jsx("span",{className:"limit-text",children:s("userInfo.limits.nextResetTime")})]}),e.jsxs("div",{className:"limit-info-item",children:[e.jsx("span",{className:"limit-icon",children:"â„¹ï¸"}),e.jsx("span",{className:"limit-text",children:s("userInfo.limits.limitInfo")})]})]}),e.jsx("div",{className:"ladder-info-card",children:e.jsx("p",{className:"ladder-info-text",children:V.isFullyCompleted?s("userInfo.ladder.ctaCompleted"):s("userInfo.ladder.ctaNotCompleted",{count:V.completedCount})})})]})]})}),e.jsxs("div",{className:"test-buttons-section",ref:_,children:[e.jsx("h3",{className:"section-title",children:s("userInfo.startTests")}),e.jsxs("div",{className:"test-buttons-grid",children:[e.jsxs("button",{onClick:()=>B("/strength"),className:"test-btn strength-btn",children:[e.jsx("span",{className:"test-icon",children:"ðŸ’ª"}),e.jsx("span",{className:"test-label",children:s("tests.strength")})]}),e.jsxs("button",{onClick:()=>B("/explosive-power"),className:"test-btn explosive-btn",children:[e.jsx("span",{className:"test-icon",children:"âš¡"}),e.jsx("span",{className:"test-label",children:s("tests.explosivePower")})]}),e.jsxs("button",{onClick:()=>B("/cardio"),className:"test-btn cardio-btn",children:[e.jsx("span",{className:"test-icon",children:"â¤ï¸"}),e.jsx("span",{className:"test-label",children:s("tests.cardio")})]}),e.jsxs("button",{onClick:()=>B("/muscle-mass"),className:"test-btn muscle-btn",children:[e.jsx("span",{className:"test-icon",children:"ðŸ¥©"}),e.jsx("span",{className:"test-label",children:s("tests.muscleMass")})]}),e.jsxs("button",{onClick:()=>B("/body-fat"),className:"test-btn bodyfat-btn",children:[e.jsx("span",{className:"test-icon",children:"ðŸ“Š"}),e.jsx("span",{className:"test-label",children:s("tests.bodyFat")})]})]})]}),P.isOpen&&e.jsx(Z,{isOpen:P.isOpen,onConfirm:oe,onCancel:le,remainingCount:P.remainingCount})]})}ge.propTypes={testData:d.shape({distance:d.number,score:d.number,squat:d.number,averageScore:d.number,jumpHeight:d.number,finalScore:d.number,smm:d.number,bodyFat:d.number,ffmiScore:d.number,verticalJump:d.number,standingLongJump:d.number,sprint:d.number}),onLogout:d.func.isRequired,clearTestData:d.func.isRequired};const ns=Fe.memo(ge);export{ns as default};

import{u as q,a as J,j as e}from"./index-CzQucI3b.js";import{r as p}from"./react-vendor-BToktFYo.js";import"./firebase-D0136ThQ.js";import"./charts-BNGpwEcn.js";function Y(){const{userData:m,setUserData:M}=q(),{t:s,i18n:v}=J(),[y,C]=p.useState(!1),[f,S]=p.useState([]),[x,R]=p.useState(!1),[j,H]=p.useState(1),[w]=p.useState(10),[P,z]=p.useState("total"),W=p.useRef(!1),d=p.useMemo(()=>[...(m==null?void 0:m.history)||[]].sort((c,n)=>{const t=c.timestamp?new Date(c.timestamp):new Date(c.date);return(n.timestamp?new Date(n.timestamp):new Date(n.date))-t}),[m==null?void 0:m.history]),b=Math.ceil(d.length/w),F=(j-1)*w,O=F+w,T=d.slice(F,O),k=d.length,$=50,A=k>=$*.8,D=k>=$,g=p.useMemo(()=>{if(d.length===0)return null;const l=d.slice(0,6),c=l.map(i=>{const o=i.timestamp?new Date(i.timestamp):new Date(i.date),u=v.language&&v.language.startsWith("zh")?"zh-TW":"en-US";return o.toLocaleDateString(u,{month:"numeric",day:"numeric"})}).reverse(),n=l.map(i=>{const o=i.scores||{};return i.averageScore||(Object.values(o).filter(u=>u>0).reduce((u,G)=>u+G,0)/Object.values(o).filter(u=>u>0).length).toFixed(2)}).reverse(),t=l.map(i=>{var o;return(((o=i.scores)==null?void 0:o.strength)||0).toFixed(2)}).reverse(),a=l.map(i=>{var o;return(((o=i.scores)==null?void 0:o.explosivePower)||0).toFixed(2)}).reverse(),r=l.map(i=>{var o;return(((o=i.scores)==null?void 0:o.cardio)||0).toFixed(2)}).reverse(),h=l.map(i=>{var o;return(((o=i.scores)==null?void 0:o.muscleMass)||0).toFixed(2)}).reverse(),_=l.map(i=>{var o;return(((o=i.scores)==null?void 0:o.bodyFat)||0).toFixed(2)}).reverse();return{labels:c,datasets:[{label:s("history.chart.options.total"),data:n,color:"#28a745",key:"total"},{label:s("history.chart.options.strength"),data:t,color:"#007bff",key:"strength"},{label:s("history.chart.options.explosive"),data:a,color:"#ffc107",key:"explosive"},{label:s("history.chart.options.cardio"),data:r,color:"#dc3545",key:"cardio"},{label:s("history.chart.options.muscle"),data:h,color:"#6f42c1",key:"muscle"},{label:s("history.chart.options.ffmi"),data:_,color:"#fd7e14",key:"ffmi"}]}},[d,s,v.language]),N=l=>{const c=Number(l);return c>=80?"score-excellent":c>=60?"score-good":c>=40?"score-fair":c>0?"score-poor":"score-none"};p.useEffect(()=>{m&&!W.current&&(console.log("History.js - userData:",m),console.log("History.js - sortedHistory:",d),console.log("History.js - 記錄數量:",k,"/",$),console.log("History.js - 當前頁面:",j,"/",b),W.current=!0)},[m,d,k,j,b]);const E=()=>{C(!y),S([])},U=l=>{f.includes(l)?S(f.filter(c=>c!==l)):S([...f,l])},B=()=>{const l=d.filter((c,n)=>!f.includes(n));M({...m,history:l}),C(!1),S([]),H(1),console.log("History.js - 已刪除所選紀錄")},L=l=>{H(Math.max(1,Math.min(l,b)))},I=()=>{if(!g)return null;const l=18,c="600",n=g.datasets.find(t=>t.key===P);return e.jsxs("div",{className:"chart-container",children:[e.jsxs("div",{className:"chart-header",children:[e.jsx("h3",{children:s("history.chart.title")}),e.jsx("div",{className:"chart-note",children:s("history.chart.note")}),e.jsx("div",{className:"chart-selector",children:e.jsx("select",{value:P,onChange:t=>z(t.target.value),className:"chart-select",children:g.datasets.map(t=>e.jsx("option",{value:t.key,children:t.label},t.key))})})]}),e.jsx("div",{className:"chart-wrapper",children:e.jsxs("svg",{className:"chart",viewBox:"0 0 800 800",children:[[...Array(6)].map((t,a)=>{const h=720-a*20*480/100;return e.jsx("line",{x1:"50",y1:h,x2:"750",y2:h,stroke:"#dee2e6",strokeWidth:"1"},`grid-y-${a}`)}),n&&e.jsxs("g",{children:[e.jsx("polyline",{points:n.data.map((t,a)=>{const r=50+a*700/(g.labels.length-1),h=720-t*480/100;return`${r},${h}`}).join(" "),fill:"none",stroke:n.color,strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"}),n.data.map((t,a)=>{const r=50+a*700/(g.labels.length-1),h=720-t*480/100;return e.jsx("circle",{cx:r,cy:h,r:"5",fill:n.color,stroke:"white",strokeWidth:"2"},`point-${a}`)})]},n.label),g.labels.map((t,a)=>{const r=50+a*700/(g.labels.length-1);return e.jsx("text",{x:r,y:"780",textAnchor:"middle",fontSize:l,fontWeight:c,fill:"#495057",children:t},`label-${a}`)}),[...Array(6)].map((t,a)=>{const r=a*20,h=720-r*480/100;return e.jsx("text",{x:"30",y:h+6,textAnchor:"end",fontSize:l,fontWeight:c,fill:"#495057",children:r},`y-label-${a}`)})]})})]})};return e.jsxs("div",{className:"history-container",children:[e.jsx("h1",{children:s("history.title")}),e.jsx("div",{className:"history-table-section",children:d.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"score-legend",children:[e.jsx("h4",{children:s("history.legendTitle")}),e.jsxs("div",{className:"legend-items",children:[e.jsx("span",{className:"legend-item score-excellent",children:s("history.legendExcellent")}),e.jsx("span",{className:"legend-item score-good",children:s("history.legendGood")}),e.jsx("span",{className:"legend-item score-fair",children:s("history.legendFair")}),e.jsx("span",{className:"legend-item score-poor",children:s("history.legendPoor")})]})]}),e.jsxs("table",{className:"history-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsxs("th",{className:`date-col ${x?"mobile-hidden":""}`,children:[e.jsx("span",{className:"icon",children:"📅"}),e.jsx("span",{className:"desktop-text",children:s("history.table.date")})]}),e.jsxs("th",{className:"score-col",children:[e.jsx("span",{className:"icon",children:"💪"}),e.jsx("span",{className:"desktop-text",children:s("history.table.strength")})]}),e.jsxs("th",{className:"score-col",children:[e.jsx("span",{className:"icon",children:"⚡"}),e.jsx("span",{className:"desktop-text",children:s("history.table.explosive")})]}),e.jsxs("th",{className:`score-col ${x?"":"mobile-hidden"}`,children:[e.jsx("span",{className:"icon",children:"❤️"}),e.jsx("span",{className:"desktop-text",children:s("history.table.cardio")})]}),e.jsxs("th",{className:`score-col ${x?"":"mobile-hidden"}`,children:[e.jsx("span",{className:"icon",children:"🥩"}),e.jsx("span",{className:"desktop-text",children:s("history.table.muscle")})]}),e.jsxs("th",{className:`score-col ${x?"":"mobile-hidden"}`,children:[e.jsx("span",{className:"icon",children:"📊"}),e.jsx("span",{className:"desktop-text",children:s("history.table.ffmi")})]}),e.jsxs("th",{className:"average-col",children:[e.jsx("span",{className:"icon",children:"🏆"}),e.jsx("span",{className:"desktop-text",children:s("history.table.total")})]}),y&&e.jsx("th",{className:"select-col",children:s("history.table.select")})]})}),e.jsx("tbody",{children:T.map((l,c)=>{const n=F+c,t=l.scores||{},a=l.averageScore||(Object.values(t).filter(r=>r>0).reduce((r,h)=>r+h,0)/Object.values(t).filter(r=>r>0).length).toFixed(2)||0;return e.jsxs("tr",{children:[e.jsx("td",{className:`date-cell ${x?"mobile-hidden":""}`,children:l.date||new Date(l.timestamp).toLocaleDateString(v.language&&v.language.startsWith("zh")?"zh-TW":"en-US")}),e.jsx("td",{className:`score-cell ${N(t.strength||0)}`,children:(t.strength||0).toFixed(2)}),e.jsx("td",{className:`score-cell ${N(t.explosivePower||0)}`,children:(t.explosivePower||0).toFixed(2)}),e.jsx("td",{className:`score-cell ${x?"":"mobile-hidden"} ${N(t.cardio||0)}`,children:(t.cardio||0).toFixed(2)}),e.jsx("td",{className:`score-cell ${x?"":"mobile-hidden"} ${N(t.muscleMass||0)}`,children:(t.muscleMass||0).toFixed(2)}),e.jsx("td",{className:`score-cell ${x?"":"mobile-hidden"} ${N(t.bodyFat||0)}`,children:(t.bodyFat||0).toFixed(2)}),e.jsx("td",{className:`average-cell ${N(a)}`,children:e.jsx("strong",{children:Number(a).toFixed(2)})}),y&&e.jsx("td",{className:"select-cell",children:e.jsx("input",{type:"checkbox",className:"history-checkbox",checked:f.includes(n),onChange:()=>U(n)})})]},l.id||n)})})]}),b>1&&e.jsxs("div",{className:"pagination",children:[e.jsx("button",{onClick:()=>L(j-1),disabled:j===1,className:"pagination-btn",children:s("history.pagination.prev")}),e.jsxs("span",{className:"page-info",children:[j,"/",b]}),e.jsx("button",{onClick:()=>L(j+1),disabled:j===b,className:"pagination-btn",children:s("history.pagination.next")})]}),e.jsx("div",{className:"action-buttons",children:e.jsx("button",{onClick:()=>R(!x),className:"toggle-delete-btn mobile-toggle-btn",children:s(x?"history.mobileToggle.showDate":"history.mobileToggle.showAll")})}),d.length>0&&e.jsxs("div",{className:"history-stats",children:[e.jsxs("div",{className:"stats-and-actions",children:[e.jsxs("div",{className:"record-count",children:[e.jsx("span",{className:"count-label",children:s("history.count.label")}),e.jsxs("span",{className:`count-value ${A?"near-limit":""} ${D?"at-limit":""}`,children:[k," / ",$]})]}),e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{onClick:E,className:`toggle-delete-btn ${y?"cancel-delete-btn":"edit-mode-btn"}`,children:s(y?"history.actions.cancel":"history.actions.clear")}),y&&e.jsx("button",{onClick:B,className:"toggle-delete-btn delete-selected-btn",children:s("history.actions.deleteSelected")})]})]}),A&&!D&&e.jsx("div",{className:"limit-warning",children:s("history.count.nearLimit")}),D&&e.jsx("div",{className:"limit-error",children:s("history.count.atLimit")})]})]}):e.jsxs("div",{className:"no-history",children:[e.jsx("h3",{children:s("history.empty.title")}),e.jsx("p",{children:s("history.empty.p1")}),e.jsx("p",{children:s("history.empty.p2")})]})}),d.length>0&&I()]})}export{Y as default};

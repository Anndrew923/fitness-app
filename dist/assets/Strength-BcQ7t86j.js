import{u as us,a as ms,j as e}from"./index-u_ODcrAP.js";import{d as ps,r as u}from"./react-vendor-BToktFYo.js";import{a as xs,b as bs,c as fs,d as Ss,e as ws,f as js,g as vs,h as ys,i as Ns,j as Ps,k as ks,l as Fs,m as Es,n as Is,o as Ts,p as Cs,q as Ds,r as Ms,s as qs,t as $s}from"./standards-Dj82V2Ks.js";import{R as Ls,a as As,b as Bs,c as Rs,d as Os,e as Ws,P as Xe}from"./charts-BNGpwEcn.js";import"./firebase-D0136ThQ.js";function _s({onComplete:C}){var U,z,J,H,Q,V,X,Y,Z,ee,se,te,ae,re,ne,le,ce,ie,oe,de,he,ge,ue,me,pe,xe,be,fe,Se,we,je,ve,ye,Ne,Pe,ke,Fe,Ee,Ie,Te,Ce,De,Me,qe,$e,Le,Ae,Be,Re,Oe,We,_e,Ke,Ge,Ue,ze,Je,He,Qe,Ve;const{userData:r,setUserData:F}=us(),D=ps(),{gender:w,age:P}=r,{t}=ms(),[k,M]=u.useState("exercises"),[i,q]=u.useState({weight:((J=(z=(U=r.testInputs)==null?void 0:U.strength)==null?void 0:z.benchPress)==null?void 0:J.weight)||"",reps:((V=(Q=(H=r.testInputs)==null?void 0:H.strength)==null?void 0:Q.benchPress)==null?void 0:V.reps)||"",max:((Z=(Y=(X=r.testInputs)==null?void 0:X.strength)==null?void 0:Y.benchPress)==null?void 0:Z.max)||null,score:((te=(se=(ee=r.testInputs)==null?void 0:ee.strength)==null?void 0:se.benchPress)==null?void 0:te.score)||null}),[o,$]=u.useState({weight:((ne=(re=(ae=r.testInputs)==null?void 0:ae.strength)==null?void 0:re.squat)==null?void 0:ne.weight)||"",reps:((ie=(ce=(le=r.testInputs)==null?void 0:le.strength)==null?void 0:ce.squat)==null?void 0:ie.reps)||"",max:((he=(de=(oe=r.testInputs)==null?void 0:oe.strength)==null?void 0:de.squat)==null?void 0:he.max)||null,score:((me=(ue=(ge=r.testInputs)==null?void 0:ge.strength)==null?void 0:ue.squat)==null?void 0:me.score)||null}),[d,L]=u.useState({weight:((be=(xe=(pe=r.testInputs)==null?void 0:pe.strength)==null?void 0:xe.deadlift)==null?void 0:be.weight)||"",reps:((we=(Se=(fe=r.testInputs)==null?void 0:fe.strength)==null?void 0:Se.deadlift)==null?void 0:we.reps)||"",max:((ye=(ve=(je=r.testInputs)==null?void 0:je.strength)==null?void 0:ve.deadlift)==null?void 0:ye.max)||null,score:((ke=(Pe=(Ne=r.testInputs)==null?void 0:Ne.strength)==null?void 0:Pe.deadlift)==null?void 0:ke.score)||null}),[h,A]=u.useState({weight:((Ie=(Ee=(Fe=r.testInputs)==null?void 0:Fe.strength)==null?void 0:Ee.latPulldown)==null?void 0:Ie.weight)||"",reps:((De=(Ce=(Te=r.testInputs)==null?void 0:Te.strength)==null?void 0:Ce.latPulldown)==null?void 0:De.reps)||"",max:(($e=(qe=(Me=r.testInputs)==null?void 0:Me.strength)==null?void 0:qe.latPulldown)==null?void 0:$e.max)||null,score:((Be=(Ae=(Le=r.testInputs)==null?void 0:Le.strength)==null?void 0:Ae.latPulldown)==null?void 0:Be.score)||null}),[g,B]=u.useState({weight:((We=(Oe=(Re=r.testInputs)==null?void 0:Re.strength)==null?void 0:Oe.shoulderPress)==null?void 0:We.weight)||"",reps:((Ge=(Ke=(_e=r.testInputs)==null?void 0:_e.strength)==null?void 0:Ke.shoulderPress)==null?void 0:Ge.reps)||"",max:((Je=(ze=(Ue=r.testInputs)==null?void 0:Ue.strength)==null?void 0:ze.shoulderPress)==null?void 0:Je.max)||null,score:((Ve=(Qe=(He=r.testInputs)==null?void 0:He.strength)==null?void 0:Qe.shoulderPress)==null?void 0:Ve.score)||null}),[E,R]=u.useState(!1),j=u.useRef(null),O=u.useCallback(s=>{const a=()=>{var m,p;const n=((m=r.testInputs)==null?void 0:m.strength)||{},l=((p=s.testInputs)==null?void 0:p.strength)||{};JSON.stringify(n)!==JSON.stringify(l)?(console.log("💾 測試輸入變化，更新用戶數據"),F(s)):console.log("⏭️ 測試輸入無變化，跳過更新")};j.current&&clearTimeout(j.current),j.current=setTimeout(a,5e3)},[F,r.testInputs]);u.useEffect(()=>{const s={...r.testInputs,strength:{benchPress:{weight:i.weight,reps:i.reps,max:i.max,score:i.score},squat:{weight:o.weight,reps:o.reps,max:o.max,score:o.score},deadlift:{weight:d.weight,reps:d.reps,max:d.max,score:d.score},latPulldown:{weight:h.weight,reps:h.reps,max:h.max,score:h.score},shoulderPress:{weight:g.weight,reps:g.reps,max:g.max,score:g.score}}},a={...r,testInputs:s};return O(a),()=>{j.current&&clearTimeout(j.current)}},[i,o,d,h,g,r,O]);const W=(s,a)=>{const{Beginner:n,Novice:l,Intermediate:c,Advanced:m,Elite:p}=a;return s<n?0:s>=p?100:s>=m?80+20*(s-m)/(p-m):s>=c?60+20*(s-c)/(m-c):s>=l?40+20*(s-l)/(c-l):s>=n?20+20*(s-n)/(l-n):0},_=u.useMemo(()=>{const s=w==="male"||w==="男性";return{benchPress:{bodyweight:s?qs:$s,age:s?Ds:Ms},squat:{bodyweight:s?Ts:Cs,age:s?Es:Is},deadlift:{bodyweight:s?ks:Fs,age:s?Ns:Ps},latPulldown:{bodyweight:s?vs:ys,age:s?ws:js},shoulderPress:{bodyweight:s?fs:Ss,age:s?xs:bs}}},[w]),I=u.useCallback((s,a,n,l)=>{if(!s||!a)return alert(t("tests.strengthErrors.missingInputs"));const c=parseFloat(s),m=parseFloat(a),p=parseFloat(r.weight),S=parseFloat(P);if(!p||!S)return alert(t("tests.strengthErrors.missingUserData"));if(m>12){alert(t("tests.strengthErrors.repsTooHigh")),n(b=>({...b,reps:""}));return}const v=c/(1.0278-.0278*m),x=_[l],y=Object.keys(x.bodyweight).map(Number),ns=Object.keys(x.age).map(Number),ls=y.reduce((b,N)=>Math.abs(N-p)<Math.abs(b-p)?N:b),cs=ns.reduce((b,N)=>Math.abs(N-S)<Math.abs(b-S)?N:b),is=x.bodyweight[ls],os=x.age[cs],ds=W(v,is),hs=W(v,os),gs=((ds+hs)/2).toFixed(2);n(b=>({...b,max:v.toFixed(2),score:gs}))},[_,r.weight,P]);u.useEffect(()=>{w&&r.weight&&P&&[{key:"benchPress",state:i,setState:q},{key:"squat",state:o,setState:$},{key:"deadlift",state:d,setState:L},{key:"latPulldown",state:h,setState:A},{key:"shoulderPress",state:g,setState:B}].forEach(({key:a,state:n,setState:l})=>{n.weight&&n.reps&&!n.score&&I(n.weight,n.reps,l,a)})},[w,r.weight,P,i,o,d,h,g,I]);const Ye=(s,a)=>{const l=a==="男性"||a&&a.toLowerCase()==="male"?"tests.strengthComments.male":"tests.strengthComments.female";return s>=90?t(`${l}.gte90`):s>=80?t(`${l}.gte80`):s>=70?t(`${l}.gte70`):s>=60?t(`${l}.gte60`):s>=50?t(`${l}.gte50`):s>=40?t(`${l}.gte40`):t(`${l}.below40`)},Ze=u.useMemo(()=>[{name:t("tests.strengthExercises.benchPress"),value:parseFloat(i.score)||0},{name:t("tests.strengthExercises.squat"),value:parseFloat(o.score)||0},{name:t("tests.strengthExercises.deadlift"),value:parseFloat(d.score)||0},{name:t("tests.strengthExercises.latPulldown"),value:parseFloat(h.score)||0},{name:t("tests.strengthExercises.shoulderPress"),value:parseFloat(g.score)||0}],[i.score,o.score,d.score,h.score,g.score,t]),T=[i.score,o.score,d.score,h.score,g.score].filter(s=>s!==null),f=T.length>0?(T.reduce((s,a)=>s+parseFloat(a),0)/T.length).toFixed(2):null,es=async()=>{if(!f)return alert(t("tests.strengthErrors.needAtLeastOne"));if(!E){R(!0);try{const s={...r.scores,strength:parseFloat(f)};F(n=>({...n,scores:s,ladderScore:n.ladderScore||0}));const a={squat:o.max?{weight:o.weight,reps:o.reps,max:o.max,score:o.score}:null,benchPress:i.max?{weight:i.weight,reps:i.reps,max:i.max,score:i.score}:null,deadlift:d.max?{weight:d.weight,reps:d.reps,max:d.max,score:d.score}:null,latPulldown:h.max?{weight:h.weight,reps:h.reps,max:h.max,score:h.score}:null,shoulderPress:g.max?{weight:g.weight,reps:g.reps,max:g.max,score:g.score}:null,averageScore:parseFloat(f)};C&&C(a),D("/user-info",{state:{from:"/strength"}})}catch(s){console.error("提交失敗:",s),alert(t("tests.strengthErrors.updateFail")),D("/user-info",{state:{from:"/strength"}})}finally{R(!1)}}},ss=[{range:"90~100",description:t("tests.strengthStandards.guide.items.90_100")},{range:"80~90",description:t("tests.strengthStandards.guide.items.80_90")},{range:"70~80",description:t("tests.strengthStandards.guide.items.70_80")},{range:"60~70",description:t("tests.strengthStandards.guide.items.60_70")},{range:"50~60",description:t("tests.strengthStandards.guide.items.50_60")},{range:"40~50",description:t("tests.strengthStandards.guide.items.40_50")},{range:t("tests.strengthStandards.guide.rangeBelow40"),description:t("tests.strengthStandards.guide.items.below40")}],ts=[{level:t("tests.strengthStandards.levels.beginner"),score:20,color:"#FF6B6B"},{level:t("tests.strengthStandards.levels.novice"),score:40,color:"#FFA726"},{level:t("tests.strengthStandards.levels.intermediate"),score:60,color:"#FFEE58"},{level:t("tests.strengthStandards.levels.advanced"),score:80,color:"#66BB6A"},{level:t("tests.strengthStandards.levels.elite"),score:100,color:"#42A5F5"}],K=[{key:"benchPress",name:t("tests.strengthExercises.benchPress"),state:i,setState:q},{key:"squat",name:t("tests.strengthExercises.squat"),state:o,setState:$},{key:"deadlift",name:t("tests.strengthExercises.deadlift"),state:d,setState:L},{key:"latPulldown",name:t("tests.strengthExercises.latPulldown"),state:h,setState:A},{key:"shoulderPress",name:t("tests.strengthExercises.shoulderPress"),state:g,setState:B}],[G,as]=u.useState(new Set),rs=s=>{const{key:a,name:n,icon:l,state:c,setState:m}=s,p=c.score!==null,S=G.has(a),v=()=>{const x=new Set(G);S?x.delete(a):x.add(a),as(x)};return e.jsxs("div",{className:`exercise-card ${p?"completed":""}`,children:[e.jsxs("div",{className:"exercise-header",onClick:v,children:[e.jsxs("div",{className:"exercise-header-left",children:[e.jsx("span",{className:"exercise-icon",children:l}),e.jsx("h3",{className:"exercise-name",children:n})]}),e.jsxs("div",{className:"exercise-header-right",children:[p&&e.jsx("span",{className:"score-badge",children:c.score}),e.jsx("span",{className:`expand-arrow ${S?"expanded":""}`,children:S?"▲":"▼"})]})]}),S&&e.jsxs("div",{className:"exercise-content",children:[e.jsxs("div",{className:"exercise-inputs",children:[e.jsxs("div",{className:"input-group",children:[e.jsx("label",{htmlFor:`${a}Weight`,children:t("tests.strengthLabels.weightKg")}),e.jsx("input",{id:`${a}Weight`,type:"number",placeholder:t("tests.strengthLabels.weightKg"),value:c.weight,onChange:x=>m(y=>({...y,weight:x.target.value})),className:"input-field"})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{htmlFor:`${a}Reps`,children:t("tests.strengthLabels.reps")}),e.jsx("input",{id:`${a}Reps`,type:"number",placeholder:t("tests.strengthLabels.reps"),value:c.reps,onChange:x=>m(y=>({...y,reps:x.target.value})),className:"input-field"})]}),e.jsx("button",{onClick:()=>I(c.weight,c.reps,m,a),className:"calculate-btn",disabled:!c.weight||!c.reps,children:t("common.calculate")})]}),c.max&&e.jsxs("div",{className:"exercise-result",children:[e.jsxs("p",{className:"max-strength",children:[t("tests.strengthLabels.maxStrength"),": ",c.max," kg"]}),c.score&&e.jsxs("p",{className:"score-display",children:[t("tests.score"),": ",c.score]})]})]})]},a)};return e.jsxs("div",{className:"strength-container",children:[e.jsxs("div",{className:"strength-header",children:[e.jsxs("h1",{className:"strength-title",children:["💪 ",t("tests.strengthTitle")]}),e.jsx("p",{className:"strength-safety-note",children:t("tests.strengthSafetyNote")})]}),e.jsxs("div",{className:"tab-navigation",children:[e.jsxs("button",{className:`tab-btn ${k==="exercises"?"active":""}`,onClick:()=>M("exercises"),children:["🏋️ ",t("tests.startTest")]}),e.jsxs("button",{className:`tab-btn ${k==="standards"?"active":""}`,onClick:()=>M("standards"),children:["📋 ",t("tests.strengthStandards.tabTitle")]})]}),k==="exercises"&&e.jsxs("div",{className:"exercises-tab",children:[e.jsx("div",{className:"exercises-grid",children:K.map(rs)}),f&&e.jsxs("div",{className:"results-section",children:[e.jsxs("div",{className:"radar-chart-card",children:[e.jsx("div",{className:"corner-decoration top-left"}),e.jsx("div",{className:"corner-decoration top-right"}),e.jsx("div",{className:"corner-decoration bottom-left"}),e.jsx("div",{className:"corner-decoration bottom-right"}),e.jsxs("h3",{children:["📈 ",t("tests.strengthTitle")]}),e.jsx(Ls,{width:"100%",height:300,children:e.jsxs(As,{data:Ze,children:[e.jsx(Bs,{gridType:"polygon",stroke:"rgba(129, 216, 208, 0.25)",strokeWidth:2,strokeDasharray:"4 4"}),e.jsx(Rs,{dataKey:"name",tick:{fontSize:13,fill:"#2d3748",fontWeight:700}}),e.jsx(Os,{angle:90,domain:[0,100],tick:{fontSize:12,fill:"#2d3748",fontWeight:600}}),e.jsx(Ws,{name:"分數",dataKey:"value",stroke:"#81D8D0",fill:"url(#strengthTiffanyGradient)",fillOpacity:.8,strokeWidth:4,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("defs",{children:e.jsxs("linearGradient",{id:"strengthTiffanyGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#81D8D0",stopOpacity:.9}),e.jsx("stop",{offset:"50%",stopColor:"#5F9EA0",stopOpacity:.7}),e.jsx("stop",{offset:"100%",stopColor:"#81D8D0",stopOpacity:.6})]})})]})})]}),e.jsxs("div",{className:"score-breakdown-card",children:[e.jsxs("h3",{children:["📊 ",t("tests.score")]}),e.jsx("div",{className:"score-breakdown",children:K.map(s=>e.jsxs("div",{className:"score-item",children:[e.jsx("span",{className:"score-label",children:s.name}),e.jsx("span",{className:"score-value",children:s.state.score||"未測試"})]},s.key))}),e.jsxs("div",{className:"average-score-display",children:[e.jsxs("p",{className:"average-score",children:[t("tests.averageScore"),": ",f]}),e.jsx("p",{className:"average-comment",children:Ye(f,w)})]})]})]})]}),k==="standards"&&e.jsxs("div",{className:"standards-tab",children:[e.jsxs("div",{className:"standards-content",children:[e.jsx("p",{children:t("tests.strengthStandards.intro")}),e.jsxs("p",{className:"source-link",children:[t("tests.strengthStandards.sourceLabel"),e.jsx("a",{href:"https://strengthlevel.com/",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:"https://strengthlevel.com/"})]})]}),e.jsxs("div",{className:"score-levels-table",children:[e.jsx("h3",{children:t("tests.strengthStandards.scoreLevelsTitle")}),e.jsx("div",{className:"levels-container",children:ts.map((s,a)=>e.jsxs("div",{className:"level-item",children:[e.jsxs("div",{className:"level-header",children:[e.jsx("span",{className:"level-name",children:s.level}),e.jsx("span",{className:"level-score",children:s.score})]}),e.jsx("div",{className:"level-bar-container",children:e.jsx("div",{className:"level-bar",style:{width:`${s.score}%`,background:`linear-gradient(to right, ${s.color}dd, ${s.color})`}})})]},a))})]}),e.jsxs("div",{className:"score-table",children:[e.jsx("h3",{children:t("tests.strengthStandards.scoreTableTitle")}),e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:t("tests.strengthStandards.table.range")}),e.jsx("th",{children:t("tests.strengthStandards.table.description")})]})}),e.jsx("tbody",{children:ss.map((s,a)=>e.jsxs("tr",{children:[e.jsx("td",{children:s.range}),e.jsx("td",{children:s.description})]},a))})]})]})]}),e.jsx("div",{className:"submit-section",children:e.jsx("button",{type:"button",onClick:es,className:"submit-btn",disabled:!f||E,children:E?t("common.submitting"):f?`✅ ${t("common.submitAndReturn")}`:t("errors.required")})})]})}_s.propTypes={onComplete:Xe.func,clearTestData:Xe.func};export{_s as default};

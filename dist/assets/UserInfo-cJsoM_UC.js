import{u as we,a as ee,c as ue,d as Q,b as k,g as ke,j as e,r as Te,s as Oe,e as Le,f as Me}from"./index-DwtH3JME.js";import{r as l,d as Re,u as Fe}from"./react-vendor-BToktFYo.js";import{l as fe,s as Ue,q as qe,t as Ae,w as Ee,v as Pe,x as ze,y as Ve,z as Be}from"./firebase-D0136ThQ.js";import{P as d,R as Ge,a as Je,b as We,c as De,d as He,e as Ye}from"./charts-BNGpwEcn.js";const q={strength:0,explosivePower:0,cardio:0,muscleMass:0,bodyFat:0},_e=["male","female"],he=({isOpen:u,onClose:C,title:v,message:n,type:c="info",onAction:j=null,actionText:g=null})=>{const{t:N}=ee();if(!u)return null;const s=()=>{switch(c){case"warning":return"⚠️";case"success":return"✅";case"error":return"❌";default:return"ℹ️"}},x=()=>{switch(c){case"warning":return"modal-btn modal-btn-warning";case"success":return"modal-btn modal-btn-success";case"error":return"modal-btn modal-btn-error";default:return"modal-btn modal-btn-info"}},p=()=>{console.log("Modal close button clicked"),C()},y=()=>{console.log("Modal overlay clicked"),C()},w=()=>{j&&j(),C()};return e.jsx("div",{className:"modal-overlay",onClick:y,children:e.jsxs("div",{className:"modal-content",onClick:T=>T.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("span",{className:"modal-icon",children:s()}),e.jsx("h3",{className:"modal-title",children:v})]}),e.jsx("div",{className:"modal-body",children:e.jsx("p",{className:"modal-message",children:n})}),e.jsx("div",{className:"modal-footer",children:j&&g?e.jsxs("div",{className:"modal-footer-actions",children:[e.jsx("button",{className:"modal-btn modal-btn-secondary",onClick:p,children:N("common.cancel")}),e.jsx("button",{className:x(),onClick:w,style:{position:"relative",zIndex:10001},children:g||N("common.confirm")})]}):e.jsx("button",{className:x(),onClick:p,style:{position:"relative",zIndex:10001},children:N("common.confirm")})})]})})};he.propTypes={isOpen:d.bool.isRequired,onClose:d.func.isRequired,title:d.string.isRequired,message:d.string.isRequired,type:d.oneOf(["info","warning","success","error"]),onAction:d.func,actionText:d.string};const Z=({isOpen:u,onConfirm:C,onCancel:v,remainingCount:n})=>{const{t:c}=ee();if(!u)return null;const j=g=>{g.target===g.currentTarget&&v()};return e.jsx("div",{className:"modal-overlay submit-confirm-overlay",onClick:j,children:e.jsxs("div",{className:"modal-content submit-confirm-content",onClick:g=>g.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("span",{className:"modal-icon",children:"🏆"}),e.jsx("h3",{className:"modal-title",children:c("userInfo.submitConfirm.title")})]}),e.jsx("div",{className:"modal-body",children:e.jsxs("div",{className:"submit-confirm-message",children:[e.jsxs("p",{className:"confirm-text",children:[c("userInfo.submitConfirm.descPrefix")," ",e.jsx("span",{className:"remaining-count",children:n})," ",c("userInfo.submitConfirm.descSuffix")]}),e.jsxs("div",{className:"limit-info",children:[e.jsxs("div",{className:"limit-item",children:[e.jsx("span",{className:"limit-icon",children:"🔄"}),e.jsx("span",{className:"limit-text",children:c("userInfo.limits.remainingUpdates",{count:n})})]}),e.jsxs("div",{className:"limit-item",children:[e.jsx("span",{className:"limit-icon",children:"⏰"}),e.jsx("span",{className:"limit-text",children:c("userInfo.limits.nextResetTime")})]})]}),e.jsxs("div",{className:"confirm-details",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-icon",children:"📊"}),e.jsx("span",{className:"detail-text",children:c("userInfo.submitConfirm.ensureAccuracy")})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-icon",children:"⏰"}),e.jsx("span",{className:"detail-text",children:c("userInfo.submitConfirm.resetDaily")})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-icon",children:"🎯"}),e.jsx("span",{className:"detail-text",children:c("userInfo.submitConfirm.improveValue")})]})]})]})}),e.jsxs("div",{className:"modal-footer submit-confirm-footer",children:[e.jsx("button",{className:"modal-btn modal-btn-secondary",onClick:v,children:c("userInfo.submitConfirm.cancel")}),e.jsx("button",{className:"modal-btn modal-btn-success",onClick:C,children:c("userInfo.submitConfirm.confirm")})]})]})})};Z.propTypes={isOpen:d.bool.isRequired,onConfirm:d.func.isRequired,onCancel:d.func.isRequired,remainingCount:d.number.isRequired};async function Ke(u,C=300*1024,v=192,n=192){return new Promise((c,j)=>{const g=new window.Image,N=new FileReader;N.onload=s=>{g.src=s.target.result},g.onload=()=>{const s=document.createElement("canvas");let x=g.width,p=g.height;(x>v||p>n)&&(x>p?(p=Math.round(p*v/x),x=v):(x=Math.round(x*n/p),p=n)),s.width=x,s.height=p,s.getContext("2d").drawImage(g,0,0,x,p),s.toBlob(w=>{w.size>C?s.toBlob(T=>{c(T)},"image/jpeg",.7):c(w)},"image/jpeg",.85)},g.onerror=j,N.onerror=j,N.readAsDataURL(u)})}function $e({testData:u,onLogout:C,clearTestData:v}){const{userData:n,setUserData:c,saveHistory:j,loadUserData:g,isLoading:N}=we(),{t:s}=ee(),[x,p]=l.useState(null),[y,w]=l.useState(!1),[T,ge]=l.useState(null),[H,pe]=l.useState(!1),S=Re(),Y=Fe(),A=l.useRef(null),_=l.useRef(null),G=l.useRef(null),[se,K]=l.useState(!1),[ne,U]=l.useState(null),ae=l.useRef(null),[L,m]=l.useState({isOpen:!1,title:"",message:"",type:"info",onAction:null,actionText:null}),[xe,E]=l.useState(null),[I,J]=l.useState({lastSubmissionTime:null,dailySubmissionCount:0,lastSubmissionDate:null}),[P,$]=l.useState({isOpen:!1,remainingCount:3}),[te,re]=l.useState({show:!1,message:""}),W=l.useCallback(()=>{const t=new Date,a=t.toDateString();if(I.lastSubmissionDate!==a)return J(r=>({...r,dailySubmissionCount:0,lastSubmissionDate:a})),{canSubmit:!0,reason:null};if(I.dailySubmissionCount>=3)return{canSubmit:!1,reason:s("userInfo.limits.limitReachedMessage")};if(I.lastSubmissionTime){const r=t-I.lastSubmissionTime,i=2*60*60*1e3;if(r<i){const f=Math.ceil((i-r)/6e4);return{canSubmit:!1,reason:s("userInfo.limits.cooldownMessage",{minutes:f})}}}return{canSubmit:!0,reason:null}},[I,s]),ie=l.useCallback(()=>{const t=W();if(!t.canSubmit){m({isOpen:!0,title:s("userInfo.limits.limitReached"),message:t.reason,type:"warning",onAction:()=>{m(r=>({...r,isOpen:!1})),S("/ladder")},actionText:s("userInfo.modal.viewLadder")});return}const a=3-(I.dailySubmissionCount||0);$({isOpen:!0,remainingCount:Math.max(0,a)})},[I,W,s,S]),oe=l.useCallback(async()=>{if($({isOpen:!1,remainingCount:0}),!y)try{w(!0);const t=n.scores||{},a=ue(t),r={...n,ladderScore:a,lastLadderSubmission:new Date().toISOString()};c(r);try{const i={...n,ladderScore:a,lastLadderSubmission:new Date().toISOString(),updatedAt:new Date().toISOString()};localStorage.setItem("userData",JSON.stringify(i)),localStorage.setItem("lastSavedUserData",JSON.stringify(i));const f=fe(Q,"users",k.currentUser.uid);await Ue(f,{ladderScore:a,lastLadderSubmission:new Date().toISOString(),updatedAt:new Date().toISOString()},{merge:!0}),console.log("天梯分數已立即保存到 Firebase:",a)}catch(i){throw console.error("保存天梯分數失敗:",i),i}const o=new Date;J(i=>({lastSubmissionTime:o,dailySubmissionCount:i.dailySubmissionCount+1,lastSubmissionDate:o.toDateString()})),m({isOpen:!0,title:s("userInfo.modal.submitSuccessTitle"),message:s("userInfo.modal.submitSuccessMessage",{score:a}),type:"success",onAction:()=>{m(i=>({...i,isOpen:!1})),S("/ladder",{state:{forceReload:!0,from:"/user-info",timestamp:Date.now()}})},actionText:s("userInfo.modal.viewLadder")}),setTimeout(()=>{m(i=>({...i,isOpen:!1}))},5e3)}catch(t){console.error("提交到天梯失敗:",t),m({isOpen:!0,title:s("userInfo.modal.submitFailTitle"),message:s("userInfo.modal.submitFailMessage"),type:"error"})}finally{w(!1)}},[n.scores,c,y,S]),le=l.useCallback(()=>{$({isOpen:!1,remainingCount:0})},[]),be=l.useCallback(async()=>{if(!k.currentUser){m({isOpen:!0,title:s("community.messages.needLogin"),message:s("userInfo.limits.needLoginToSubmit"),type:"warning"});return}const t=n.scores||{},a=Object.values(t).filter(i=>i>0).length;if(a<5){m({isOpen:!0,title:s("userInfo.limits.assessmentIncomplete"),message:s("userInfo.limits.assessmentIncompleteMessage",{count:a}),type:"warning"});return}const{canSubmit:r,reason:o}=W();if(!r){m({isOpen:!0,title:s("userInfo.limits.limitReached"),message:o,type:"warning",onAction:()=>{m(i=>({...i,isOpen:!1})),S("/ladder")},actionText:s("userInfo.modal.viewLadder")});return}ie()},[n,ie,m,W,s,S,k.currentUser]),ce=l.useMemo(()=>{const t=n.scores||q;return[{name:s("userInfo.radarLabels.strength"),value:t.strength?Number(t.strength).toFixed(2)*1:0,icon:"💪"},{name:s("userInfo.radarLabels.explosivePower"),value:t.explosivePower?Number(t.explosivePower).toFixed(2)*1:0,icon:"⚡"},{name:s("userInfo.radarLabels.cardio"),value:t.cardio?Number(t.cardio).toFixed(2)*1:0,icon:"❤️"},{name:s("userInfo.radarLabels.muscle"),value:t.muscleMass?Number(t.muscleMass).toFixed(2)*1:0,icon:"🥩"},{name:s("userInfo.radarLabels.ffmi"),value:t.bodyFat?Number(t.bodyFat).toFixed(2)*1:0,icon:"📊"}]},[n.scores]),M=l.useMemo(()=>sessionStorage.getItem("guestMode")==="true",[]),de=({payload:t,x:a,y:r})=>{const o=ce.find(O=>O.name===t.value);let i=a,f=r;const h=Math.sqrt(a*a+r*r),b=Math.atan2(r,a);return t.value===s("userInfo.radarLabels.strength")?(i=a,f=r-h*.12):t.value===s("userInfo.radarLabels.explosivePower")?(i=a+Math.cos(b)*(h*.03),f=r+Math.sin(b)*(h*.06)):t.value===s("userInfo.radarLabels.ffmi")?(i=a+Math.cos(b)*(h*-.2),f=r+Math.sin(b)*(h*.06)):t.value===s("userInfo.radarLabels.cardio")?(i=a+Math.cos(b)*(h*.01),f=r+Math.sin(b)*(h*.06)):t.value===s("userInfo.radarLabels.muscle")?(i=a+Math.cos(b)*(h*-.05),f=r+Math.sin(b)*(h*.06)):(i=a+Math.cos(b)*(h*.1),f=r+Math.sin(b)*(h*.1)),e.jsxs("g",{transform:`translate(${i},${f})`,children:[e.jsx("defs",{children:e.jsxs("filter",{id:"glow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[e.jsx("feGaussianBlur",{stdDeviation:"3",result:"coloredBlur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"coloredBlur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),e.jsx("circle",{cx:0,cy:0,r:16,fill:"rgba(129, 216, 208, 0.1)",filter:"url(#glow)"}),e.jsx("circle",{cx:0,cy:0,r:14,fill:"rgba(255, 255, 255, 0.95)",stroke:"rgba(129, 216, 208, 0.4)",strokeWidth:2,filter:"drop-shadow(0 2px 4px rgba(129, 216, 208, 0.2))"}),e.jsx("text",{x:0,y:-8,textAnchor:"middle",fill:"#4a5568",fontSize:"16",fontWeight:"600",dominantBaseline:"middle",filter:"drop-shadow(0 1px 2px rgba(0, 0, 0, 0.1))",children:o==null?void 0:o.icon}),e.jsx("text",{x:0,y:12,textAnchor:"middle",fill:"#2d3748",fontSize:"13",fontWeight:"700",dominantBaseline:"middle",filter:"drop-shadow(0 1px 3px rgba(255, 255, 255, 0.9))",children:t.value})]})};de.propTypes={payload:d.shape({value:d.string.isRequired}).isRequired,x:d.number.isRequired,y:d.number.isRequired},l.useEffect(()=>{if(!k){p("無法初始化身份驗證，請檢查 Firebase 配置並稍後再試。"),console.error("auth 未初始化");return}const t=k.onAuthStateChanged(a=>{console.log("UserInfo - 認證狀態變更:",a==null?void 0:a.email),ge(a),!a&&!M&&S("/login")});return()=>t()},[]),l.useEffect(()=>{(async()=>{T&&!H&&!N&&(console.log("UserInfo - 檢查資料載入狀態"),!n.height&&!n.weight&&!n.age&&(console.log("UserInfo - 資料為空，嘗試重新載入"),await g(T,!0)),pe(!0))})()},[T,H,N,g,n.height,n.weight,n.age]),l.useEffect(()=>{var o,i;const t=["/strength","/explosive-power","/cardio","/muscle-mass","/body-fat"],a=(o=Y.state)==null?void 0:o.from;a&&t.includes(a)&&setTimeout(()=>{A.current&&A.current.scrollIntoView({behavior:"smooth",block:"center"})},300);const r=(i=Y.state)==null?void 0:i.scrollTo;r&&setTimeout(()=>{r==="radar"&&A.current?A.current.scrollIntoView({behavior:"smooth",block:"center"}):r==="tests"&&_.current&&_.current.scrollIntoView({behavior:"smooth",block:"start"})},300)},[Y]),l.useEffect(()=>{(()=>{try{const a=localStorage.getItem("ladderSubmissionState");if(a){const r=JSON.parse(a),o=new Date().toDateString();r.lastSubmissionDate!==o?J({lastSubmissionTime:null,dailySubmissionCount:0,lastSubmissionDate:o}):J(r)}}catch(a){console.error("載入提交狀態失敗:",a)}})()},[]),l.useEffect(()=>{I.lastSubmissionDate&&localStorage.setItem("ladderSubmissionState",JSON.stringify(I))},[I]),l.useEffect(()=>{if(u&&Object.keys(u).length>0){console.log("收到測試數據:",u);const t=JSON.stringify(u);if(ae.current===t)return;ae.current=t;const a=setTimeout(()=>{c(r=>{const i={...r.scores||q,...u.distance!==void 0&&{cardio:u.score||0},...u.squat!==void 0&&{strength:u.averageScore||0},...(u.finalScore!==void 0||u.verticalJump!==void 0||u.standingLongJump!==void 0||u.sprint!==void 0)&&{explosivePower:u.finalScore||0},...u.smm!==void 0&&{muscleMass:u.finalScore||0},...u.bodyFat!==void 0&&{bodyFat:u.ffmiScore||0}};return console.log("💾 防抖後更新測試數據分數（5秒防抖）"),{...r,scores:i,ladderScore:r.ladderScore||0}})},5e3);return v&&setTimeout(v,6e3),()=>clearTimeout(a)}},[u,v]);const D=l.useCallback(()=>{const{height:t,weight:a,age:r,gender:o}=n;return!t||!a||!r||!o?(p(s("errors.required")),!1):t<=0||a<=0||r<=0?(p(s("userInfo.modal.invalidPositive")),!1):_e.includes(o)?!0:(p(s("userInfo.modal.invalidGender")),!1)},[n]),ve=l.useCallback(async t=>{if(t.preventDefault(),p(null),w(!0),!D()){w(!1);return}const a={...n,height:Number(n.height)||0,weight:Number(n.weight)||0,age:Number(n.age)||0,gender:n.gender,scores:n.scores||q,ladderScore:n.ladderScore||0,lastActive:new Date().toISOString()};try{c(a),m({isOpen:!0,title:s("userInfo.modal.saveSuccessTitle"),message:s("userInfo.modal.saveSuccessMessage"),type:"success"})}catch(r){m(M?{isOpen:!0,title:"訪客模式",message:"訪客模式下無法保存到雲端，但您現在可以開始進行評測了！",type:"info"}:{isOpen:!0,title:"儲存失敗",message:`儲存失敗：${r.message}`,type:"error"})}finally{w(!1)}},[n,D,M,c]),z=l.useMemo(()=>{const t=(n==null?void 0:n.scores)||q,a=Object.values(t).filter(o=>o>0);return a.length?(a.reduce((o,i)=>o+Number(i),0)/a.length).toFixed(2):0},[n==null?void 0:n.scores]),X=l.useMemo(()=>{const t=(n==null?void 0:n.scores)||q;return ue(t)},[n==null?void 0:n.scores]),R=(n==null?void 0:n.ladderScore)||0,V=l.useMemo(()=>{const t=(n==null?void 0:n.scores)||q,a=Object.values(t).filter(o=>o>0).length;return{completedCount:a,isFullyCompleted:a===5,progress:a/5*100}},[n==null?void 0:n.scores]),me=l.useCallback(async()=>{if(!(n!=null&&n.userId)||!R||R<=0){E(null);return}try{const t=qe(Q,"users"),a=Ae(t,Ee("ladderScore",">",0),Pe("ladderScore","desc"),ze(100)),r=await Ve(a),o=[];r.forEach(f=>{const h=f.data();h.ladderScore>0&&o.push({id:f.id,...h})});const i=o.findIndex(f=>f.id===n.userId);E(i!==-1?i+1:null)}catch(t){console.error("獲取用戶排名失敗:",t),E(null)}},[n==null?void 0:n.userId,R,E]);l.useEffect(()=>{me()},[me,c]);const je=l.useCallback(t=>{const a=t.target.value,r=/[\u4e00-\u9fff]/.test(a);let o=!0,i="";if(r?a.length>8&&(o=!1,i="暱稱不能超過8個中文字"):a.length>16&&(o=!1,i="暱稱不能超過16個英文字元"),!o){m({isOpen:!0,title:"字數限制",message:i,type:"warning"});return}c(f=>({...f,nickname:a})),G.current&&clearTimeout(G.current),G.current=setTimeout(()=>{G.current=null},1e3)},[c,m]),Ne=l.useCallback(()=>{var r;const t=(r=k.currentUser)==null?void 0:r.email,a=ke(t);c(o=>({...o,nickname:a,ladderScore:o.ladderScore||0}))},[c]),ye=l.useCallback(()=>{if(!k.currentUser){m({isOpen:!0,title:"需要登入",message:"請先登入以儲存結果",type:"warning"});return}const t={date:new Date().toLocaleDateString("zh-TW"),scores:n.scores,averageScore:z};j(t),m({isOpen:!0,title:s("userInfo.modal.resultSaveSuccessTitle"),message:s("userInfo.modal.resultSaveSuccessMessage"),type:"success"}),setTimeout(()=>{m(a=>({...a,isOpen:!1}))},2e3)},[n.scores,z,j,m]),B=l.useCallback(async t=>{if(!n.height||!n.weight||!n.age||!n.gender){m({isOpen:!0,title:"需要基本資料",message:"請先填寫並儲存您的身高、體重、年齡和性別，才能開始評測！",type:"warning"});return}D()?S(t,{state:{from:"/user-info"}}):m({isOpen:!0,title:"資料未保存",message:"請確保資料已正確保存後再進行評測！",type:"warning"})},[n,D,S,m]),Se=l.useCallback(()=>{localStorage.removeItem("savedEmail"),localStorage.removeItem("savedPassword"),k.currentUser&&k.signOut().catch(t=>console.error("登出失敗:",t)),C(),S("/login")},[C,S]),F=l.useCallback(t=>{const{name:a,value:r}=t.target;let o=r;if(a==="gender"||["profession"].includes(a)?o=r:["weeklyTrainingHours","trainingYears"].includes(a)?o=r===""?"":Number(r):o=r===""?0:Number(r),a==="weight"){const i=n.weight||0,f=o;i>0&&f>0&&i!==f&&(re({show:!0,message:s("userInfo.weightChangeReminder")}),setTimeout(()=>{re(h=>({...h,show:!1}))},3e3))}c(i=>({...i,[a]:o,ladderScore:i.ladderScore||0}))},[c,n.weight,s]),Ie=async t=>{var r;U(null);const a=t.target.files[0];if(a){if(!a.type.startsWith("image/")){U("請選擇圖片檔案");return}if(a.size>2*1024*1024){U("圖片大小請勿超過 2MB");return}K(!0);try{const o=await Ke(a,307200,192,192);if(o.size>350*1024){U("壓縮後圖片仍超過 350KB，請選擇更小的圖片"),K(!1);return}const i=(r=k.currentUser)==null?void 0:r.uid;if(!i)throw new Error("未登入，無法上傳頭像");console.log("🔧 開始上傳頭像:",{userId:i,fileSize:o.size});const f=Te(Oe,`avatars/${i}/avatar.jpg`),h={contentType:"image/jpeg",customMetadata:{"uploaded-by":i,"upload-time":new Date().toISOString()}};await Le(f,o,h),console.log("✅ 頭像上傳成功");const b=await Me(f);console.log("✅ 獲取下載 URL 成功:",b),c(O=>({...O,avatarUrl:b,ladderScore:O.ladderScore||0}));try{const O=fe(Q,"users",i);await Be(O,{avatarUrl:b,updatedAt:new Date().toISOString()}),console.log("頭像已立即保存到 Firebase"),m({isOpen:!0,title:"頭像上傳成功",message:"您的頭像已成功更新！",type:"success"}),setTimeout(()=>{m(Ce=>({...Ce,isOpen:!1}))},2e3)}catch(O){console.error("頭像保存到 Firebase 失敗:",O),U("頭像保存失敗: "+O.message)}}catch(o){U("頭像上傳失敗: "+o.message)}finally{K(!1)}}};return N&&!H?e.jsx("div",{className:"user-info-container",children:e.jsx("div",{className:"loading-message",children:e.jsx("p",{children:s("common.loading")})})}):e.jsxs("div",{className:"user-info-container",children:[e.jsx(he,{isOpen:L.isOpen,onClose:()=>{console.log("Modal onClose triggered, current state:",L),m(t=>(console.log("Setting modal state to closed"),{...t,isOpen:!1}))},title:L.title,message:L.message,type:L.type,onAction:L.onAction,actionText:L.actionText}),e.jsx(Z,{isOpen:P.isOpen,onConfirm:oe,onCancel:le,remainingCount:P.remainingCount}),x&&e.jsx("p",{className:"error-message",children:x}),e.jsxs("div",{className:"avatar-section",children:[e.jsx("div",{className:"avatar-container",children:e.jsx("img",{src:M?"/guest-avatar.svg":(n==null?void 0:n.avatarUrl)||"/default-avatar.svg",alt:s("community.ui.avatarAlt"),className:"user-avatar",loading:"lazy",onError:t=>{t.target.src="/default-avatar.svg"}})}),e.jsxs("div",{className:"avatar-actions-container",children:[!M&&e.jsxs("label",{className:"avatar-upload-label",children:[s(se?"userInfo.avatar.uploading":"userInfo.avatar.change"),e.jsx("input",{type:"file",accept:"image/*",style:{display:"none"},onChange:Ie,disabled:se})]}),M&&e.jsx("div",{className:"guest-avatar-note",children:e.jsx("span",{children:"訪客模式"})})]}),ne&&e.jsx("div",{className:"avatar-error",children:ne})]}),(T||M)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{className:"page-title",children:s("userInfo.title")}),e.jsx("div",{className:"page-subtitle",children:s("userInfo.subtitle")})]}),e.jsx("div",{className:"form-card",children:e.jsxs("form",{className:"user-form",onSubmit:ve,children:[e.jsxs("div",{className:"form-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h3",{className:"section-title",children:s("userInfo.basicInfo")}),T&&e.jsx("button",{type:"button",onClick:Se,title:"登出",className:"user-info__logout-btn",onMouseEnter:t=>{const a=document.createElement("div");a.innerText="登出",a.style.position="absolute",a.style.bottom="44px",a.style.left="50%",a.style.transform="translateX(-50%)",a.style.background="rgba(60,60,60,0.95)",a.style.color="#fff",a.style.padding="6px 14px",a.style.borderRadius="6px",a.style.fontSize="13px",a.style.whiteSpace="nowrap",a.style.pointerEvents="none",a.style.zIndex="1001",a.className="logout-tooltip",t.currentTarget.parentNode.appendChild(a)},onMouseLeave:t=>{const a=t.currentTarget.parentNode.querySelector(".logout-tooltip");a&&a.remove()},children:e.jsx("span",{className:"user-info__logout-icon",children:"⎋"})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"nickname",className:"form-label",children:s("userInfo.nickname")}),e.jsxs("div",{className:"nickname-input-group",children:[e.jsx("input",{id:"nickname",name:"nickname",type:"text",value:(n==null?void 0:n.nickname)||"",onChange:je,placeholder:s("userInfo.nicknamePlaceholder"),className:"form-input",maxLength:"16"}),e.jsx("button",{type:"button",onClick:Ne,className:"generate-nickname-btn",children:s("userInfo.generateNickname")})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"gender",className:"form-label",children:s("userInfo.gender")}),e.jsxs("select",{id:"gender",name:"gender",value:(n==null?void 0:n.gender)||"",onChange:F,className:"form-input",required:!0,onInvalid:t=>t.currentTarget.setCustomValidity(s("errors.required")),onInput:t=>t.currentTarget.setCustomValidity(""),children:[e.jsx("option",{value:"",children:s("userInfo.selectGender")}),e.jsx("option",{value:"male",children:s("userInfo.male")}),e.jsx("option",{value:"female",children:s("userInfo.female")})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"age",className:"form-label",children:s("userInfo.age")}),e.jsx("input",{id:"age",name:"age",type:"number",value:(n==null?void 0:n.age)||"",onChange:F,placeholder:s("userInfo.age"),className:"form-input",required:!0,onInvalid:t=>t.currentTarget.setCustomValidity(s("errors.required")),onInput:t=>t.currentTarget.setCustomValidity(""),min:"0",step:"1"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"height",className:"form-label",children:s("userInfo.height")}),e.jsx("input",{id:"height",name:"height",type:"number",value:(n==null?void 0:n.height)||"",onChange:F,placeholder:s("userInfo.height"),className:"form-input",required:!0,onInvalid:t=>t.currentTarget.setCustomValidity(s("errors.required")),onInput:t=>t.currentTarget.setCustomValidity(""),min:"0",step:"0.1"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"weight",className:"form-label",children:s("userInfo.weight")}),e.jsxs("div",{className:"input-with-reminder",children:[e.jsx("input",{id:"weight",name:"weight",type:"number",value:(n==null?void 0:n.weight)||"",onChange:F,placeholder:s("userInfo.weight"),className:"form-input",required:!0,onInvalid:t=>t.currentTarget.setCustomValidity(s("errors.required")),onInput:t=>t.currentTarget.setCustomValidity(""),min:"0",step:"0.1"}),te.show&&e.jsxs("div",{className:"weight-reminder-bubble",children:[e.jsx("span",{className:"reminder-icon",children:"💡"}),e.jsx("span",{className:"reminder-text",children:te.message})]})]})]})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsxs("h3",{className:"section-title",children:["🏆 ",s("userInfo.ladder.title")]}),e.jsx("div",{className:"privacy-options",children:e.jsxs("label",{className:"privacy-option",children:[e.jsx("input",{type:"checkbox",checked:n.isAnonymousInLadder===!0,onChange:t=>c(a=>({...a,isAnonymousInLadder:t.target.checked}))}),e.jsxs("div",{className:"privacy-option-content",children:[e.jsx("span",{className:"privacy-option-title",children:s("userInfo.ladder.anonymousTitle")}),e.jsx("span",{className:"privacy-option-desc",children:s("userInfo.ladder.anonymousDesc")})]})]})}),e.jsxs("div",{className:"training-info-section",children:[e.jsxs("h4",{className:"training-info-title",children:["💪 ",s("userInfo.training.title")]}),e.jsx("p",{className:"training-info-desc",children:s("userInfo.training.desc")}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"profession",className:"form-label",children:s("userInfo.training.profession")}),e.jsx("input",{id:"profession",name:"profession",type:"text",value:(n==null?void 0:n.profession)||"",onChange:F,placeholder:s("userInfo.placeholders.profession"),className:"form-input",maxLength:"100"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"weeklyTrainingHours",className:"form-label",children:s("userInfo.training.weeklyHours")}),e.jsx("input",{id:"weeklyTrainingHours",name:"weeklyTrainingHours",type:"number",value:(n==null?void 0:n.weeklyTrainingHours)||"",onChange:F,placeholder:s("userInfo.placeholders.hours"),className:"form-input",min:"0",max:"168",step:"0.5"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"trainingYears",className:"form-label",children:s("userInfo.training.years")}),e.jsx("input",{id:"trainingYears",name:"trainingYears",type:"number",value:(n==null?void 0:n.trainingYears)||"",onChange:F,placeholder:s("userInfo.placeholders.years"),className:"form-input",min:"0",max:"50",step:"0.5"})]})]})]}),e.jsx("div",{className:"form-actions",children:e.jsx("button",{type:"submit",className:"submit-btn",disabled:y,children:s(y?"userInfo.saving":"userInfo.saveData")})})]})})]}),e.jsx("div",{id:"radar-section",className:"radar-section",ref:A,children:e.jsxs("div",{className:"radar-card",children:[e.jsx("div",{className:"corner-decoration top-left"}),e.jsx("div",{className:"corner-decoration top-right"}),e.jsx("div",{className:"corner-decoration bottom-left"}),e.jsx("div",{className:"corner-decoration bottom-right"}),e.jsx("h2",{className:"radar-title",children:s("userInfo.radarOverview")}),y?e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"正在載入數據..."})]}):e.jsx("div",{className:"radar-chart-container",children:e.jsx(Ge,{width:"100%",height:400,children:e.jsxs(Je,{data:ce,children:[e.jsx(We,{gridType:"polygon",stroke:"rgba(129, 216, 208, 0.25)",strokeWidth:2,strokeDasharray:"4 4"}),e.jsx(De,{dataKey:"name",tick:e.jsx(de,{}),axisLine:!1}),e.jsx(He,{angle:90,domain:[0,100],tickCount:5,tick:{fontSize:12,fill:"#2d3748",fontWeight:600},axisLine:!1}),e.jsx(Ye,{name:s("userInfo.yourPerformance"),dataKey:"value",stroke:"#81D8D0",fill:"url(#tiffanyGradient)",fillOpacity:.8,strokeWidth:4,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("defs",{children:e.jsxs("linearGradient",{id:"tiffanyGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#81D8D0",stopOpacity:.9}),e.jsx("stop",{offset:"50%",stopColor:"#5F9EA0",stopOpacity:.7}),e.jsx("stop",{offset:"100%",stopColor:"#81D8D0",stopOpacity:.6})]})})]})})}),!y&&e.jsxs("div",{className:"score-section",children:[z>0&&e.jsxs("div",{className:"average-score-display",children:[e.jsxs("p",{className:"average-score",children:["⭐ ",s("userInfo.powerTitle")," ",e.jsx("span",{className:"score-value-large",children:z})]}),V.isFullyCompleted&&e.jsxs("div",{className:"ladder-info",children:[e.jsxs("p",{className:"ladder-rank",children:["🏆 ",s("userInfo.ladder.rankLabel"),":"," ",e.jsx("span",{className:"rank-value",children:xe||"未上榜"})]}),R>0&&e.jsxs("p",{className:"submitted-score",children:[s("userInfo.ladder.submittedScore"),":"," ",e.jsx("span",{className:"score-value",children:R})]}),X>0&&X!==R&&e.jsxs("p",{className:"current-score",children:[s("userInfo.ladder.currentScore"),":"," ",e.jsx("span",{className:"score-value",children:X}),e.jsx("span",{className:"score-note",children:s("userInfo.ladder.needsSubmit")})]})]})]}),e.jsxs("div",{className:"action-buttons-section",children:[z>0&&e.jsxs("button",{onClick:ye,className:"action-btn save-results-btn",disabled:y,children:[e.jsx("span",{className:"btn-icon",children:"💾"}),e.jsx("span",{className:"btn-text",children:s("userInfo.saveResults")})]}),V.isFullyCompleted&&e.jsxs("button",{onClick:be,className:"action-btn submit-ladder-btn",disabled:y,children:[e.jsx("span",{className:"btn-icon",children:"🏆"}),e.jsx("span",{className:"btn-text",children:R>0?s("userInfo.updateLadderScore"):s("userInfo.submitToLadder")})]})]}),V.isFullyCompleted&&e.jsxs("div",{className:"ladder-limits-info",children:[e.jsxs("div",{className:"limit-info-item",children:[e.jsx("span",{className:"limit-icon",children:"🔄"}),e.jsx("span",{className:"limit-text",children:s("userInfo.limits.remainingUpdates",{count:3-(I.dailySubmissionCount||0)})})]}),e.jsxs("div",{className:"limit-info-item",children:[e.jsx("span",{className:"limit-icon",children:"⏰"}),e.jsx("span",{className:"limit-text",children:s("userInfo.limits.nextResetTime")})]}),e.jsxs("div",{className:"limit-info-item",children:[e.jsx("span",{className:"limit-icon",children:"ℹ️"}),e.jsx("span",{className:"limit-text",children:s("userInfo.limits.limitInfo")})]})]}),e.jsx("div",{className:"ladder-info-card",children:e.jsx("p",{className:"ladder-info-text",children:V.isFullyCompleted?s("userInfo.ladder.ctaCompleted"):s("userInfo.ladder.ctaNotCompleted",{count:V.completedCount})})})]})]})}),e.jsxs("div",{className:"test-buttons-section",ref:_,children:[e.jsx("h3",{className:"section-title",children:s("userInfo.startTests")}),e.jsxs("div",{className:"test-buttons-grid",children:[e.jsxs("button",{onClick:()=>B("/strength"),className:"test-btn strength-btn",children:[e.jsx("span",{className:"test-icon",children:"💪"}),e.jsx("span",{className:"test-label",children:s("tests.strength")})]}),e.jsxs("button",{onClick:()=>B("/explosive-power"),className:"test-btn explosive-btn",children:[e.jsx("span",{className:"test-icon",children:"⚡"}),e.jsx("span",{className:"test-label",children:s("tests.explosivePower")})]}),e.jsxs("button",{onClick:()=>B("/cardio"),className:"test-btn cardio-btn",children:[e.jsx("span",{className:"test-icon",children:"❤️"}),e.jsx("span",{className:"test-label",children:s("tests.cardio")})]}),e.jsxs("button",{onClick:()=>B("/muscle-mass"),className:"test-btn muscle-btn",children:[e.jsx("span",{className:"test-icon",children:"🥩"}),e.jsx("span",{className:"test-label",children:s("tests.muscleMass")})]}),e.jsxs("button",{onClick:()=>B("/body-fat"),className:"test-btn bodyfat-btn",children:[e.jsx("span",{className:"test-icon",children:"📊"}),e.jsx("span",{className:"test-label",children:s("tests.bodyFat")})]})]})]}),P.isOpen&&e.jsx(Z,{isOpen:P.isOpen,onConfirm:oe,onCancel:le,remainingCount:P.remainingCount})]})}$e.propTypes={testData:d.shape({distance:d.number,score:d.number,squat:d.number,averageScore:d.number,jumpHeight:d.number,finalScore:d.number,smm:d.number,bodyFat:d.number,ffmiScore:d.number,verticalJump:d.number,standingLongJump:d.number,sprint:d.number}),onLogout:d.func.isRequired,clearTestData:d.func.isRequired};export{$e as default};

import{u as D,a as R,j as e}from"./index-u_ODcrAP.js";import{d as k,r as d}from"./react-vendor-BToktFYo.js";import{u as w,v as U}from"./standards-Dj82V2Ks.js";import{P as S}from"./charts-BNGpwEcn.js";import"./firebase-D0136ThQ.js";function P({onComplete:u}){var b,N;const{userData:n,setUserData:p}=D(),j=k(),{age:f,gender:l}=n,{t}=R(),[o,y]=d.useState(((N=(b=n.testInputs)==null?void 0:b.cardio)==null?void 0:N.distance)||""),[i,E]=d.useState(null),[m,v]=d.useState(!1),[x,g]=d.useState(!1);d.useEffect(()=>{var r;if(o){const s={...n.testInputs,cardio:{...(r=n.testInputs)==null?void 0:r.cardio,distance:o}};p(a=>({...a,testInputs:s}))}},[o,p,n.testInputs]);const C=r=>{if(!r)return null;const s=parseInt(r);return s>=13&&s<=14?"13-14":s>=15&&s<=16?"15-16":s>=17&&s<=20?"17-20":s>=20&&s<=29?"20-29":s>=30&&s<=39?"30-39":s>=40&&s<=49?"40-49":s>=50?"50+":null},F=(r,s)=>{const a=s[60],c=s[100];return r<=0?0:r<=a?Math.round(r/a*60*100)/100:r>=c?100:Math.round((60+(r-a)/(c-a)*40)*100)/100},T=(r,s)=>{const a=s==="男性"||s.toLowerCase()==="male"?"male":"female",c=Math.floor(r/10)*10;return{male:{0:"兄弟，該動起來了！全力衝刺吧！",10:"還不夠熱血！再加把勁，衝上去！",20:"起步了！再加速，展現你的實力！",30:"進步中！再拼一點，突破極限吧！",40:"不錯！再猛一點，超越自己！",50:"很棒了！再衝刺，成為王者吧！",60:"強者氣勢！再加速，稱霸全場！",70:"超強！熱血沸騰，繼續衝刺！",80:"頂尖表現！再拼，成為傳說！",90:"無敵了！你是真正的王者，保持！",100:"無敵了！你是真正的王者，保持！"},female:{0:"親愛的，別氣餒，慢慢進步哦！",10:"再努力一點，你會更好的，加油！",20:"小進步了！繼續加油，你很棒！",30:"進步了呢！再努力一點，會更好哦！",40:"很棒了！再加把勁，你會更棒的！",50:"表現很好！再努力一點，超棒的！",60:"好厲害！繼續保持，你很棒哦！",70:"真的很棒！保持下去，你最棒了！",80:"太厲害了！繼續努力，你超棒的！",90:"完美表現！超棒的你，繼續保持！",100:"完美表現！超棒的你，繼續保持！"}}[a][c]||"加油！"},L=()=>{if(!o||!f||!l){alert(t("tests.cardioErrors.missingPrerequisites"));return}const r=parseFloat(o),s=C(f);if(!r||!s){alert(t("tests.cardioErrors.invalidInputs"));return}const h=((l==="男性"||l.toLowerCase()==="male"?"male":"female")==="male"?w:U)[s];if(!h){alert(t("tests.cardioErrors.standardsNotFound"));return}const I=F(r,h);E(I),console.log("Cardio.js - 計算心肺耐力分數:",I,"距離:",r,"年齡段:",s)},M=async()=>{if(!i){alert(t("tests.cardioErrors.needCalculate"));return}const r=sessionStorage.getItem("guestMode")==="true";try{if(x)return;g(!0);const s={...n.scores,cardio:parseFloat(i)},a={...n,scores:s};p({...a,ladderScore:n.ladderScore||0});const c={distance:parseFloat(o),score:parseFloat(i)};u&&typeof u=="function"&&u(c),j("/user-info",{state:{from:"/cardio"}})}catch(s){console.error("提交失敗:",s),r||alert(t("tests.cardioErrors.updateUserFail")),j("/user-info",{state:{from:"/cardio"}})}finally{g(!1)}};return e.jsxs("div",{className:"cardio-container",children:[e.jsxs("div",{className:"input-section",children:[e.jsx("h1",{className:"text-2xl font-bold text-center mb-4",children:t("tests.cardioTitle")}),e.jsxs("p",{children:[t("common.ageLabel"),"：",f||t("common.notEntered")]}),e.jsxs("p",{children:[t("common.genderLabel"),"：",l||t("common.notSelected")]}),e.jsxs("div",{className:"exercise-section",children:[e.jsx("h2",{className:"text-lg font-semibold",children:t("tests.cardioInfo.cooperTitle")}),e.jsx("label",{htmlFor:"distance",className:"block text-sm font-medium text-gray-700",children:t("tests.cardioLabels.distanceMeters")}),e.jsx("input",{id:"distance",name:"distance",type:"number",placeholder:t("tests.cardioLabels.distanceMeters"),value:o,onChange:r=>y(r.target.value),className:"input-field",required:!0}),e.jsx("button",{onClick:L,className:"calculate-btn",children:t("common.calculate")}),i!==null&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"score-display",children:[t("tests.cardioLabels.score"),": ",i]}),e.jsx("p",{className:"score-display",children:T(i,l)})]})]}),e.jsx("div",{className:"description-section",children:e.jsxs("div",{className:"description-card",children:[e.jsxs("div",{className:"description-header",onClick:()=>v(!m),children:[e.jsx("h2",{className:"text-lg font-semibold",children:t("tests.cardioInfo.sectionTitle")}),e.jsx("span",{className:`arrow ${m?"expanded":""}`,children:m?"▲":"▼"})]}),m&&e.jsxs("div",{className:"description-content",children:[e.jsx("p",{className:"font-semibold",children:t("tests.cardioInfo.introTitle")}),e.jsx("p",{children:t("tests.cardioInfo.introText")}),e.jsx("p",{className:"font-semibold mt-2",children:t("tests.cardioInfo.measureLabel")}),e.jsxs("ul",{className:"list-disc pl-5",children:[e.jsx("li",{children:t("tests.cardioInfo.items.place")}),e.jsx("li",{children:t("tests.cardioInfo.items.record")}),e.jsx("li",{children:t("tests.cardioInfo.items.warmup")})]}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:t("tests.cardioInfo.sourceNote")})]})]})})]}),e.jsx("div",{className:"button-group",children:e.jsx("button",{type:"button",onClick:M,className:"submit-btn",disabled:x,children:t(x?"common.submitting":"common.submitAndReturn")})})]})}P.propTypes={onComplete:S.func,clearTestData:S.func};export{P as default};

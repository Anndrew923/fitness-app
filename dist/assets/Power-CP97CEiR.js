import{u as _,a as ee,j as e}from"./index-Cpfbo24J.js";import{d as se,r as l}from"./react-vendor-BToktFYo.js";import{w as te,x as ne,y as re,z as ae,A as le,B as oe}from"./standards-Dj82V2Ks.js";import{P as O}from"./charts-BNGpwEcn.js";import"./firebase-D0136ThQ.js";function ie({onComplete:m}){var y,F,E,T,C,k;const{userData:a,setUserData:x}=_(),J=se(),{age:g,gender:p}=a,{t}=ee(),[o,V]=l.useState(((F=(y=a.testInputs)==null?void 0:y.power)==null?void 0:F.verticalJump)||""),[i,$]=l.useState(((T=(E=a.testInputs)==null?void 0:E.power)==null?void 0:T.standingLongJump)||""),[c,q]=l.useState(((k=(C=a.testInputs)==null?void 0:C.power)==null?void 0:k.sprint)||""),[r,z]=l.useState({verticalJumpScore:null,standingLongJumpScore:null,sprintScore:null,finalScore:null}),[u,B]=l.useState(!1),[d,G]=l.useState(!1),[f,v]=l.useState(!1);l.useEffect(()=>{const n={...a.testInputs,power:{verticalJump:o,standingLongJump:i,sprint:c}};x(s=>({...s,testInputs:n}))},[o,i,c,x,a.testInputs]);const H=n=>{if(!n)return null;const s=parseInt(n);return s>=12&&s<=15?"12-15":s>=16&&s<=20?"16-20":s>=21&&s<=30?"21-30":s>=31&&s<=40?"31-40":s>=41&&s<=50?"41-50":s>=51&&s<=60?"51-60":s>=61&&s<=70?"61-70":s>=71&&s<=80?"71-80":null},I=(n,s)=>n<s[0]?0:n>=s[100]?100:n<s[50]?(n-s[0])/(s[50]-s[0])*50:50+(n-s[50])/(s[100]-s[50])*50,K=(n,s)=>n>s[0]?0:n<=s[100]?100:n>s[50]?(s[0]-n)/(s[0]-s[50])*50:50+(s[50]-n)/(s[50]-s[100])*50,Q=()=>{if(!g||!p){alert(t("tests.powerErrors.missingPrerequisites"));return}if(!o&&!i&&!c){alert(t("tests.powerErrors.noAnyInput"));return}const n=H(g);if(!n){alert(t("tests.powerErrors.invalidAge"));return}const s=p==="男性"||p.toLowerCase()==="male"?"male":"female",h=s==="male"?te:ne,b=s==="male"?re:ae,X=s==="male"?le:oe,D=h[n],P=b[n],A=X[n];if(!D||!P||!A){alert(t("tests.powerErrors.standardsNotFound"));return}const M=o?parseFloat(o):null,R=i?parseFloat(i):null,U=c?parseFloat(c):null,S=M!==null?I(M,D):null,w=R!==null?I(R,P):null,j=U!==null?K(U,A):null,L=[S,w,j].filter(N=>N!==null);if(L.length===0){alert(t("tests.powerErrors.needMeasure"));return}const Y=(L.reduce((N,Z)=>N+Z,0)/L.length).toFixed(2);z({verticalJumpScore:S!==null?S.toFixed(2):null,standingLongJumpScore:w!==null?w.toFixed(2):null,sprintScore:j!==null?j.toFixed(2):null,finalScore:Y})},W=async()=>{if(!r.finalScore){alert(t("tests.powerErrors.needCalculate"));return}const n=sessionStorage.getItem("guestMode")==="true";try{if(f)return;v(!0);const s={...a.scores,explosivePower:parseFloat(r.finalScore)},h={...a,scores:s};x({...h,ladderScore:a.ladderScore||0});const b={verticalJump:o||null,standingLongJump:i||null,sprint:c||null,finalScore:r.finalScore};m&&typeof m=="function"&&m(b),J("/user-info",{state:{from:"/explosive-power"}})}catch(s){console.error("Power.js - 更新 UserContext 或導航失敗:",s),n||alert(t("tests.powerErrors.updateUserFail")),J("/user-info",{state:{from:"/explosive-power"}})}finally{v(!1)}};return e.jsxs("div",{className:"power-container",children:[e.jsxs("div",{className:"input-section",children:[e.jsx("h1",{className:"text-2xl font-bold text-center mb-4",children:t("tests.powerTitle")}),e.jsxs("p",{children:[t("common.ageLabel"),"：",g||t("common.notEntered")]}),e.jsxs("p",{children:[t("common.genderLabel"),"：",p||t("common.notSelected")]}),e.jsxs("div",{className:"exercise-section",children:[e.jsx("h2",{className:"text-lg font-semibold",children:t("tests.powerLabels.movementsTitle")}),e.jsx("label",{htmlFor:"verticalJump",className:"block text-sm font-medium text-gray-700",children:t("tests.powerLabels.verticalJump")}),e.jsx("input",{id:"verticalJump",name:"verticalJump",type:"number",placeholder:t("tests.powerLabels.verticalJump"),value:o,onChange:n=>V(n.target.value),className:"input-field"}),e.jsx("label",{htmlFor:"standingLongJump",className:"block text-sm font-medium text-gray-700",children:t("tests.powerLabels.standingLongJump")}),e.jsx("input",{id:"standingLongJump",name:"standingLongJump",type:"number",placeholder:t("tests.powerLabels.standingLongJump"),value:i,onChange:n=>$(n.target.value),className:"input-field"}),e.jsx("label",{htmlFor:"sprint",className:"block text-sm font-medium text-gray-700",children:t("tests.powerLabels.sprint")}),e.jsx("input",{id:"sprint",name:"sprint",type:"number",placeholder:t("tests.powerLabels.sprint"),value:c,onChange:n=>q(n.target.value),className:"input-field"}),e.jsx("button",{onClick:Q,className:"calculate-btn",children:t("common.calculate")}),r.finalScore&&e.jsxs(e.Fragment,{children:[r.verticalJumpScore&&e.jsxs("p",{className:"score-display",children:[t("tests.powerLabels.scoreLabels.verticalJump"),":"," ",r.verticalJumpScore]}),r.standingLongJumpScore&&e.jsxs("p",{className:"score-display",children:[t("tests.powerLabels.scoreLabels.standingLongJump"),":"," ",r.standingLongJumpScore]}),r.sprintScore&&e.jsxs("p",{className:"score-display",children:[t("tests.powerLabels.scoreLabels.sprint"),":"," ",r.sprintScore]}),e.jsxs("p",{className:"score-display",children:[t("tests.powerLabels.scoreLabels.final"),": ",r.finalScore]})]})]}),e.jsxs("div",{className:"description-section",children:[e.jsxs("div",{className:"description-card",children:[e.jsxs("div",{className:"description-header",onClick:()=>B(!u),children:[e.jsx("h2",{className:"text-lg font-semibold",children:t("tests.powerLabels.descriptionTitle")}),e.jsx("span",{className:`arrow ${u?"expanded":""}`,children:u?"▲":"▼"})]}),u&&e.jsxs("div",{className:"description-content",children:[e.jsx("p",{className:"exercise-title",children:t("tests.powerLabels.verticalJump")}),e.jsx("p",{className:"exercise-description",children:t("tests.powerInfo.howTo.verticalJump")}),e.jsx("p",{className:"exercise-title mt-2",children:t("tests.powerLabels.standingLongJump")}),e.jsx("p",{className:"exercise-description",children:t("tests.powerInfo.howTo.standingLongJump")}),e.jsx("p",{className:"exercise-title mt-2",children:t("tests.powerLabels.sprint")}),e.jsx("p",{className:"exercise-description",children:t("tests.powerInfo.howTo.sprint")}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:t("tests.powerInfo.howTo.tip")})]})]}),e.jsxs("div",{className:"standards-card",children:[e.jsxs("div",{className:"standards-header",onClick:()=>G(!d),children:[e.jsx("h2",{className:"text-lg font-semibold",children:t("tests.powerLabels.standardsTitle")}),e.jsx("span",{className:`arrow ${d?"expanded":""}`,children:d?"▲":"▼"})]}),d&&e.jsxs("div",{className:"standards-content",children:[e.jsx("p",{className:"font-semibold",children:t("tests.powerLabels.sourceLabel")}),e.jsx("p",{children:t("tests.powerInfo.standards.source")}),e.jsx("p",{className:"font-semibold mt-2",children:t("tests.powerLabels.basisLabel")}),e.jsxs("ul",{className:"list-disc pl-5",children:[e.jsx("li",{children:t("tests.powerInfo.standards.basedOn.vjump")}),e.jsx("li",{children:t("tests.powerInfo.standards.basedOn.slj")}),e.jsx("li",{children:t("tests.powerInfo.standards.basedOn.sprint")})]}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:t("tests.powerInfo.standards.remark")})]})]})]})]}),e.jsx("div",{className:"button-group",children:e.jsx("button",{type:"button",onClick:W,className:"submit-btn",disabled:f,children:t(f?"common.submitting":"common.submitAndReturn")})})]})}ie.propTypes={onComplete:O.func,clearTestData:O.func};export{ie as default};

import{u as Ce,a as Z,c as ue,d as X,b as k,g as we,j as e,r as ke,s as Oe,e as Te,f as Re}from"./index-Do2PLJaq.js";import{r as l,d as Me,u as Le}from"./react-vendor-BToktFYo.js";import{l as me,s as Fe,q as qe,t as Ue,w as Ae,v as Ee,x as Pe,y as ze,z as Ve}from"./firebase-D0136ThQ.js";import{P as d,R as Be,a as Ge,b as We,c as Je,d as He,e as Ye}from"./charts-BNGpwEcn.js";const q={strength:0,explosivePower:0,cardio:0,muscleMass:0,bodyFat:0},_e=["male","female"],fe=({isOpen:u,onClose:S,title:v,message:s,type:c="info",onAction:j=null,actionText:g=null})=>{if(!u)return null;const{t:N}=Z(),t=()=>{switch(c){case"warning":return"⚠️";case"success":return"✅";case"error":return"❌";default:return"ℹ️"}},x=()=>{switch(c){case"warning":return"modal-btn modal-btn-warning";case"success":return"modal-btn modal-btn-success";case"error":return"modal-btn modal-btn-error";default:return"modal-btn modal-btn-info"}},p=()=>{console.log("Modal close button clicked"),S()},y=()=>{console.log("Modal overlay clicked"),S()},I=()=>{j&&j(),S()};return e.jsx("div",{className:"modal-overlay",onClick:y,children:e.jsxs("div",{className:"modal-content",onClick:C=>C.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("span",{className:"modal-icon",children:t()}),e.jsx("h3",{className:"modal-title",children:v})]}),e.jsx("div",{className:"modal-body",children:e.jsx("p",{className:"modal-message",children:s})}),e.jsx("div",{className:"modal-footer",children:j&&g?e.jsxs("div",{className:"modal-footer-actions",children:[e.jsx("button",{className:"modal-btn modal-btn-secondary",onClick:p,children:N("common.cancel")}),e.jsx("button",{className:x(),onClick:I,style:{position:"relative",zIndex:10001},children:g||N("common.confirm")})]}):e.jsx("button",{className:x(),onClick:p,style:{position:"relative",zIndex:10001},children:N("common.confirm")})})]})})};fe.propTypes={isOpen:d.bool.isRequired,onClose:d.func.isRequired,title:d.string.isRequired,message:d.string.isRequired,type:d.oneOf(["info","warning","success","error"]),onAction:d.func,actionText:d.string};const Q=({isOpen:u,onConfirm:S,onCancel:v,remainingCount:s})=>{if(!u)return null;const{t:c}=Z(),j=g=>{g.target===g.currentTarget&&v()};return e.jsx("div",{className:"modal-overlay submit-confirm-overlay",onClick:j,children:e.jsxs("div",{className:"modal-content submit-confirm-content",onClick:g=>g.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("span",{className:"modal-icon",children:"🏆"}),e.jsx("h3",{className:"modal-title",children:c("userInfo.submitConfirm.title")})]}),e.jsx("div",{className:"modal-body",children:e.jsxs("div",{className:"submit-confirm-message",children:[e.jsxs("p",{className:"confirm-text",children:[c("userInfo.submitConfirm.descPrefix")," ",e.jsx("span",{className:"remaining-count",children:s})," ",c("userInfo.submitConfirm.descSuffix")]}),e.jsxs("div",{className:"confirm-details",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-icon",children:"📊"}),e.jsx("span",{className:"detail-text",children:c("userInfo.submitConfirm.ensureAccuracy")})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-icon",children:"⏰"}),e.jsx("span",{className:"detail-text",children:c("userInfo.submitConfirm.resetDaily")})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-icon",children:"🎯"}),e.jsx("span",{className:"detail-text",children:c("userInfo.submitConfirm.improveValue")})]})]})]})}),e.jsxs("div",{className:"modal-footer submit-confirm-footer",children:[e.jsx("button",{className:"modal-btn modal-btn-secondary",onClick:v,children:c("userInfo.submitConfirm.cancel")}),e.jsx("button",{className:"modal-btn modal-btn-success",onClick:S,children:c("userInfo.submitConfirm.confirm")})]})]})})};Q.propTypes={isOpen:d.bool.isRequired,onConfirm:d.func.isRequired,onCancel:d.func.isRequired,remainingCount:d.number.isRequired};async function Ke(u,S=300*1024,v=192,s=192){return new Promise((c,j)=>{const g=new window.Image,N=new FileReader;N.onload=t=>{g.src=t.target.result},g.onload=()=>{const t=document.createElement("canvas");let x=g.width,p=g.height;(x>v||p>s)&&(x>p?(p=Math.round(p*v/x),x=v):(x=Math.round(x*s/p),p=s)),t.width=x,t.height=p,t.getContext("2d").drawImage(g,0,0,x,p),t.toBlob(I=>{I.size>S?t.toBlob(C=>{c(C)},"image/jpeg",.7):c(I)},"image/jpeg",.85)},g.onerror=j,N.onerror=j,N.readAsDataURL(u)})}function $e({testData:u,onLogout:S,clearTestData:v}){const{userData:s,setUserData:c,saveHistory:j,loadUserData:g,isLoading:N}=Ce(),{t}=Z(),[x,p]=l.useState(null),[y,I]=l.useState(!1),[C,he]=l.useState(null),[J,ge]=l.useState(!1),O=Me(),H=Le(),U=l.useRef(null),Y=l.useRef(null),B=l.useRef(null),[ee,_]=l.useState(!1),[se,F]=l.useState(null),ae=l.useRef(null),[T,m]=l.useState({isOpen:!1,title:"",message:"",type:"info",onAction:null,actionText:null}),[pe,A]=l.useState(null),[E,K]=l.useState({lastSubmissionTime:null,dailySubmissionCount:0,lastSubmissionDate:null}),[P,$]=l.useState({isOpen:!1,remainingCount:3}),[ne,te]=l.useState({show:!1,message:""}),re=l.useCallback(()=>{const n=3-(E.dailySubmissionCount||0);$({isOpen:!0,remainingCount:Math.max(0,n)})},[E]),oe=l.useCallback(async()=>{if($({isOpen:!1,remainingCount:0}),!y)try{I(!0);const n=s.scores||{},a=ue(n),r={...s,ladderScore:a,lastLadderSubmission:new Date().toISOString()};c(r);try{const i={...s,ladderScore:a,lastLadderSubmission:new Date().toISOString(),updatedAt:new Date().toISOString()};localStorage.setItem("userData",JSON.stringify(i)),localStorage.setItem("lastSavedUserData",JSON.stringify(i));const f=me(X,"users",k.currentUser.uid);await Fe(f,{ladderScore:a,lastLadderSubmission:new Date().toISOString(),updatedAt:new Date().toISOString()},{merge:!0}),console.log("天梯分數已立即保存到 Firebase:",a)}catch(i){throw console.error("保存天梯分數失敗:",i),i}const o=new Date;K(i=>({lastSubmissionTime:o,dailySubmissionCount:i.dailySubmissionCount+1,lastSubmissionDate:o.toDateString()})),m({isOpen:!0,title:t("userInfo.modal.submitSuccessTitle"),message:t("userInfo.modal.submitSuccessMessage",{score:a}),type:"success",onAction:()=>{m(i=>({...i,isOpen:!1})),O("/ladder",{state:{forceReload:!0,from:"/user-info",timestamp:Date.now()}})},actionText:t("userInfo.modal.viewLadder")}),setTimeout(()=>{m(i=>({...i,isOpen:!1}))},5e3)}catch(n){console.error("提交到天梯失敗:",n),m({isOpen:!0,title:t("userInfo.modal.submitFailTitle"),message:t("userInfo.modal.submitFailMessage"),type:"error"})}finally{I(!1)}},[s.scores,c,y,O]),ie=l.useCallback(()=>{$({isOpen:!1,remainingCount:0})},[]),xe=l.useCallback(async()=>{if(!k.currentUser){m({isOpen:!0,title:"需要登入",message:"請先登入以提交到天梯",type:"warning"});return}const n=s.scores||{},a=Object.values(n).filter(r=>r>0).length;if(a<5){m({isOpen:!0,title:"評測未完成",message:`請先完成全部5項評測（目前完成 ${a}/5 項）`,type:"warning"});return}re()},[s,re,m]),le=l.useMemo(()=>{const n=s.scores||q;return[{name:t("userInfo.radarLabels.strength"),value:n.strength?Number(n.strength).toFixed(2)*1:0,icon:"💪"},{name:t("userInfo.radarLabels.explosivePower"),value:n.explosivePower?Number(n.explosivePower).toFixed(2)*1:0,icon:"⚡"},{name:t("userInfo.radarLabels.cardio"),value:n.cardio?Number(n.cardio).toFixed(2)*1:0,icon:"❤️"},{name:t("userInfo.radarLabels.muscle"),value:n.muscleMass?Number(n.muscleMass).toFixed(2)*1:0,icon:"🥩"},{name:t("userInfo.radarLabels.ffmi"),value:n.bodyFat?Number(n.bodyFat).toFixed(2)*1:0,icon:"📊"}]},[s.scores]),R=l.useMemo(()=>sessionStorage.getItem("guestMode")==="true",[]),ce=({payload:n,x:a,y:r})=>{const o=le.find(w=>w.name===n.value);let i=a,f=r;const h=Math.sqrt(a*a+r*r),b=Math.atan2(r,a);return n.value===t("userInfo.radarLabels.strength")?(i=a,f=r-h*.12):n.value===t("userInfo.radarLabels.explosivePower")?(i=a+Math.cos(b)*(h*.03),f=r+Math.sin(b)*(h*.06)):n.value===t("userInfo.radarLabels.ffmi")?(i=a+Math.cos(b)*(h*-.2),f=r+Math.sin(b)*(h*.06)):n.value===t("userInfo.radarLabels.cardio")?(i=a+Math.cos(b)*(h*.01),f=r+Math.sin(b)*(h*.06)):n.value===t("userInfo.radarLabels.muscle")?(i=a+Math.cos(b)*(h*-.05),f=r+Math.sin(b)*(h*.06)):(i=a+Math.cos(b)*(h*.1),f=r+Math.sin(b)*(h*.1)),e.jsxs("g",{transform:`translate(${i},${f})`,children:[e.jsx("defs",{children:e.jsxs("filter",{id:"glow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[e.jsx("feGaussianBlur",{stdDeviation:"3",result:"coloredBlur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"coloredBlur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),e.jsx("circle",{cx:0,cy:0,r:16,fill:"rgba(129, 216, 208, 0.1)",filter:"url(#glow)"}),e.jsx("circle",{cx:0,cy:0,r:14,fill:"rgba(255, 255, 255, 0.95)",stroke:"rgba(129, 216, 208, 0.4)",strokeWidth:2,filter:"drop-shadow(0 2px 4px rgba(129, 216, 208, 0.2))"}),e.jsx("text",{x:0,y:-8,textAnchor:"middle",fill:"#4a5568",fontSize:"16",fontWeight:"600",dominantBaseline:"middle",filter:"drop-shadow(0 1px 2px rgba(0, 0, 0, 0.1))",children:o==null?void 0:o.icon}),e.jsx("text",{x:0,y:12,textAnchor:"middle",fill:"#2d3748",fontSize:"13",fontWeight:"700",dominantBaseline:"middle",filter:"drop-shadow(0 1px 3px rgba(255, 255, 255, 0.9))",children:n.value})]})};ce.propTypes={payload:d.shape({value:d.string.isRequired}).isRequired,x:d.number.isRequired,y:d.number.isRequired},l.useEffect(()=>{if(!k){p("無法初始化身份驗證，請檢查 Firebase 配置並稍後再試。"),console.error("auth 未初始化");return}const n=k.onAuthStateChanged(a=>{console.log("UserInfo - 認證狀態變更:",a==null?void 0:a.email),he(a),!a&&!R&&O("/login")});return()=>n()},[]),l.useEffect(()=>{(async()=>{C&&!J&&!N&&(console.log("UserInfo - 檢查資料載入狀態"),!s.height&&!s.weight&&!s.age&&(console.log("UserInfo - 資料為空，嘗試重新載入"),await g(C,!0)),ge(!0))})()},[C,J,N,g,s.height,s.weight,s.age]),l.useEffect(()=>{var o,i;const n=["/strength","/explosive-power","/cardio","/muscle-mass","/body-fat"],a=(o=H.state)==null?void 0:o.from;a&&n.includes(a)&&setTimeout(()=>{U.current&&U.current.scrollIntoView({behavior:"smooth",block:"center"})},300);const r=(i=H.state)==null?void 0:i.scrollTo;r&&setTimeout(()=>{r==="radar"&&U.current?U.current.scrollIntoView({behavior:"smooth",block:"center"}):r==="tests"&&Y.current&&Y.current.scrollIntoView({behavior:"smooth",block:"start"})},300)},[H]),l.useEffect(()=>{(()=>{try{const a=localStorage.getItem("ladderSubmissionState");if(a){const r=JSON.parse(a),o=new Date().toDateString();r.lastSubmissionDate!==o?K({lastSubmissionTime:null,dailySubmissionCount:0,lastSubmissionDate:o}):K(r)}}catch(a){console.error("載入提交狀態失敗:",a)}})()},[]),l.useEffect(()=>{E.lastSubmissionDate&&localStorage.setItem("ladderSubmissionState",JSON.stringify(E))},[E]),l.useEffect(()=>{if(u&&Object.keys(u).length>0){console.log("收到測試數據:",u);const n=JSON.stringify(u);if(ae.current===n)return;ae.current=n;const a=setTimeout(()=>{c(r=>{const i={...r.scores||q,...u.distance!==void 0&&{cardio:u.score||0},...u.squat!==void 0&&{strength:u.averageScore||0},...(u.finalScore!==void 0||u.verticalJump!==void 0||u.standingLongJump!==void 0||u.sprint!==void 0)&&{explosivePower:u.finalScore||0},...u.smm!==void 0&&{muscleMass:u.finalScore||0},...u.bodyFat!==void 0&&{bodyFat:u.ffmiScore||0}};return console.log("💾 防抖後更新測試數據分數（5秒防抖）"),{...r,scores:i,ladderScore:r.ladderScore||0}})},5e3);return v&&setTimeout(v,6e3),()=>clearTimeout(a)}},[u,v]);const G=l.useCallback(()=>{const{height:n,weight:a,age:r,gender:o}=s;return!n||!a||!r||!o?(p(t("errors.required")),!1):n<=0||a<=0||r<=0?(p(t("userInfo.modal.invalidPositive")),!1):_e.includes(o)?!0:(p(t("userInfo.modal.invalidGender")),!1)},[s]),be=l.useCallback(async n=>{if(n.preventDefault(),p(null),I(!0),!G()){I(!1);return}const a={...s,height:Number(s.height)||0,weight:Number(s.weight)||0,age:Number(s.age)||0,gender:s.gender,scores:s.scores||q,ladderScore:s.ladderScore||0,lastActive:new Date().toISOString()};try{c(a),m({isOpen:!0,title:t("userInfo.modal.saveSuccessTitle"),message:t("userInfo.modal.saveSuccessMessage"),type:"success"})}catch(r){m(R?{isOpen:!0,title:"訪客模式",message:"訪客模式下無法保存到雲端，但您現在可以開始進行評測了！",type:"info"}:{isOpen:!0,title:"儲存失敗",message:`儲存失敗：${r.message}`,type:"error"})}finally{I(!1)}},[s,G,R,c]),z=l.useMemo(()=>{const n=(s==null?void 0:s.scores)||q,a=Object.values(n).filter(o=>o>0);return a.length?(a.reduce((o,i)=>o+Number(i),0)/a.length).toFixed(2):0},[s==null?void 0:s.scores]),D=l.useMemo(()=>{const n=(s==null?void 0:s.scores)||q;return ue(n)},[s==null?void 0:s.scores]),M=(s==null?void 0:s.ladderScore)||0,W=l.useMemo(()=>{const n=(s==null?void 0:s.scores)||q,a=Object.values(n).filter(o=>o>0).length;return{completedCount:a,isFullyCompleted:a===5,progress:a/5*100}},[s==null?void 0:s.scores]),de=l.useCallback(async()=>{if(!(s!=null&&s.userId)||!M||M<=0){A(null);return}try{const n=qe(X,"users"),a=Ue(n,Ae("ladderScore",">",0),Ee("ladderScore","desc"),Pe(100)),r=await ze(a),o=[];r.forEach(f=>{const h=f.data();h.ladderScore>0&&o.push({id:f.id,...h})});const i=o.findIndex(f=>f.id===s.userId);A(i!==-1?i+1:null)}catch(n){console.error("獲取用戶排名失敗:",n),A(null)}},[s==null?void 0:s.userId,M,A]);l.useEffect(()=>{de()},[de,c]);const ve=l.useCallback(n=>{const a=n.target.value,r=/[\u4e00-\u9fff]/.test(a);let o=!0,i="";if(r?a.length>8&&(o=!1,i="暱稱不能超過8個中文字"):a.length>16&&(o=!1,i="暱稱不能超過16個英文字元"),!o){m({isOpen:!0,title:"字數限制",message:i,type:"warning"});return}c(f=>({...f,nickname:a})),B.current&&clearTimeout(B.current),B.current=setTimeout(()=>{B.current=null},1e3)},[c,m]),je=l.useCallback(()=>{var r;const n=(r=k.currentUser)==null?void 0:r.email,a=we(n);c(o=>({...o,nickname:a,ladderScore:o.ladderScore||0}))},[c]),Ne=l.useCallback(()=>{if(!k.currentUser){m({isOpen:!0,title:"需要登入",message:"請先登入以儲存結果",type:"warning"});return}const n={date:new Date().toLocaleDateString("zh-TW"),scores:s.scores,averageScore:z};j(n),m({isOpen:!0,title:t("userInfo.modal.resultSaveSuccessTitle"),message:t("userInfo.modal.resultSaveSuccessMessage"),type:"success"}),setTimeout(()=>{m(a=>({...a,isOpen:!1}))},2e3)},[s.scores,z,j,m]),V=l.useCallback(async n=>{if(!s.height||!s.weight||!s.age||!s.gender){m({isOpen:!0,title:"需要基本資料",message:"請先填寫並儲存您的身高、體重、年齡和性別，才能開始評測！",type:"warning"});return}G()?O(n,{state:{from:"/user-info"}}):m({isOpen:!0,title:"資料未保存",message:"請確保資料已正確保存後再進行評測！",type:"warning"})},[s,G,O,m]),ye=l.useCallback(()=>{localStorage.removeItem("savedEmail"),localStorage.removeItem("savedPassword"),k.currentUser&&k.signOut().catch(n=>console.error("登出失敗:",n)),S(),O("/login")},[S,O]),L=l.useCallback(n=>{const{name:a,value:r}=n.target;let o=r;if(a==="gender"||["profession"].includes(a)?o=r:["weeklyTrainingHours","trainingYears"].includes(a)?o=r===""?"":Number(r):o=r===""?0:Number(r),a==="weight"){const i=s.weight||0,f=o;i>0&&f>0&&i!==f&&(te({show:!0,message:t("userInfo.weightChangeReminder")}),setTimeout(()=>{te(h=>({...h,show:!1}))},3e3))}c(i=>({...i,[a]:o,ladderScore:i.ladderScore||0}))},[c,s.weight,t]),Se=async n=>{var r;F(null);const a=n.target.files[0];if(a){if(!a.type.startsWith("image/")){F("請選擇圖片檔案");return}if(a.size>2*1024*1024){F("圖片大小請勿超過 2MB");return}_(!0);try{const o=await Ke(a,307200,192,192);if(o.size>350*1024){F("壓縮後圖片仍超過 350KB，請選擇更小的圖片"),_(!1);return}const i=(r=k.currentUser)==null?void 0:r.uid;if(!i)throw new Error("未登入，無法上傳頭像");console.log("🔧 開始上傳頭像:",{userId:i,fileSize:o.size});const f=ke(Oe,`avatars/${i}/avatar.jpg`),h={contentType:"image/jpeg",customMetadata:{"uploaded-by":i,"upload-time":new Date().toISOString()}};await Te(f,o,h),console.log("✅ 頭像上傳成功");const b=await Re(f);console.log("✅ 獲取下載 URL 成功:",b),c(w=>({...w,avatarUrl:b,ladderScore:w.ladderScore||0}));try{const w=me(X,"users",i);await Ve(w,{avatarUrl:b,updatedAt:new Date().toISOString()}),console.log("頭像已立即保存到 Firebase"),m({isOpen:!0,title:"頭像上傳成功",message:"您的頭像已成功更新！",type:"success"}),setTimeout(()=>{m(Ie=>({...Ie,isOpen:!1}))},2e3)}catch(w){console.error("頭像保存到 Firebase 失敗:",w),F("頭像保存失敗: "+w.message)}}catch(o){F("頭像上傳失敗: "+o.message)}finally{_(!1)}}};return N&&!J?e.jsx("div",{className:"user-info-container",children:e.jsx("div",{className:"loading-message",children:e.jsx("p",{children:t("common.loading")})})}):e.jsxs("div",{className:"user-info-container",children:[e.jsx(fe,{isOpen:T.isOpen,onClose:()=>{console.log("Modal onClose triggered, current state:",T),m(n=>(console.log("Setting modal state to closed"),{...n,isOpen:!1}))},title:T.title,message:T.message,type:T.type,onAction:T.onAction,actionText:T.actionText}),e.jsx(Q,{isOpen:P.isOpen,onConfirm:oe,onCancel:ie,remainingCount:P.remainingCount}),x&&e.jsx("p",{className:"error-message",children:x}),e.jsxs("div",{className:"avatar-section",children:[e.jsx("div",{className:"avatar-container",children:e.jsx("img",{src:R?"/guest-avatar.svg":(s==null?void 0:s.avatarUrl)||"/default-avatar.svg",alt:t("community.ui.avatarAlt"),className:"user-avatar",loading:"lazy",onError:n=>{n.target.src="/default-avatar.svg"}})}),e.jsxs("div",{className:"avatar-actions-container",children:[!R&&e.jsxs("label",{className:"avatar-upload-label",children:[t(ee?"userInfo.avatar.uploading":"userInfo.avatar.change"),e.jsx("input",{type:"file",accept:"image/*",style:{display:"none"},onChange:Se,disabled:ee})]}),R&&e.jsx("div",{className:"guest-avatar-note",children:e.jsx("span",{children:"訪客模式"})})]}),se&&e.jsx("div",{className:"avatar-error",children:se})]}),(C||R)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{className:"page-title",children:t("userInfo.title")}),e.jsx("div",{className:"page-subtitle",children:t("userInfo.subtitle")})]}),e.jsx("div",{className:"form-card",children:e.jsxs("form",{className:"user-form",onSubmit:be,children:[e.jsxs("div",{className:"form-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h3",{className:"section-title",children:t("userInfo.basicInfo")}),C&&e.jsx("button",{type:"button",onClick:ye,title:"登出",className:"user-info__logout-btn",onMouseEnter:n=>{const a=document.createElement("div");a.innerText="登出",a.style.position="absolute",a.style.bottom="44px",a.style.left="50%",a.style.transform="translateX(-50%)",a.style.background="rgba(60,60,60,0.95)",a.style.color="#fff",a.style.padding="6px 14px",a.style.borderRadius="6px",a.style.fontSize="13px",a.style.whiteSpace="nowrap",a.style.pointerEvents="none",a.style.zIndex="1001",a.className="logout-tooltip",n.currentTarget.parentNode.appendChild(a)},onMouseLeave:n=>{const a=n.currentTarget.parentNode.querySelector(".logout-tooltip");a&&a.remove()},children:e.jsx("span",{className:"user-info__logout-icon",children:"⎋"})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"nickname",className:"form-label",children:t("userInfo.nickname")}),e.jsxs("div",{className:"nickname-input-group",children:[e.jsx("input",{id:"nickname",name:"nickname",type:"text",value:(s==null?void 0:s.nickname)||"",onChange:ve,placeholder:t("userInfo.nicknamePlaceholder"),className:"form-input",maxLength:"16"}),e.jsx("button",{type:"button",onClick:je,className:"generate-nickname-btn",children:t("userInfo.generateNickname")})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"gender",className:"form-label",children:t("userInfo.gender")}),e.jsxs("select",{id:"gender",name:"gender",value:(s==null?void 0:s.gender)||"",onChange:L,className:"form-input",required:!0,onInvalid:n=>n.currentTarget.setCustomValidity(t("errors.required")),onInput:n=>n.currentTarget.setCustomValidity(""),children:[e.jsx("option",{value:"",children:t("userInfo.selectGender")}),e.jsx("option",{value:"male",children:t("userInfo.male")}),e.jsx("option",{value:"female",children:t("userInfo.female")})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"age",className:"form-label",children:t("userInfo.age")}),e.jsx("input",{id:"age",name:"age",type:"number",value:(s==null?void 0:s.age)||"",onChange:L,placeholder:t("userInfo.age"),className:"form-input",required:!0,onInvalid:n=>n.currentTarget.setCustomValidity(t("errors.required")),onInput:n=>n.currentTarget.setCustomValidity(""),min:"0",step:"1"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"height",className:"form-label",children:t("userInfo.height")}),e.jsx("input",{id:"height",name:"height",type:"number",value:(s==null?void 0:s.height)||"",onChange:L,placeholder:t("userInfo.height"),className:"form-input",required:!0,onInvalid:n=>n.currentTarget.setCustomValidity(t("errors.required")),onInput:n=>n.currentTarget.setCustomValidity(""),min:"0",step:"0.1"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"weight",className:"form-label",children:t("userInfo.weight")}),e.jsxs("div",{className:"input-with-reminder",children:[e.jsx("input",{id:"weight",name:"weight",type:"number",value:(s==null?void 0:s.weight)||"",onChange:L,placeholder:t("userInfo.weight"),className:"form-input",required:!0,onInvalid:n=>n.currentTarget.setCustomValidity(t("errors.required")),onInput:n=>n.currentTarget.setCustomValidity(""),min:"0",step:"0.1"}),ne.show&&e.jsxs("div",{className:"weight-reminder-bubble",children:[e.jsx("span",{className:"reminder-icon",children:"💡"}),e.jsx("span",{className:"reminder-text",children:ne.message})]})]})]})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsxs("h3",{className:"section-title",children:["🏆 ",t("userInfo.ladder.title")]}),e.jsx("div",{className:"privacy-options",children:e.jsxs("label",{className:"privacy-option",children:[e.jsx("input",{type:"checkbox",checked:s.isAnonymousInLadder===!0,onChange:n=>c(a=>({...a,isAnonymousInLadder:n.target.checked}))}),e.jsxs("div",{className:"privacy-option-content",children:[e.jsx("span",{className:"privacy-option-title",children:t("userInfo.ladder.anonymousTitle")}),e.jsx("span",{className:"privacy-option-desc",children:t("userInfo.ladder.anonymousDesc")})]})]})}),e.jsxs("div",{className:"training-info-section",children:[e.jsxs("h4",{className:"training-info-title",children:["💪 ",t("userInfo.training.title")]}),e.jsx("p",{className:"training-info-desc",children:t("userInfo.training.desc")}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"profession",className:"form-label",children:t("userInfo.training.profession")}),e.jsx("input",{id:"profession",name:"profession",type:"text",value:(s==null?void 0:s.profession)||"",onChange:L,placeholder:t("userInfo.placeholders.profession"),className:"form-input",maxLength:"100"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"weeklyTrainingHours",className:"form-label",children:t("userInfo.training.weeklyHours")}),e.jsx("input",{id:"weeklyTrainingHours",name:"weeklyTrainingHours",type:"number",value:(s==null?void 0:s.weeklyTrainingHours)||"",onChange:L,placeholder:t("userInfo.placeholders.hours"),className:"form-input",min:"0",max:"168",step:"0.5"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"trainingYears",className:"form-label",children:t("userInfo.training.years")}),e.jsx("input",{id:"trainingYears",name:"trainingYears",type:"number",value:(s==null?void 0:s.trainingYears)||"",onChange:L,placeholder:t("userInfo.placeholders.years"),className:"form-input",min:"0",max:"50",step:"0.5"})]})]})]}),e.jsx("div",{className:"form-actions",children:e.jsx("button",{type:"submit",className:"submit-btn",disabled:y,children:t(y?"userInfo.saving":"userInfo.saveData")})})]})})]}),e.jsx("div",{id:"radar-section",className:"radar-section",ref:U,children:e.jsxs("div",{className:"radar-card",children:[e.jsx("div",{className:"corner-decoration top-left"}),e.jsx("div",{className:"corner-decoration top-right"}),e.jsx("div",{className:"corner-decoration bottom-left"}),e.jsx("div",{className:"corner-decoration bottom-right"}),e.jsx("h2",{className:"radar-title",children:t("userInfo.radarOverview")}),y?e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"正在載入數據..."})]}):e.jsx("div",{className:"radar-chart-container",children:e.jsx(Be,{width:"100%",height:400,children:e.jsxs(Ge,{data:le,children:[e.jsx(We,{gridType:"polygon",stroke:"rgba(129, 216, 208, 0.25)",strokeWidth:2,strokeDasharray:"4 4"}),e.jsx(Je,{dataKey:"name",tick:e.jsx(ce,{}),axisLine:!1}),e.jsx(He,{angle:90,domain:[0,100],tickCount:5,tick:{fontSize:12,fill:"#2d3748",fontWeight:600},axisLine:!1}),e.jsx(Ye,{name:t("userInfo.yourPerformance"),dataKey:"value",stroke:"#81D8D0",fill:"url(#tiffanyGradient)",fillOpacity:.8,strokeWidth:4,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("defs",{children:e.jsxs("linearGradient",{id:"tiffanyGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#81D8D0",stopOpacity:.9}),e.jsx("stop",{offset:"50%",stopColor:"#5F9EA0",stopOpacity:.7}),e.jsx("stop",{offset:"100%",stopColor:"#81D8D0",stopOpacity:.6})]})})]})})}),!y&&e.jsxs("div",{className:"score-section",children:[z>0&&e.jsxs("div",{className:"average-score-display",children:[e.jsxs("p",{className:"average-score",children:["⭐ ",t("userInfo.powerTitle")," ",e.jsx("span",{className:"score-value-large",children:z})]}),W.isFullyCompleted&&e.jsxs("div",{className:"ladder-info",children:[e.jsxs("p",{className:"ladder-rank",children:["🏆 ",t("userInfo.ladder.rankLabel"),":"," ",e.jsx("span",{className:"rank-value",children:pe||"未上榜"})]}),M>0&&e.jsxs("p",{className:"submitted-score",children:[t("userInfo.ladder.submittedScore"),":"," ",e.jsx("span",{className:"score-value",children:M})]}),D>0&&D!==M&&e.jsxs("p",{className:"current-score",children:[t("userInfo.ladder.currentScore"),":"," ",e.jsx("span",{className:"score-value",children:D}),e.jsx("span",{className:"score-note",children:t("userInfo.ladder.needsSubmit")})]})]})]}),e.jsxs("div",{className:"action-buttons-section",children:[z>0&&e.jsxs("button",{onClick:Ne,className:"action-btn save-results-btn",disabled:y,children:[e.jsx("span",{className:"btn-icon",children:"💾"}),e.jsx("span",{className:"btn-text",children:t("userInfo.saveResults")})]}),W.isFullyCompleted&&e.jsxs("button",{onClick:xe,className:"action-btn submit-ladder-btn",disabled:y,children:[e.jsx("span",{className:"btn-icon",children:"🏆"}),e.jsx("span",{className:"btn-text",children:M>0?t("userInfo.updateLadderScore"):t("userInfo.submitToLadder")})]})]}),e.jsx("div",{className:"ladder-info-card",children:e.jsx("p",{className:"ladder-info-text",children:W.isFullyCompleted?t("userInfo.ladder.ctaCompleted"):t("userInfo.ladder.ctaNotCompleted",{count:W.completedCount})})})]})]})}),e.jsxs("div",{className:"test-buttons-section",ref:Y,children:[e.jsx("h3",{className:"section-title",children:t("userInfo.startTests")}),e.jsxs("div",{className:"test-buttons-grid",children:[e.jsxs("button",{onClick:()=>V("/strength"),className:"test-btn strength-btn",children:[e.jsx("span",{className:"test-icon",children:"💪"}),e.jsx("span",{className:"test-label",children:t("tests.strength")})]}),e.jsxs("button",{onClick:()=>V("/explosive-power"),className:"test-btn explosive-btn",children:[e.jsx("span",{className:"test-icon",children:"⚡"}),e.jsx("span",{className:"test-label",children:t("tests.explosivePower")})]}),e.jsxs("button",{onClick:()=>V("/cardio"),className:"test-btn cardio-btn",children:[e.jsx("span",{className:"test-icon",children:"❤️"}),e.jsx("span",{className:"test-label",children:t("tests.cardio")})]}),e.jsxs("button",{onClick:()=>V("/muscle-mass"),className:"test-btn muscle-btn",children:[e.jsx("span",{className:"test-icon",children:"🥩"}),e.jsx("span",{className:"test-label",children:t("tests.muscleMass")})]}),e.jsxs("button",{onClick:()=>V("/body-fat"),className:"test-btn bodyfat-btn",children:[e.jsx("span",{className:"test-icon",children:"📊"}),e.jsx("span",{className:"test-label",children:t("tests.bodyFat")})]})]})]}),P.isOpen&&e.jsx(Q,{isOpen:P.isOpen,onConfirm:oe,onCancel:ie,remainingCount:P.remainingCount})]})}$e.propTypes={testData:d.shape({distance:d.number,score:d.number,squat:d.number,averageScore:d.number,jumpHeight:d.number,finalScore:d.number,smm:d.number,bodyFat:d.number,ffmiScore:d.number}),onLogout:d.func.isRequired,clearTestData:d.func.isRequired};export{$e as default};

import{b as B,u as R,j as s}from"./index-BYqpe2Z4.js";import{d as $,r}from"./react-vendor-BToktFYo.js";import{P as N}from"./charts-BNGpwEcn.js";import"./firebase-D0136ThQ.js";function A({onComplete:p}){var I,T;const{userData:a,setUserData:h}=B(),g=$(),{t:e}=R(),[m,v]=r.useState(((T=(I=a.testInputs)==null?void 0:I.ffmi)==null?void 0:T.bodyFat)||""),[c,_]=r.useState(null),[d,S]=r.useState(null),[L,i]=r.useState(""),[b,E]=r.useState(!1),[u,w]=r.useState(!1),[x,j]=r.useState(!1);r.useEffect(()=>{var l;if(m){const f={...a.testInputs,ffmi:{...(l=a.testInputs)==null?void 0:l.ffmi,bodyFat:m}};h(o=>({...o,testInputs:f}))}},[m,h,a.testInputs]);const C=()=>{if(!a.gender||!a.height||!a.weight||!a.age){alert(e("tests.ffmiErrors.missingPrerequisites"));return}if(!m){alert(e("tests.ffmiErrors.missingBodyFat"));return}const l=a.gender==="male"||a.gender==="男性",f=parseFloat(a.height)/100,o=parseFloat(a.weight),F=parseFloat(m)/100,y=o*(1-F)/(f*f),t=f>1.8?y+6*(f-1.8):y;_(t.toFixed(2));let n;l?t<=0?n=0:t<=18.5?n=t/18.5*60:t<28?n=60+(t-18.5)/(28-18.5)*40:n=100:t<=0?n=0:t<=15.5?n=t/15.5*60:t<22?n=60+(t-15.5)/(22-15.5)*40:n=100,S(n.toFixed(2)),l?t<18?i(e("tests.ffmiInfo.maleTable.r16_17")):t<20?i(e("tests.ffmiInfo.maleTable.r18_19")):t<22?i(e("tests.ffmiInfo.maleTable.r20_21")):t<23?i(e("tests.ffmiInfo.maleTable.r22")):t<26?i(e("tests.ffmiInfo.maleTable.r23_25")):t<28?i(e("tests.ffmiInfo.maleTable.r26_27")):i(e("tests.ffmiInfo.maleTable.r28_30")):t<15?i(e("tests.ffmiInfo.femaleTable.r13_14")):t<17?i(e("tests.ffmiInfo.femaleTable.r15_16")):t<19?i(e("tests.ffmiInfo.femaleTable.r17_18")):t<22?i(e("tests.ffmiInfo.femaleTable.r19_21")):i(e("tests.ffmiInfo.femaleTable.r22plus"))},M=async()=>{if(!c||!d){alert(e("tests.ffmiErrors.needCalculate"));return}const l=sessionStorage.getItem("guestMode")==="true";try{if(x)return;j(!0);const f={...a.scores,bodyFat:parseFloat(d)},o={...a,scores:f};h({...o,ladderScore:a.ladderScore||0});const F={bodyFat:parseFloat(m),ffmi:parseFloat(c),ffmiScore:parseFloat(d)};p&&typeof p=="function"&&p(F),g("/user-info",{state:{from:"/body-fat"}})}catch(f){console.error("提交失敗:",f),l||alert(e("tests.ffmiErrors.updateUserFail")),g("/user-info",{state:{from:"/body-fat"}})}finally{j(!1)}},D=[{range:"16 - 17",description:e("tests.ffmiInfo.maleTable.r16_17")},{range:"18 - 19",description:e("tests.ffmiInfo.maleTable.r18_19")},{range:"20 - 21",description:e("tests.ffmiInfo.maleTable.r20_21")},{range:"22",description:e("tests.ffmiInfo.maleTable.r22")},{range:"23 - 25",description:e("tests.ffmiInfo.maleTable.r23_25")},{range:"26 - 27",description:e("tests.ffmiInfo.maleTable.r26_27")},{range:"28 - 30",description:e("tests.ffmiInfo.maleTable.r28_30")}],P=[{range:"13 - 14",description:e("tests.ffmiInfo.femaleTable.r13_14")},{range:"15 - 16",description:e("tests.ffmiInfo.femaleTable.r15_16")},{range:"17 - 18",description:e("tests.ffmiInfo.femaleTable.r17_18")},{range:"19 - 21",description:e("tests.ffmiInfo.femaleTable.r19_21")},{range:"> 22",description:e("tests.ffmiInfo.femaleTable.r22plus")}],k=a.gender==="male"||a.gender==="男性"?D:P;return s.jsxs("div",{className:"ffmi-container",children:[s.jsx("h1",{className:"ffmi-title",children:e("tests.ffmiTitle")}),s.jsxs("div",{className:"input-section",children:[s.jsx("label",{htmlFor:"bodyFat",className:"input-label",children:e("tests.ffmiLabels.bodyFatPercent")}),s.jsx("input",{id:"bodyFat",name:"bodyFat",type:"number",value:m,onChange:l=>v(l.target.value),placeholder:e("tests.ffmiLabels.bodyFatPercent"),className:"input-field",required:!0}),s.jsx("button",{onClick:C,className:"calculate-btn",children:e("common.calculate")})]}),c&&s.jsxs("div",{className:"result-section",children:[s.jsx("h2",{className:"result-title",children:e("tests.ffmiLabels.resultTitle")}),s.jsxs("p",{className:"result-text",children:[e("tests.ffmiLabels.ffmi"),"：",c]}),s.jsxs("p",{className:"score-text",children:[e("tests.ffmiLabels.ffmiScore"),"：",d," ",e("common.points")]}),s.jsxs("p",{className:"category-text",children:[e("tests.ffmiLabels.ffmiCategory"),"：",L]}),s.jsx("p",{className:"result-text note-text"})]}),s.jsx("div",{className:"description-section",children:s.jsxs("div",{className:"description-card",children:[s.jsxs("div",{className:"description-header",onClick:()=>E(!b),children:[s.jsx("h2",{className:"description-title",children:e("tests.ffmiLabels.whatIs")}),s.jsx("span",{className:`arrow ${b?"expanded":""}`,children:b?"▲":"▼"})]}),b&&s.jsxs("div",{className:"description-content",children:[s.jsx("p",{children:e("tests.ffmiInfo.whatIs")}),s.jsxs("ol",{className:"list-decimal pl-5 mt-2",children:[s.jsx("li",{children:e("tests.ffmiInfo.caveats.tall")}),s.jsx("li",{children:e("tests.ffmiInfo.caveats.highFat")}),s.jsx("li",{children:e("tests.ffmiInfo.caveats.heavy")})]})]})]})}),s.jsx("div",{className:"table-section",children:s.jsxs("div",{className:"table-card",children:[s.jsxs("div",{className:"table-header",onClick:()=>w(!u),children:[s.jsxs("h2",{className:"table-title",children:[e("tests.ffmiLabels.tableTitle")," (",a.gender==="male"||a.gender==="男性"?e("tests.ffmiLabels.male"):e("tests.ffmiLabels.female"),")"]}),s.jsx("span",{className:`arrow ${u?"expanded":""}`,children:u?"▲":"▼"})]}),u&&s.jsx("div",{className:"table-content",children:s.jsxs("table",{className:"ffmi-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:e("tests.ffmiLabels.columns.range")}),s.jsx("th",{children:e("tests.ffmiLabels.columns.evaluation")})]})}),s.jsx("tbody",{children:k.map((l,f)=>s.jsxs("tr",{children:[s.jsx("td",{children:l.range}),s.jsx("td",{children:l.description})]},f))})]})})]})}),s.jsx("button",{type:"button",onClick:M,className:"ffmi-submit-btn",disabled:x,children:e(x?"common.submitting":"common.submitAndReturn")})]})}A.propTypes={onComplete:N.func,clearTestData:N.func};export{A as default};

const m={SINGLE_POST_MAX:500,MESSAGE_BOARD_MAX:1e3,WARNING_THRESHOLD:.9,AUTO_CLEANUP_KEEP:50};function c(n,i="post"){const t=i==="post"?m.SINGLE_POST_MAX:m.MESSAGE_BOARD_MAX,e=n?n.length:0,s=Math.floor(t*m.WARNING_THRESHOLD);return{currentCount:e,maxLimit:t,isAtLimit:e>=t,isNearLimit:e>=s,remainingSlots:Math.max(0,t-e),warningThreshold:s}}function l(n,i="post"){if(!n||n.length===0)return{cleanedComments:[],removedCount:0};const t=i==="post"?m.SINGLE_POST_MAX:m.MESSAGE_BOARD_MAX;if(n.length<=t)return{cleanedComments:n,removedCount:0};const e=[...n].sort((a,u)=>new Date(u.timestamp)-new Date(a.timestamp)),s=Math.min(m.AUTO_CLEANUP_KEEP,t),o=e.slice(0,s),r=n.length-o.length;return console.log(`ğŸ§¹ è‡ªå‹•æ¸…ç†ç•™è¨€: åŸå§‹ ${n.length} æ¢ï¼Œä¿ç•™ ${o.length} æ¢ï¼Œåˆªé™¤ ${r} æ¢`),{cleanedComments:o,removedCount:r,removedComments:e.slice(s)}}function d(n,i="post"){const{currentCount:t,maxLimit:e,isAtLimit:s,isNearLimit:o,remainingSlots:r}=n;return s?`âš ï¸ ${i==="post"?"è²¼æ–‡":"ç•™è¨€æ¿"}ç•™è¨€æ•¸é‡å·²é”ä¸Šé™ (${t}/${e})ï¼Œç„¡æ³•å†æ·»åŠ æ–°ç•™è¨€`:o?`âš ï¸ ${i==="post"?"è²¼æ–‡":"ç•™è¨€æ¿"}ç•™è¨€æ•¸é‡æ¥è¿‘ä¸Šé™ (${t}/${e})ï¼Œåƒ…å‰© ${r} å€‹åé¡`:null}function C(n,i="post"){const t=c(n,i);return{canAdd:!t.isAtLimit,limitInfo:t,notification:d(t,i)}}function A(n,i,t="post"){const e=C(n,t);if(!e.canAdd)return{success:!1,error:"COMMENT_LIMIT_EXCEEDED",message:e.notification,limitInfo:e.limitInfo};const s=[...n||[],i],o=l(s,t);return{success:!0,comments:o.cleanedComments,wasAutoCleaned:o.removedCount>0,removedCount:o.removedCount,notification:o.removedCount>0?`ğŸ§¹ å·²è‡ªå‹•æ¸…ç† ${o.removedCount} æ¢èˆŠç•™è¨€ï¼Œä¿ç•™æœ€æ–° ${o.cleanedComments.length} æ¢`:null,limitInfo:c(o.cleanedComments,t)}}export{A as p};

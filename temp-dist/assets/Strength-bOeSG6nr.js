import{u as ms,a as ps,j as e}from"./index-5QNGLCrk.js";import{d as xs,r as u}from"./react-vendor-BToktFYo.js";import{a as bs,b as fs,c as Ss,d as ws,e as js,f as vs,g as ys,h as Ns,i as Ps,j as ks,k as Fs,l as Es,m as Is,n as Ts,o as Cs,p as Ms,q as qs,r as Ds,s as $s,t as Ls}from"./standards-Dj82V2Ks.js";import{R as As,a as Bs,b as Rs,c as Os,d as Ws,e as _s,P as Ye}from"./charts-BNGpwEcn.js";import"./firebase-D0136ThQ.js";function Ks({onComplete:C}){var z,J,H,Q,V,X,Y,Z,ee,se,te,ae,re,ne,le,ce,ie,de,oe,he,ge,ue,me,pe,xe,be,fe,Se,we,je,ve,ye,Ne,Pe,ke,Fe,Ee,Ie,Te,Ce,Me,qe,De,$e,Le,Ae,Be,Re,Oe,We,_e,Ke,Ge,Ue,ze,Je,He,Qe,Ve,Xe;const{userData:a,setUserData:F}=ms(),M=xs(),{gender:w,age:N}=a,{t:s}=ps(),[P,q]=u.useState("exercises"),[i,D]=u.useState({weight:((H=(J=(z=a.testInputs)==null?void 0:z.strength)==null?void 0:J.benchPress)==null?void 0:H.weight)||"",reps:((X=(V=(Q=a.testInputs)==null?void 0:Q.strength)==null?void 0:V.benchPress)==null?void 0:X.reps)||"",max:((ee=(Z=(Y=a.testInputs)==null?void 0:Y.strength)==null?void 0:Z.benchPress)==null?void 0:ee.max)||null,score:((ae=(te=(se=a.testInputs)==null?void 0:se.strength)==null?void 0:te.benchPress)==null?void 0:ae.score)||null}),[d,$]=u.useState({weight:((le=(ne=(re=a.testInputs)==null?void 0:re.strength)==null?void 0:ne.squat)==null?void 0:le.weight)||"",reps:((de=(ie=(ce=a.testInputs)==null?void 0:ce.strength)==null?void 0:ie.squat)==null?void 0:de.reps)||"",max:((ge=(he=(oe=a.testInputs)==null?void 0:oe.strength)==null?void 0:he.squat)==null?void 0:ge.max)||null,score:((pe=(me=(ue=a.testInputs)==null?void 0:ue.strength)==null?void 0:me.squat)==null?void 0:pe.score)||null}),[o,L]=u.useState({weight:((fe=(be=(xe=a.testInputs)==null?void 0:xe.strength)==null?void 0:be.deadlift)==null?void 0:fe.weight)||"",reps:((je=(we=(Se=a.testInputs)==null?void 0:Se.strength)==null?void 0:we.deadlift)==null?void 0:je.reps)||"",max:((Ne=(ye=(ve=a.testInputs)==null?void 0:ve.strength)==null?void 0:ye.deadlift)==null?void 0:Ne.max)||null,score:((Fe=(ke=(Pe=a.testInputs)==null?void 0:Pe.strength)==null?void 0:ke.deadlift)==null?void 0:Fe.score)||null}),[h,A]=u.useState({weight:((Te=(Ie=(Ee=a.testInputs)==null?void 0:Ee.strength)==null?void 0:Ie.latPulldown)==null?void 0:Te.weight)||"",reps:((qe=(Me=(Ce=a.testInputs)==null?void 0:Ce.strength)==null?void 0:Me.latPulldown)==null?void 0:qe.reps)||"",max:((Le=($e=(De=a.testInputs)==null?void 0:De.strength)==null?void 0:$e.latPulldown)==null?void 0:Le.max)||null,score:((Re=(Be=(Ae=a.testInputs)==null?void 0:Ae.strength)==null?void 0:Be.latPulldown)==null?void 0:Re.score)||null}),[g,B]=u.useState({weight:((_e=(We=(Oe=a.testInputs)==null?void 0:Oe.strength)==null?void 0:We.shoulderPress)==null?void 0:_e.weight)||"",reps:((Ue=(Ge=(Ke=a.testInputs)==null?void 0:Ke.strength)==null?void 0:Ge.shoulderPress)==null?void 0:Ue.reps)||"",max:((He=(Je=(ze=a.testInputs)==null?void 0:ze.strength)==null?void 0:Je.shoulderPress)==null?void 0:He.max)||null,score:((Xe=(Ve=(Qe=a.testInputs)==null?void 0:Qe.strength)==null?void 0:Ve.shoulderPress)==null?void 0:Xe.score)||null}),[E,R]=u.useState(!1),O=u.useRef(null),W=u.useCallback(()=>({...a.testInputs,strength:{benchPress:{weight:i.weight,reps:i.reps,max:i.max,score:i.score},squat:{weight:d.weight,reps:d.reps,max:d.max,score:d.score},deadlift:{weight:o.weight,reps:o.reps,max:o.max,score:o.score},latPulldown:{weight:h.weight,reps:h.reps,max:h.max,score:h.score},shoulderPress:{weight:g.weight,reps:g.reps,max:g.max,score:g.score}}}),[a.testInputs,i,d,o,h,g]),k=u.useCallback(()=>{var n;const t=W(),r=((n=a.testInputs)==null?void 0:n.strength)||{},l=t.strength||{};JSON.stringify(r)!==JSON.stringify(l)&&F({...a,testInputs:t})},[W,F,a]);u.useEffect(()=>(k(),()=>{O.current&&clearTimeout(O.current),k()}),[i,d,o,h,g,k]);const _=(t,r)=>{const{Beginner:l,Novice:c,Intermediate:n,Advanced:p,Elite:x}=r;return t<l?0:t>=x?100:t>=p?80+20*(t-p)/(x-p):t>=n?60+20*(t-n)/(p-n):t>=c?40+20*(t-c)/(n-c):t>=l?20+20*(t-l)/(c-l):0},K=u.useMemo(()=>{const t=w==="male"||w==="男性";return{benchPress:{bodyweight:t?$s:Ls,age:t?qs:Ds},squat:{bodyweight:t?Cs:Ms,age:t?Is:Ts},deadlift:{bodyweight:t?Fs:Es,age:t?Ps:ks},latPulldown:{bodyweight:t?ys:Ns,age:t?js:vs},shoulderPress:{bodyweight:t?Ss:ws,age:t?bs:fs}}},[w]),I=u.useCallback((t,r,l,c)=>{if(!t||!r)return alert(s("tests.strengthErrors.missingInputs"));const n=parseFloat(t),p=parseFloat(r),x=parseFloat(a.weight),S=parseFloat(N);if(!x||!S)return alert(s("tests.strengthErrors.missingUserData"));if(p>12){alert(s("tests.strengthErrors.repsTooHigh")),l(b=>({...b,reps:""}));return}const j=n/(1.0278-.0278*p),m=K[c],v=Object.keys(m.bodyweight).map(Number),ls=Object.keys(m.age).map(Number),cs=v.reduce((b,y)=>Math.abs(y-x)<Math.abs(b-x)?y:b),is=ls.reduce((b,y)=>Math.abs(y-S)<Math.abs(b-S)?y:b),ds=m.bodyweight[cs],os=m.age[is],hs=_(j,ds),gs=_(j,os),us=((hs+gs)/2).toFixed(2);l(b=>({...b,max:j.toFixed(2),score:us}))},[K,a.weight,N]);u.useEffect(()=>{w&&a.weight&&N&&[{key:"benchPress",state:i,setState:D},{key:"squat",state:d,setState:$},{key:"deadlift",state:o,setState:L},{key:"latPulldown",state:h,setState:A},{key:"shoulderPress",state:g,setState:B}].forEach(({key:r,state:l,setState:c})=>{l.weight&&l.reps&&!l.score&&I(l.weight,l.reps,c,r)})},[w,a.weight,N,i,d,o,h,g,I]);const Ze=(t,r)=>{const c=r==="男性"||r&&r.toLowerCase()==="male"?"tests.strengthComments.male":"tests.strengthComments.female";return t>=90?s(`${c}.gte90`):t>=80?s(`${c}.gte80`):t>=70?s(`${c}.gte70`):t>=60?s(`${c}.gte60`):t>=50?s(`${c}.gte50`):t>=40?s(`${c}.gte40`):s(`${c}.below40`)},es=u.useMemo(()=>[{name:s("tests.strengthExercises.benchPress"),value:parseFloat(i.score)||0},{name:s("tests.strengthExercises.squat"),value:parseFloat(d.score)||0},{name:s("tests.strengthExercises.deadlift"),value:parseFloat(o.score)||0},{name:s("tests.strengthExercises.latPulldown"),value:parseFloat(h.score)||0},{name:s("tests.strengthExercises.shoulderPress"),value:parseFloat(g.score)||0}],[i.score,d.score,o.score,h.score,g.score,s]),T=[i.score,d.score,o.score,h.score,g.score].filter(t=>t!==null),f=T.length>0?(T.reduce((t,r)=>t+parseFloat(r),0)/T.length).toFixed(2):null,ss=async()=>{if(k(),!f)return alert(s("tests.strengthErrors.needAtLeastOne"));if(!E){R(!0);try{const t={...a.scores,strength:parseFloat(f)};F(l=>({...l,scores:t,ladderScore:l.ladderScore||0}));const r={squat:d.max?{weight:d.weight,reps:d.reps,max:d.max,score:d.score}:null,benchPress:i.max?{weight:i.weight,reps:i.reps,max:i.max,score:i.score}:null,deadlift:o.max?{weight:o.weight,reps:o.reps,max:o.max,score:o.score}:null,latPulldown:h.max?{weight:h.weight,reps:h.reps,max:h.max,score:h.score}:null,shoulderPress:g.max?{weight:g.weight,reps:g.reps,max:g.max,score:g.score}:null,averageScore:parseFloat(f)};C&&C(r),M("/user-info",{state:{from:"/strength"}})}catch(t){console.error("提交失敗:",t),alert(s("tests.strengthErrors.updateFail")),M("/user-info",{state:{from:"/strength"}})}finally{R(!1)}}},ts=[{range:"90~100",description:s("tests.strengthStandards.guide.items.90_100")},{range:"80~90",description:s("tests.strengthStandards.guide.items.80_90")},{range:"70~80",description:s("tests.strengthStandards.guide.items.70_80")},{range:"60~70",description:s("tests.strengthStandards.guide.items.60_70")},{range:"50~60",description:s("tests.strengthStandards.guide.items.50_60")},{range:"40~50",description:s("tests.strengthStandards.guide.items.40_50")},{range:s("tests.strengthStandards.guide.rangeBelow40"),description:s("tests.strengthStandards.guide.items.below40")}],as=[{level:s("tests.strengthStandards.levels.beginner"),score:20,color:"#FF6B6B"},{level:s("tests.strengthStandards.levels.novice"),score:40,color:"#FFA726"},{level:s("tests.strengthStandards.levels.intermediate"),score:60,color:"#FFEE58"},{level:s("tests.strengthStandards.levels.advanced"),score:80,color:"#66BB6A"},{level:s("tests.strengthStandards.levels.elite"),score:100,color:"#42A5F5"}],G=[{key:"benchPress",name:s("tests.strengthExercises.benchPress"),state:i,setState:D},{key:"squat",name:s("tests.strengthExercises.squat"),state:d,setState:$},{key:"deadlift",name:s("tests.strengthExercises.deadlift"),state:o,setState:L},{key:"latPulldown",name:s("tests.strengthExercises.latPulldown"),state:h,setState:A},{key:"shoulderPress",name:s("tests.strengthExercises.shoulderPress"),state:g,setState:B}],[U,rs]=u.useState(new Set),ns=t=>{const{key:r,name:l,icon:c,state:n,setState:p}=t,x=n.score!==null,S=U.has(r),j=()=>{const m=new Set(U);S?m.delete(r):m.add(r),rs(m)};return e.jsxs("div",{className:`exercise-card ${x?"completed":""}`,children:[e.jsxs("div",{className:"exercise-header",onClick:j,children:[e.jsxs("div",{className:"exercise-header-left",children:[e.jsx("span",{className:"exercise-icon",children:c}),e.jsx("h3",{className:"exercise-name",children:l})]}),e.jsxs("div",{className:"exercise-header-right",children:[x&&e.jsx("span",{className:"score-badge",children:n.score}),e.jsx("span",{className:`expand-arrow ${S?"expanded":""}`,children:S?"▲":"▼"})]})]}),S&&e.jsxs("div",{className:"exercise-content",children:[e.jsxs("div",{className:"exercise-inputs",children:[e.jsxs("div",{className:"input-group",children:[e.jsx("label",{htmlFor:`${r}Weight`,children:s("tests.strengthLabels.weightKg")}),e.jsx("input",{id:`${r}Weight`,type:"number",placeholder:s("tests.strengthLabels.weightKg"),value:n.weight,onChange:m=>p(v=>({...v,weight:m.target.value})),className:"input-field"})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{htmlFor:`${r}Reps`,children:s("tests.strengthLabels.reps")}),e.jsx("input",{id:`${r}Reps`,type:"number",placeholder:s("tests.strengthLabels.reps"),value:n.reps,onChange:m=>p(v=>({...v,reps:m.target.value})),className:"input-field"})]}),e.jsx("button",{onClick:()=>I(n.weight,n.reps,p,r),className:"calculate-btn",disabled:!n.weight||!n.reps,children:s("common.calculate")})]}),n.max&&e.jsxs("div",{className:"exercise-result",children:[e.jsxs("p",{className:"max-strength",children:[s("tests.strengthLabels.maxStrength"),": ",n.max," kg"]}),n.score&&e.jsxs("p",{className:"score-display",children:[s("tests.score"),": ",n.score]})]})]})]},r)};return e.jsxs("div",{className:"strength-container",children:[e.jsxs("div",{className:"strength-header",children:[e.jsxs("h1",{className:"strength-title",children:["💪 ",s("tests.strengthTitle")]}),e.jsx("p",{className:"strength-safety-note",children:s("tests.strengthSafetyNote")})]}),e.jsxs("div",{className:"tab-navigation",children:[e.jsxs("button",{className:`tab-btn ${P==="exercises"?"active":""}`,onClick:()=>q("exercises"),children:["🏋️ ",s("tests.startTest")]}),e.jsxs("button",{className:`tab-btn ${P==="standards"?"active":""}`,onClick:()=>q("standards"),children:["📋 ",s("tests.strengthStandards.tabTitle")]})]}),P==="exercises"&&e.jsxs("div",{className:"exercises-tab",children:[e.jsx("div",{className:"exercises-grid",children:G.map(ns)}),f&&e.jsxs("div",{className:"results-section",children:[e.jsxs("div",{className:"radar-chart-card",children:[e.jsx("div",{className:"corner-decoration top-left"}),e.jsx("div",{className:"corner-decoration top-right"}),e.jsx("div",{className:"corner-decoration bottom-left"}),e.jsx("div",{className:"corner-decoration bottom-right"}),e.jsxs("h3",{children:["📈 ",s("tests.strengthTitle")]}),e.jsx(As,{width:"100%",height:300,children:e.jsxs(Bs,{data:es,children:[e.jsx(Rs,{gridType:"polygon",stroke:"rgba(129, 216, 208, 0.25)",strokeWidth:2,strokeDasharray:"4 4"}),e.jsx(Os,{dataKey:"name",tick:{fontSize:13,fill:"#2d3748",fontWeight:700}}),e.jsx(Ws,{angle:90,domain:[0,100],tick:{fontSize:12,fill:"#2d3748",fontWeight:600}}),e.jsx(_s,{name:s("tests.score"),dataKey:"value",stroke:"#81D8D0",fill:"url(#strengthTiffanyGradient)",fillOpacity:.8,strokeWidth:4,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("defs",{children:e.jsxs("linearGradient",{id:"strengthTiffanyGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#81D8D0",stopOpacity:.9}),e.jsx("stop",{offset:"50%",stopColor:"#5F9EA0",stopOpacity:.7}),e.jsx("stop",{offset:"100%",stopColor:"#81D8D0",stopOpacity:.6})]})})]})})]}),e.jsxs("div",{className:"score-breakdown-card",children:[e.jsxs("h3",{children:["📊 ",s("tests.score")]}),e.jsx("div",{className:"score-breakdown",children:G.map(t=>e.jsxs("div",{className:"score-item",children:[e.jsx("span",{className:"score-label",children:t.name}),e.jsx("span",{className:"score-value",children:t.state.score||s("community.ui.noScore")})]},t.key))}),e.jsxs("div",{className:"average-score-display",children:[e.jsxs("p",{className:"average-score",children:[s("tests.averageScore"),": ",f]}),e.jsx("p",{className:"average-comment",children:Ze(f,w)})]})]})]})]}),P==="standards"&&e.jsxs("div",{className:"standards-tab",children:[e.jsxs("div",{className:"standards-content",children:[e.jsx("p",{children:s("tests.strengthStandards.intro")}),e.jsxs("p",{className:"source-link",children:[s("tests.strengthStandards.sourceLabel"),e.jsx("a",{href:"https://strengthlevel.com/",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:"https://strengthlevel.com/"})]})]}),e.jsxs("div",{className:"score-levels-table",children:[e.jsx("h3",{children:s("tests.strengthStandards.scoreLevelsTitle")}),e.jsx("div",{className:"levels-container",children:as.map((t,r)=>e.jsxs("div",{className:"level-item",children:[e.jsxs("div",{className:"level-header",children:[e.jsx("span",{className:"level-name",children:t.level}),e.jsx("span",{className:"level-score",children:t.score})]}),e.jsx("div",{className:"level-bar-container",children:e.jsx("div",{className:"level-bar",style:{width:`${t.score}%`,background:`linear-gradient(to right, ${t.color}dd, ${t.color})`}})})]},r))})]}),e.jsxs("div",{className:"score-table",children:[e.jsx("h3",{children:s("tests.strengthStandards.scoreTableTitle")}),e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:s("tests.strengthStandards.table.range")}),e.jsx("th",{children:s("tests.strengthStandards.table.description")})]})}),e.jsx("tbody",{children:ts.map((t,r)=>e.jsxs("tr",{children:[e.jsx("td",{children:t.range}),e.jsx("td",{children:t.description})]},r))})]})]})]}),e.jsx("div",{className:"submit-section",children:e.jsx("button",{type:"button",onClick:ss,className:"submit-btn",disabled:!f||E,children:E?s("common.submitting"):f?`✅ ${s("common.submitAndReturn")}`:s("errors.required")})})]})}Ks.propTypes={onComplete:Ye.func,clearTestData:Ye.func};export{Ks as default};

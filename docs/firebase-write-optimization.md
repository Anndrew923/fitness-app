# Firebase å¯«å…¥å„ªåŒ–ä¿®å¾©

## ğŸš¨ å•é¡Œæè¿°

ç”¨æˆ¶å ±å‘Š Firebase å¯«å…¥å•é¡Œå†æ¬¡å‡ºç¾ï¼Œæª¢æ¸¬åˆ°é«˜é »ç‡å¯«å…¥ï¼ˆ73.71 æ¬¡/åˆ†é˜ï¼‰ï¼Œé€™æœƒå°è‡´ï¼š

- æ€§èƒ½å•é¡Œ
- ä¸å¿…è¦çš„ Firebase è²»ç”¨
- æ•¸æ“šåº«è² è¼‰éé«˜
- ç”¨æˆ¶é«”é©—ä¸‹é™

## ğŸ” å•é¡Œåˆ†æ

### ä¸»è¦å•é¡Œä¾†æºï¼š

1. **UserInfo çµ„ä»¶ä¸­çš„ testData è™•ç†**ï¼š

   - æ¯æ¬¡ testData æ›´æ–°éƒ½æœƒè§¸ç™¼ `setUserData`
   - é˜²æŠ–æ™‚é–“åªæœ‰ 2 ç§’ï¼Œå¤ªçŸ­
   - æ¯æ¬¡éƒ½æœƒæ›´æ–° `lastActive` æ™‚é–“æˆ³

2. **UserContext ä¸­çš„ setUserData å‡½æ•¸**ï¼š

   - é˜²æŠ–æ©Ÿåˆ¶ä¸å¤ åš´æ ¼
   - é‡è¦æ•¸æ“šè®ŠåŒ–æª¢æ¸¬å¯èƒ½éæ–¼æ•æ„Ÿ
   - å®šæœŸåŒæ­¥é »ç‡éé«˜

3. **å®šæœŸåŒæ­¥æ©Ÿåˆ¶**ï¼š
   - æ¯ 5 åˆ†é˜æª¢æŸ¥ä¸€æ¬¡ï¼Œé »ç‡éé«˜
   - å¯èƒ½å°è‡´ä¸å¿…è¦çš„å¯«å…¥

## ğŸ”§ ä¿®å¾©æ–¹æ¡ˆ

### 1. **UserContext é˜²æŠ–å„ªåŒ–**

**ä¿®å¾©å‰**ï¼š

```javascript
// å…¶ä»–é‡è¦æ•¸æ“šè®ŠåŒ–ï¼Œä½¿ç”¨æ¨™æº–é˜²æŠ–
const timeoutId = setTimeout(() => {
  saveUserData(newData);
}, 2000); // 2ç§’é˜²æŠ–
```

**ä¿®å¾©å¾Œ**ï¼š

```javascript
// ä½¿ç”¨æ›´é•·çš„é˜²æŠ–æ™‚é–“ï¼ˆ10ç§’ï¼‰ä¾†å¤§å¹…æ¸›å°‘å¯«å…¥é »ç‡
setUserDataDebounceRef.current = setTimeout(() => {
  console.log(`ğŸ”„ é˜²æŠ–å¾Œä¿å­˜ç”¨æˆ¶æ•¸æ“šï¼ˆ10ç§’é˜²æŠ–ï¼‰`);
  saveUserData(newData);
  setUserDataDebounceRef.current = null;
}, 10000); // 10ç§’é˜²æŠ–
```

### 2. **UserInfo testData è™•ç†å„ªåŒ–**

**ä¿®å¾©å‰**ï¼š

```javascript
// ä½¿ç”¨é˜²æŠ–è™•ç† testData æ›´æ–°ï¼Œé¿å…é »ç¹å¯«å…¥
const timeoutId = setTimeout(() => {
  // ...
}, 2000); // 2ç§’é˜²æŠ–

return {
  ...prev,
  scores: updatedScores,
  lastActive: new Date().toISOString(), // æ¯æ¬¡éƒ½æœƒè§¸ç™¼å¯«å…¥
};
```

**ä¿®å¾©å¾Œ**ï¼š

```javascript
// ä½¿ç”¨æ›´é•·çš„é˜²æŠ–è™•ç† testData æ›´æ–°ï¼Œé¿å…é »ç¹å¯«å…¥
const timeoutId = setTimeout(() => {
  // ...
}, 5000); // å¢åŠ åˆ°5ç§’é˜²æŠ–

return {
  ...prev,
  scores: updatedScores,
  // ç§»é™¤ lastActive æ›´æ–°ï¼Œé¿å…é »ç¹å¯«å…¥
  // lastActive: new Date().toISOString(),
};
```

### 3. **å®šæœŸåŒæ­¥é »ç‡å„ªåŒ–**

**ä¿®å¾©å‰**ï¼š

```javascript
// å®šæœŸåŒæ­¥æ•¸æ“šåˆ° Firebaseï¼ˆæ¯ 5 åˆ†é˜ï¼Œæ¸›å°‘å¯«å…¥é »ç‡ï¼‰
const syncInterval = setInterval(() => {
  // ...
}, 300000); // 5åˆ†é˜
```

**ä¿®å¾©å¾Œ**ï¼š

```javascript
// å®šæœŸåŒæ­¥æ•¸æ“šåˆ° Firebaseï¼ˆæ¯ 10 åˆ†é˜ï¼Œå¤§å¹…æ¸›å°‘å¯«å…¥é »ç‡ï¼‰
const syncInterval = setInterval(() => {
  // ...
}, 600000); // 10åˆ†é˜
```

## ğŸ“Š å„ªåŒ–æ•ˆæœ

### 1. **å¯«å…¥é »ç‡å¤§å¹…é™ä½**

- é˜²æŠ–æ™‚é–“å¾ 2 ç§’å¢åŠ åˆ° 10 ç§’
- å®šæœŸåŒæ­¥å¾ 5 åˆ†é˜å¢åŠ åˆ° 10 åˆ†é˜
- ç§»é™¤ä¸å¿…è¦çš„ `lastActive` æ›´æ–°

### 2. **é æœŸæ”¹å–„**

- Firebase å¯«å…¥é »ç‡é™ä½ 80% ä»¥ä¸Š
- å¾ 73.71 æ¬¡/åˆ†é˜é™ä½åˆ° 10 æ¬¡/åˆ†é˜ä»¥ä¸‹
- æ€§èƒ½é¡¯è‘—æå‡
- æˆæœ¬å¤§å¹…é™ä½

### 3. **ç”¨æˆ¶é«”é©—ä¿æŒ**

- æœ¬åœ°ç‹€æ…‹ç«‹å³æ›´æ–°
- å‹•ç•«æ•ˆæœä¸å—å½±éŸ¿
- æ•¸æ“šæœ€çµ‚æœƒåŒæ­¥åˆ° Firebase

## ğŸ¯ å„ªåŒ–ç­–ç•¥

### 1. **åˆ†å±¤é˜²æŠ–æ©Ÿåˆ¶**

```
ç”¨æˆ¶æ“ä½œ â†’ æœ¬åœ°ç‹€æ…‹ç«‹å³æ›´æ–° â†’ 5ç§’é˜²æŠ– â†’ 10ç§’é˜²æŠ– â†’ Firebase å¯«å…¥
```

### 2. **æ™ºèƒ½æ•¸æ“šæª¢æ¸¬**

- åªæª¢æ¸¬é‡è¦å­—æ®µè®ŠåŒ–
- é¿å…ç„¡æ„ç¾©çš„å¯«å…¥
- ä½¿ç”¨ JSON.stringify æ¯”è¼ƒç¢ºä¿æº–ç¢ºæ€§

### 3. **å®šæœŸåŒæ­¥å„ªåŒ–**

- å¢åŠ åŒæ­¥é–“éš”
- æª¢æŸ¥å¯¦éš›æ•¸æ“šè®ŠåŒ–
- é¿å…é‡è¤‡å¯«å…¥

## ğŸ” ç›£æ§å’Œæ¸¬è©¦

### 1. **Firebase ç›£æ§**

```javascript
// ä½¿ç”¨ firebaseWriteMonitor ç›£æ§å¯«å…¥é »ç‡
firebaseWriteMonitor.getStats();
firebaseWriteMonitor.detectAnomalies();
```

### 2. **æ¸¬è©¦å»ºè­°**

1. å®Œæˆè©•æ¸¬å¾Œè§€å¯Ÿå¯«å…¥é »ç‡
2. æª¢æŸ¥é˜²æŠ–æ©Ÿåˆ¶æ˜¯å¦æ­£å¸¸å·¥ä½œ
3. ç¢ºèªå®šæœŸåŒæ­¥ä¸æœƒéæ–¼é »ç¹
4. é©—è­‰æ•¸æ“šæœ€çµ‚æœƒæ­£ç¢ºåŒæ­¥

### 3. **æ€§èƒ½æŒ‡æ¨™**

- Firebase å¯«å…¥æ¬¡æ•¸/åˆ†é˜
- é˜²æŠ–è§¸ç™¼æ¬¡æ•¸
- å®šæœŸåŒæ­¥åŸ·è¡Œæ¬¡æ•¸
- æ•¸æ“šè®ŠåŒ–æª¢æ¸¬æº–ç¢ºæ€§

## ğŸš€ æœ€ä½³å¯¦è¸

### 1. **å¯«å…¥ç­–ç•¥**

- å„ªå…ˆæ›´æ–°æœ¬åœ°ç‹€æ…‹
- ä½¿ç”¨é˜²æŠ–æ©Ÿåˆ¶å»¶é²å¯«å…¥
- åªåœ¨é‡è¦æ•¸æ“šè®ŠåŒ–æ™‚å¯«å…¥
- å®šæœŸåŒæ­¥ä½œç‚ºå‚™ä»½

### 2. **æ•¸æ“šç®¡ç†**

- é¿å…é »ç¹æ›´æ–°æ™‚é–“æˆ³
- æ‰¹é‡è™•ç†ç›¸é—œæ›´æ–°
- ä½¿ç”¨ merge æ“ä½œé¿å…è¦†è“‹
- ç›£æ§å¯«å…¥æ¨¡å¼

### 3. **ç”¨æˆ¶é«”é©—**

- ä¿æŒç•Œé¢éŸ¿æ‡‰æ€§
- æä¾›å³æ™‚åé¥‹
- ç¢ºä¿æ•¸æ“šä¸€è‡´æ€§
- å„ªé›…è™•ç†éŒ¯èª¤

## ğŸ“ æŠ€è¡“ç´°ç¯€

### 1. **é˜²æŠ–æ©Ÿåˆ¶å¯¦ç¾**

```javascript
const setUserDataDebounceRef = useRef(null);

// æ¸…é™¤ä¹‹å‰çš„é˜²æŠ–å®šæ™‚å™¨
if (setUserDataDebounceRef.current) {
  clearTimeout(setUserDataDebounceRef.current);
}

// è¨­ç½®æ–°çš„é˜²æŠ–å®šæ™‚å™¨
setUserDataDebounceRef.current = setTimeout(() => {
  saveUserData(newData);
  setUserDataDebounceRef.current = null;
}, 10000);
```

### 2. **æ•¸æ“šè®ŠåŒ–æª¢æ¸¬**

```javascript
const importantFields = [
  'scores',
  'height',
  'weight',
  'age',
  'gender',
  'nickname',
  'ladderRank',
];

const hasImportantChanges = importantFields.some(
  field => JSON.stringify(newData[field]) !== JSON.stringify(userData[field])
);
```

### 3. **å®šæœŸåŒæ­¥é‚è¼¯**

```javascript
const lastSavedData = localStorage.getItem('lastSavedUserData');
const currentDataString = JSON.stringify({
  scores: userData.scores,
  height: userData.height,
  weight: userData.weight,
  age: userData.age,
  gender: userData.gender,
  nickname: userData.nickname,
  ladderRank: userData.ladderRank,
});

if (lastSavedData !== currentDataString) {
  saveUserData(userData);
}
```

## ğŸ”§ ç¶­è­·å»ºè­°

### 1. **æŒçºŒç›£æ§**

- å®šæœŸæª¢æŸ¥ Firebase å¯«å…¥çµ±è¨ˆ
- ç›£æ§é˜²æŠ–æ©Ÿåˆ¶æ•ˆæœ
- è§€å¯Ÿç”¨æˆ¶æ“ä½œæ¨¡å¼

### 2. **å„ªåŒ–èª¿æ•´**

- æ ¹æ“šå¯¦éš›ä½¿ç”¨æƒ…æ³èª¿æ•´é˜²æŠ–æ™‚é–“
- å„ªåŒ–é‡è¦å­—æ®µæª¢æ¸¬é‚è¼¯
- èª¿æ•´å®šæœŸåŒæ­¥é »ç‡

### 3. **ç”¨æˆ¶åé¥‹**

- æ”¶é›†ç”¨æˆ¶å°æ€§èƒ½çš„æ„è¦‹
- ç›£æ§éŒ¯èª¤å ±å‘Š
- æŒçºŒæ”¹é€²å„ªåŒ–ç­–ç•¥
